var ri=Object.defineProperty;var ni=(r,t,e)=>t in r?ri(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var ye=(r,t,e)=>(ni(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();function W(){}function ii(r,t){for(const e in t)r[e]=t[e];return r}function on(r){return r()}function sr(){return Object.create(null)}function lt(r){r.forEach(on)}function an(r){return typeof r=="function"}function Ie(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}let ht;function Me(r,t){return ht||(ht=document.createElement("a")),ht.href=t,r===ht.href}function oi(r){return Object.keys(r).length===0}function sn(r,...t){if(r==null)return W;const e=r.subscribe(...t);return e.unsubscribe?()=>e.unsubscribe():e}function rt(r){let t;return sn(r,e=>t=e)(),t}function cn(r,t,e){r.$$.on_destroy.push(sn(t,e))}function ai(r,t,e,n){if(r){const i=ln(r,t,e,n);return r[0](i)}}function ln(r,t,e,n){return r[1]&&n?ii(e.ctx.slice(),r[1](n(t))):e.ctx}function si(r,t,e,n){if(r[2]&&n){const i=r[2](n(e));if(t.dirty===void 0)return i;if(typeof i=="object"){const a=[],s=Math.max(t.dirty.length,i.length);for(let u=0;u<s;u+=1)a[u]=t.dirty[u]|i[u];return a}return t.dirty|i}return t.dirty}function ci(r,t,e,n,i,a){if(i){const s=ln(t,e,n,a);r.p(s,i)}}function li(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function ne(r){return r==null?"":r}function M(r,t){r.appendChild(t)}function N(r,t,e){r.insertBefore(t,e||null)}function $(r){r.parentNode.removeChild(r)}function cr(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function j(r){return document.createElement(r)}function fe(r){return document.createTextNode(r)}function Y(){return fe(" ")}function Ne(){return fe("")}function ft(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function P(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function fi(r){return Array.from(r.childNodes)}function Se(r,t){t=""+t,r.wholeText!==t&&(r.data=t)}function Q(r,t,e){r.classList[e?"add":"remove"](t)}function ui(r,t,{bubbles:e=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(r,e,n,t),i}let at;function nt(r){at=r}function fn(){if(!at)throw new Error("Function called outside component initialization");return at}function Kt(r){fn().$$.on_mount.push(r)}function di(){const r=fn();return(t,e,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[t];if(i){const a=ui(t,e,{cancelable:n});return i.slice().forEach(s=>{s.call(r,a)}),!a.defaultPrevented}return!0}}const Ke=[],lr=[],xt=[],fr=[],pi=Promise.resolve();let Nt=!1;function hi(){Nt||(Nt=!0,pi.then(un))}function Gt(r){xt.push(r)}const jt=new Set;let mt=0;function un(){const r=at;do{for(;mt<Ke.length;){const t=Ke[mt];mt++,nt(t),mi(t.$$)}for(nt(null),Ke.length=0,mt=0;lr.length;)lr.pop()();for(let t=0;t<xt.length;t+=1){const e=xt[t];jt.has(e)||(jt.add(e),e())}xt.length=0}while(Ke.length);for(;fr.length;)fr.pop()();Nt=!1,jt.clear(),nt(r)}function mi(r){if(r.fragment!==null){r.update(),lt(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Gt)}}const St=new Set;let $e;function Te(){$e={r:0,c:[],p:$e}}function Pe(){$e.r||lt($e.c),$e=$e.p}function V(r,t){r&&r.i&&(St.delete(r),r.i(t))}function X(r,t,e,n){if(r&&r.o){if(St.has(r))return;St.add(r),$e.c.push(()=>{St.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function dn(r,t){X(r,1,1,()=>{t.delete(r.key)})}function pn(r,t,e,n,i,a,s,u,f,l,p,o){let c=r.length,d=a.length,h=c;const y={};for(;h--;)y[r[h].key]=h;const x=[],v=new Map,C=new Map;for(h=d;h--;){const B=o(i,a,h),U=e(B);let w=s.get(U);w?n&&w.p(B,t):(w=l(U,B),w.c()),v.set(U,x[h]=w),U in y&&C.set(U,Math.abs(h-y[U]))}const A=new Set,I=new Set;function E(B){V(B,1),B.m(u,p),s.set(B.key,B),p=B.first,d--}for(;c&&d;){const B=x[d-1],U=r[c-1],w=B.key,D=U.key;B===U?(p=B.first,c--,d--):v.has(D)?!s.has(w)||A.has(w)?E(B):I.has(D)?c--:C.get(w)>C.get(D)?(I.add(w),E(B)):(A.add(D),c--):(f(U,s),c--)}for(;c--;){const B=r[c];v.has(B.key)||f(B,s)}for(;d;)E(x[d-1]);return x}function ve(r){r&&r.c()}function de(r,t,e,n){const{fragment:i,after_update:a}=r.$$;i&&i.m(t,e),n||Gt(()=>{const s=r.$$.on_mount.map(on).filter(an);r.$$.on_destroy?r.$$.on_destroy.push(...s):lt(s),r.$$.on_mount=[]}),a.forEach(Gt)}function pe(r,t){const e=r.$$;e.fragment!==null&&(lt(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function _i(r,t){r.$$.dirty[0]===-1&&(Ke.push(r),hi(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Be(r,t,e,n,i,a,s,u=[-1]){const f=at;nt(r);const l=r.$$={fragment:null,ctx:[],props:a,update:W,not_equal:i,bound:sr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:sr(),dirty:u,skip_bound:!1,root:t.target||f.$$.root};s&&s(l.root);let p=!1;if(l.ctx=e?e(r,t.props||{},(o,c,...d)=>{const h=d.length?d[0]:c;return l.ctx&&i(l.ctx[o],l.ctx[o]=h)&&(!l.skip_bound&&l.bound[o]&&l.bound[o](h),p&&_i(r,o)),c}):[],l.update(),p=!0,lt(l.before_update),l.fragment=n?n(l.ctx):!1,t.target){if(t.hydrate){const o=fi(t.target);l.fragment&&l.fragment.l(o),o.forEach($)}else l.fragment&&l.fragment.c();t.intro&&V(r.$$.fragment),de(r,t.target,t.anchor,t.customElement),un()}nt(f)}class je{$destroy(){pe(this,1),this.$destroy=W}$on(t,e){if(!an(e))return W;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!oi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function ur(r){let t,e,n,i,a,s,u,f,l;return{c(){t=j("div"),e=j("button"),e.textContent="\u2716\uFE0F",n=Y(),i=j("p"),i.textContent="For a better gaming experience, it is recommended to hide the toolbar.",a=Y(),s=j("img"),P(e,"class","button svelte-rjtj2u"),P(i,"class","text svelte-rjtj2u"),Me(s.src,u="hide-toolbar.png")||P(s,"src",u),P(s,"alt","hide toolbar guide"),P(t,"class","overlay svelte-rjtj2u")},m(p,o){N(p,t,o),M(t,e),M(t,n),M(t,i),M(t,a),M(t,s),f||(l=ft(e,"click",r[1]),f=!0)},p:W,d(p){p&&$(t),f=!1,l()}}}function vi(r){let t,e=r[0]&&ur(r);return{c(){e&&e.c(),t=Ne()},m(n,i){e&&e.m(n,i),N(n,t,i)},p(n,[i]){n[0]?e?e.p(n,i):(e=ur(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:W,o:W,d(n){e&&e.d(n),n&&$(t)}}}function gi(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)}function yi(r,t,e){let n=!1;function i(){e(0,n=!1)}return Kt(()=>{gi()&&e(0,n=!0)}),[n,i]}class bi extends je{constructor(t){super(),Be(this,t,yi,vi,Ie,{})}}const Ge=[];function hn(r,t=W){let e;const n=new Set;function i(u){if(Ie(r,u)&&(r=u,e)){const f=!Ge.length;for(const l of n)l[1](),Ge.push(l,r);if(f){for(let l=0;l<Ge.length;l+=2)Ge[l][0](Ge[l+1]);Ge.length=0}}}function a(u){i(u(r))}function s(u,f=W){const l=[u,f];return n.add(l),n.size===1&&(e=t(i)||W),u(r),()=>{n.delete(l),n.size===0&&(e(),e=null)}}return{set:i,update:a,subscribe:s}}var Ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qe={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(r){(function(){var t=function(){this.init()};t.prototype={init:function(){var o=this||e;return o._counter=1e3,o._html5AudioPool=[],o.html5PoolSize=10,o._codecs={},o._howls=[],o._muted=!1,o._volume=1,o._canPlayEvent="canplaythrough",o._navigator=typeof window<"u"&&window.navigator?window.navigator:null,o.masterGain=null,o.noAudio=!1,o.usingWebAudio=!0,o.autoSuspend=!0,o.ctx=null,o.autoUnlock=!0,o._setup(),o},volume:function(o){var c=this||e;if(o=parseFloat(o),c.ctx||p(),typeof o<"u"&&o>=0&&o<=1){if(c._volume=o,c._muted)return c;c.usingWebAudio&&c.masterGain.gain.setValueAtTime(o,e.ctx.currentTime);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var h=c._howls[d]._getSoundIds(),y=0;y<h.length;y++){var x=c._howls[d]._soundById(h[y]);x&&x._node&&(x._node.volume=x._volume*o)}return c}return c._volume},mute:function(o){var c=this||e;c.ctx||p(),c._muted=o,c.usingWebAudio&&c.masterGain.gain.setValueAtTime(o?0:c._volume,e.ctx.currentTime);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var h=c._howls[d]._getSoundIds(),y=0;y<h.length;y++){var x=c._howls[d]._soundById(h[y]);x&&x._node&&(x._node.muted=o?!0:x._muted)}return c},stop:function(){for(var o=this||e,c=0;c<o._howls.length;c++)o._howls[c].stop();return o},unload:function(){for(var o=this||e,c=o._howls.length-1;c>=0;c--)o._howls[c].unload();return o.usingWebAudio&&o.ctx&&typeof o.ctx.close<"u"&&(o.ctx.close(),o.ctx=null,p()),o},codecs:function(o){return(this||e)._codecs[o.replace(/^x-/,"")]},_setup:function(){var o=this||e;if(o.state=o.ctx&&o.ctx.state||"suspended",o._autoSuspend(),!o.usingWebAudio)if(typeof Audio<"u")try{var c=new Audio;typeof c.oncanplaythrough>"u"&&(o._canPlayEvent="canplay")}catch{o.noAudio=!0}else o.noAudio=!0;try{var c=new Audio;c.muted&&(o.noAudio=!0)}catch{}return o.noAudio||o._setupCodecs(),o},_setupCodecs:function(){var o=this||e,c=null;try{c=typeof Audio<"u"?new Audio:null}catch{return o}if(!c||typeof c.canPlayType!="function")return o;var d=c.canPlayType("audio/mpeg;").replace(/^no$/,""),h=o._navigator?o._navigator.userAgent:"",y=h.match(/OPR\/([0-6].)/g),x=y&&parseInt(y[0].split("/")[1],10)<33,v=h.indexOf("Safari")!==-1&&h.indexOf("Chrome")===-1,C=h.match(/Version\/(.*?) /),A=v&&C&&parseInt(C[1],10)<15;return o._codecs={mp3:!!(!x&&(d||c.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!c.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(c.canPlayType('audio/wav; codecs="1"')||c.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!c.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!c.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(c.canPlayType("audio/x-m4a;")||c.canPlayType("audio/m4a;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(c.canPlayType("audio/x-m4b;")||c.canPlayType("audio/m4b;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(c.canPlayType("audio/x-mp4;")||c.canPlayType("audio/mp4;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!A&&c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!A&&c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!c.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(c.canPlayType("audio/x-flac;")||c.canPlayType("audio/flac;")).replace(/^no$/,"")},o},_unlockAudio:function(){var o=this||e;if(!(o._audioUnlocked||!o.ctx)){o._audioUnlocked=!1,o.autoUnlock=!1,!o._mobileUnloaded&&o.ctx.sampleRate!==44100&&(o._mobileUnloaded=!0,o.unload()),o._scratchBuffer=o.ctx.createBuffer(1,1,22050);var c=function(d){for(;o._html5AudioPool.length<o.html5PoolSize;)try{var h=new Audio;h._unlocked=!0,o._releaseHtml5Audio(h)}catch{o.noAudio=!0;break}for(var y=0;y<o._howls.length;y++)if(!o._howls[y]._webAudio)for(var x=o._howls[y]._getSoundIds(),v=0;v<x.length;v++){var C=o._howls[y]._soundById(x[v]);C&&C._node&&!C._node._unlocked&&(C._node._unlocked=!0,C._node.load())}o._autoResume();var A=o.ctx.createBufferSource();A.buffer=o._scratchBuffer,A.connect(o.ctx.destination),typeof A.start>"u"?A.noteOn(0):A.start(0),typeof o.ctx.resume=="function"&&o.ctx.resume(),A.onended=function(){A.disconnect(0),o._audioUnlocked=!0,document.removeEventListener("touchstart",c,!0),document.removeEventListener("touchend",c,!0),document.removeEventListener("click",c,!0),document.removeEventListener("keydown",c,!0);for(var I=0;I<o._howls.length;I++)o._howls[I]._emit("unlock")}};return document.addEventListener("touchstart",c,!0),document.addEventListener("touchend",c,!0),document.addEventListener("click",c,!0),document.addEventListener("keydown",c,!0),o}},_obtainHtml5Audio:function(){var o=this||e;if(o._html5AudioPool.length)return o._html5AudioPool.pop();var c=new Audio().play();return c&&typeof Promise<"u"&&(c instanceof Promise||typeof c.then=="function")&&c.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(o){var c=this||e;return o._unlocked&&c._html5AudioPool.push(o),c},_autoSuspend:function(){var o=this;if(!(!o.autoSuspend||!o.ctx||typeof o.ctx.suspend>"u"||!e.usingWebAudio)){for(var c=0;c<o._howls.length;c++)if(o._howls[c]._webAudio){for(var d=0;d<o._howls[c]._sounds.length;d++)if(!o._howls[c]._sounds[d]._paused)return o}return o._suspendTimer&&clearTimeout(o._suspendTimer),o._suspendTimer=setTimeout(function(){if(!!o.autoSuspend){o._suspendTimer=null,o.state="suspending";var h=function(){o.state="suspended",o._resumeAfterSuspend&&(delete o._resumeAfterSuspend,o._autoResume())};o.ctx.suspend().then(h,h)}},3e4),o}},_autoResume:function(){var o=this;if(!(!o.ctx||typeof o.ctx.resume>"u"||!e.usingWebAudio))return o.state==="running"&&o.ctx.state!=="interrupted"&&o._suspendTimer?(clearTimeout(o._suspendTimer),o._suspendTimer=null):o.state==="suspended"||o.state==="running"&&o.ctx.state==="interrupted"?(o.ctx.resume().then(function(){o.state="running";for(var c=0;c<o._howls.length;c++)o._howls[c]._emit("resume")}),o._suspendTimer&&(clearTimeout(o._suspendTimer),o._suspendTimer=null)):o.state==="suspending"&&(o._resumeAfterSuspend=!0),o}};var e=new t,n=function(o){var c=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}c.init(o)};n.prototype={init:function(o){var c=this;return e.ctx||p(),c._autoplay=o.autoplay||!1,c._format=typeof o.format!="string"?o.format:[o.format],c._html5=o.html5||!1,c._muted=o.mute||!1,c._loop=o.loop||!1,c._pool=o.pool||5,c._preload=typeof o.preload=="boolean"||o.preload==="metadata"?o.preload:!0,c._rate=o.rate||1,c._sprite=o.sprite||{},c._src=typeof o.src!="string"?o.src:[o.src],c._volume=o.volume!==void 0?o.volume:1,c._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:o.xhr&&o.xhr.withCredentials?o.xhr.withCredentials:!1},c._duration=0,c._state="unloaded",c._sounds=[],c._endTimers={},c._queue=[],c._playLock=!1,c._onend=o.onend?[{fn:o.onend}]:[],c._onfade=o.onfade?[{fn:o.onfade}]:[],c._onload=o.onload?[{fn:o.onload}]:[],c._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[],c._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[],c._onpause=o.onpause?[{fn:o.onpause}]:[],c._onplay=o.onplay?[{fn:o.onplay}]:[],c._onstop=o.onstop?[{fn:o.onstop}]:[],c._onmute=o.onmute?[{fn:o.onmute}]:[],c._onvolume=o.onvolume?[{fn:o.onvolume}]:[],c._onrate=o.onrate?[{fn:o.onrate}]:[],c._onseek=o.onseek?[{fn:o.onseek}]:[],c._onunlock=o.onunlock?[{fn:o.onunlock}]:[],c._onresume=[],c._webAudio=e.usingWebAudio&&!c._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(c),c._autoplay&&c._queue.push({event:"play",action:function(){c.play()}}),c._preload&&c._preload!=="none"&&c.load(),c},load:function(){var o=this,c=null;if(e.noAudio){o._emit("loaderror",null,"No audio support.");return}typeof o._src=="string"&&(o._src=[o._src]);for(var d=0;d<o._src.length;d++){var h,y;if(o._format&&o._format[d])h=o._format[d];else{if(y=o._src[d],typeof y!="string"){o._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}h=/^data:audio\/([^;,]+);/i.exec(y),h||(h=/\.([^.]+)$/.exec(y.split("?",1)[0])),h&&(h=h[1].toLowerCase())}if(h||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),h&&e.codecs(h)){c=o._src[d];break}}if(!c){o._emit("loaderror",null,"No codec support for selected audio sources.");return}return o._src=c,o._state="loading",window.location.protocol==="https:"&&c.slice(0,5)==="http:"&&(o._html5=!0,o._webAudio=!1),new i(o),o._webAudio&&s(o),o},play:function(o,c){var d=this,h=null;if(typeof o=="number")h=o,o=null;else{if(typeof o=="string"&&d._state==="loaded"&&!d._sprite[o])return null;if(typeof o>"u"&&(o="__default",!d._playLock)){for(var y=0,x=0;x<d._sounds.length;x++)d._sounds[x]._paused&&!d._sounds[x]._ended&&(y++,h=d._sounds[x]._id);y===1?o=null:h=null}}var v=h?d._soundById(h):d._inactiveSound();if(!v)return null;if(h&&!o&&(o=v._sprite||"__default"),d._state!=="loaded"){v._sprite=o,v._ended=!1;var C=v._id;return d._queue.push({event:"play",action:function(){d.play(C)}}),C}if(h&&!v._paused)return c||d._loadQueue("play"),v._id;d._webAudio&&e._autoResume();var A=Math.max(0,v._seek>0?v._seek:d._sprite[o][0]/1e3),I=Math.max(0,(d._sprite[o][0]+d._sprite[o][1])/1e3-A),E=I*1e3/Math.abs(v._rate),B=d._sprite[o][0]/1e3,U=(d._sprite[o][0]+d._sprite[o][1])/1e3;v._sprite=o,v._ended=!1;var w=function(){v._paused=!1,v._seek=A,v._start=B,v._stop=U,v._loop=!!(v._loop||d._sprite[o][2])};if(A>=U){d._ended(v);return}var D=v._node;if(d._webAudio){var G=function(){d._playLock=!1,w(),d._refreshBuffer(v);var Z=v._muted||d._muted?0:v._volume;D.gain.setValueAtTime(Z,e.ctx.currentTime),v._playStart=e.ctx.currentTime,typeof D.bufferSource.start>"u"?v._loop?D.bufferSource.noteGrainOn(0,A,86400):D.bufferSource.noteGrainOn(0,A,I):v._loop?D.bufferSource.start(0,A,86400):D.bufferSource.start(0,A,I),E!==1/0&&(d._endTimers[v._id]=setTimeout(d._ended.bind(d,v),E)),c||setTimeout(function(){d._emit("play",v._id),d._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?G():(d._playLock=!0,d.once("resume",G),d._clearTimer(v._id))}else{var Ce=function(){D.currentTime=A,D.muted=v._muted||d._muted||e._muted||D.muted,D.volume=v._volume*e.volume(),D.playbackRate=v._rate;try{var Z=D.play();if(Z&&typeof Promise<"u"&&(Z instanceof Promise||typeof Z.then=="function")?(d._playLock=!0,w(),Z.then(function(){d._playLock=!1,D._unlocked=!0,c?d._loadQueue():d._emit("play",v._id)}).catch(function(){d._playLock=!1,d._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):c||(d._playLock=!1,w(),d._emit("play",v._id)),D.playbackRate=v._rate,D.paused){d._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}o!=="__default"||v._loop?d._endTimers[v._id]=setTimeout(d._ended.bind(d,v),E):(d._endTimers[v._id]=function(){d._ended(v),D.removeEventListener("ended",d._endTimers[v._id],!1)},D.addEventListener("ended",d._endTimers[v._id],!1))}catch(q){d._emit("playerror",v._id,q)}};D.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(D.src=d._src,D.load());var re=window&&window.ejecta||!D.readyState&&e._navigator.isCocoonJS;if(D.readyState>=3||re)Ce();else{d._playLock=!0,d._state="loading";var te=function(){d._state="loaded",Ce(),D.removeEventListener(e._canPlayEvent,te,!1)};D.addEventListener(e._canPlayEvent,te,!1),d._clearTimer(v._id)}}return v._id},pause:function(o){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"pause",action:function(){c.pause(o)}}),c;for(var d=c._getSoundIds(o),h=0;h<d.length;h++){c._clearTimer(d[h]);var y=c._soundById(d[h]);if(y&&!y._paused&&(y._seek=c.seek(d[h]),y._rateSeek=0,y._paused=!0,c._stopFade(d[h]),y._node))if(c._webAudio){if(!y._node.bufferSource)continue;typeof y._node.bufferSource.stop>"u"?y._node.bufferSource.noteOff(0):y._node.bufferSource.stop(0),c._cleanBuffer(y._node)}else(!isNaN(y._node.duration)||y._node.duration===1/0)&&y._node.pause();arguments[1]||c._emit("pause",y?y._id:null)}return c},stop:function(o,c){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(o)}}),d;for(var h=d._getSoundIds(o),y=0;y<h.length;y++){d._clearTimer(h[y]);var x=d._soundById(h[y]);x&&(x._seek=x._start||0,x._rateSeek=0,x._paused=!0,x._ended=!0,d._stopFade(h[y]),x._node&&(d._webAudio?x._node.bufferSource&&(typeof x._node.bufferSource.stop>"u"?x._node.bufferSource.noteOff(0):x._node.bufferSource.stop(0),d._cleanBuffer(x._node)):(!isNaN(x._node.duration)||x._node.duration===1/0)&&(x._node.currentTime=x._start||0,x._node.pause(),x._node.duration===1/0&&d._clearSound(x._node))),c||d._emit("stop",x._id))}return d},mute:function(o,c){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(o,c)}}),d;if(typeof c>"u")if(typeof o=="boolean")d._muted=o;else return d._muted;for(var h=d._getSoundIds(c),y=0;y<h.length;y++){var x=d._soundById(h[y]);x&&(x._muted=o,x._interval&&d._stopFade(x._id),d._webAudio&&x._node?x._node.gain.setValueAtTime(o?0:x._volume,e.ctx.currentTime):x._node&&(x._node.muted=e._muted?!0:o),d._emit("mute",x._id))}return d},volume:function(){var o=this,c=arguments,d,h;if(c.length===0)return o._volume;if(c.length===1||c.length===2&&typeof c[1]>"u"){var y=o._getSoundIds(),x=y.indexOf(c[0]);x>=0?h=parseInt(c[0],10):d=parseFloat(c[0])}else c.length>=2&&(d=parseFloat(c[0]),h=parseInt(c[1],10));var v;if(typeof d<"u"&&d>=0&&d<=1){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,c)}}),o;typeof h>"u"&&(o._volume=d),h=o._getSoundIds(h);for(var C=0;C<h.length;C++)v=o._soundById(h[C]),v&&(v._volume=d,c[2]||o._stopFade(h[C]),o._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(d,e.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=d*e.volume()),o._emit("volume",v._id))}else return v=h?o._soundById(h):o._sounds[0],v?v._volume:0;return o},fade:function(o,c,d,h){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"fade",action:function(){y.fade(o,c,d,h)}}),y;o=Math.min(Math.max(0,parseFloat(o)),1),c=Math.min(Math.max(0,parseFloat(c)),1),d=parseFloat(d),y.volume(o,h);for(var x=y._getSoundIds(h),v=0;v<x.length;v++){var C=y._soundById(x[v]);if(C){if(h||y._stopFade(x[v]),y._webAudio&&!C._muted){var A=e.ctx.currentTime,I=A+d/1e3;C._volume=o,C._node.gain.setValueAtTime(o,A),C._node.gain.linearRampToValueAtTime(c,I)}y._startFadeInterval(C,o,c,d,x[v],typeof h>"u")}}return y},_startFadeInterval:function(o,c,d,h,y,x){var v=this,C=c,A=d-c,I=Math.abs(A/.01),E=Math.max(4,I>0?h/I:h),B=Date.now();o._fadeTo=d,o._interval=setInterval(function(){var U=(Date.now()-B)/h;B=Date.now(),C+=A*U,C=Math.round(C*100)/100,A<0?C=Math.max(d,C):C=Math.min(d,C),v._webAudio?o._volume=C:v.volume(C,o._id,!0),x&&(v._volume=C),(d<c&&C<=d||d>c&&C>=d)&&(clearInterval(o._interval),o._interval=null,o._fadeTo=null,v.volume(d,o._id),v._emit("fade",o._id))},E)},_stopFade:function(o){var c=this,d=c._soundById(o);return d&&d._interval&&(c._webAudio&&d._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(d._interval),d._interval=null,c.volume(d._fadeTo,o),d._fadeTo=null,c._emit("fade",o)),c},loop:function(){var o=this,c=arguments,d,h,y;if(c.length===0)return o._loop;if(c.length===1)if(typeof c[0]=="boolean")d=c[0],o._loop=d;else return y=o._soundById(parseInt(c[0],10)),y?y._loop:!1;else c.length===2&&(d=c[0],h=parseInt(c[1],10));for(var x=o._getSoundIds(h),v=0;v<x.length;v++)y=o._soundById(x[v]),y&&(y._loop=d,o._webAudio&&y._node&&y._node.bufferSource&&(y._node.bufferSource.loop=d,d&&(y._node.bufferSource.loopStart=y._start||0,y._node.bufferSource.loopEnd=y._stop,o.playing(x[v])&&(o.pause(x[v],!0),o.play(x[v],!0)))));return o},rate:function(){var o=this,c=arguments,d,h;if(c.length===0)h=o._sounds[0]._id;else if(c.length===1){var y=o._getSoundIds(),x=y.indexOf(c[0]);x>=0?h=parseInt(c[0],10):d=parseFloat(c[0])}else c.length===2&&(d=parseFloat(c[0]),h=parseInt(c[1],10));var v;if(typeof d=="number"){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,c)}}),o;typeof h>"u"&&(o._rate=d),h=o._getSoundIds(h);for(var C=0;C<h.length;C++)if(v=o._soundById(h[C]),v){o.playing(h[C])&&(v._rateSeek=o.seek(h[C]),v._playStart=o._webAudio?e.ctx.currentTime:v._playStart),v._rate=d,o._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(d,e.ctx.currentTime):v._node&&(v._node.playbackRate=d);var A=o.seek(h[C]),I=(o._sprite[v._sprite][0]+o._sprite[v._sprite][1])/1e3-A,E=I*1e3/Math.abs(v._rate);(o._endTimers[h[C]]||!v._paused)&&(o._clearTimer(h[C]),o._endTimers[h[C]]=setTimeout(o._ended.bind(o,v),E)),o._emit("rate",v._id)}}else return v=o._soundById(h),v?v._rate:o._rate;return o},seek:function(){var o=this,c=arguments,d,h;if(c.length===0)o._sounds.length&&(h=o._sounds[0]._id);else if(c.length===1){var y=o._getSoundIds(),x=y.indexOf(c[0]);x>=0?h=parseInt(c[0],10):o._sounds.length&&(h=o._sounds[0]._id,d=parseFloat(c[0]))}else c.length===2&&(d=parseFloat(c[0]),h=parseInt(c[1],10));if(typeof h>"u")return 0;if(typeof d=="number"&&(o._state!=="loaded"||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,c)}}),o;var v=o._soundById(h);if(v)if(typeof d=="number"&&d>=0){var C=o.playing(h);C&&o.pause(h,!0),v._seek=d,v._ended=!1,o._clearTimer(h),!o._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=d);var A=function(){C&&o.play(h,!0),o._emit("seek",h)};if(C&&!o._webAudio){var I=function(){o._playLock?setTimeout(I,0):A()};setTimeout(I,0)}else A()}else if(o._webAudio){var E=o.playing(h)?e.ctx.currentTime-v._playStart:0,B=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(B+E*Math.abs(v._rate))}else return v._node.currentTime;return o},playing:function(o){var c=this;if(typeof o=="number"){var d=c._soundById(o);return d?!d._paused:!1}for(var h=0;h<c._sounds.length;h++)if(!c._sounds[h]._paused)return!0;return!1},duration:function(o){var c=this,d=c._duration,h=c._soundById(o);return h&&(d=c._sprite[h._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var o=this,c=o._sounds,d=0;d<c.length;d++)c[d]._paused||o.stop(c[d]._id),o._webAudio||(o._clearSound(c[d]._node),c[d]._node.removeEventListener("error",c[d]._errorFn,!1),c[d]._node.removeEventListener(e._canPlayEvent,c[d]._loadFn,!1),c[d]._node.removeEventListener("ended",c[d]._endFn,!1),e._releaseHtml5Audio(c[d]._node)),delete c[d]._node,o._clearTimer(c[d]._id);var h=e._howls.indexOf(o);h>=0&&e._howls.splice(h,1);var y=!0;for(d=0;d<e._howls.length;d++)if(e._howls[d]._src===o._src||o._src.indexOf(e._howls[d]._src)>=0){y=!1;break}return a&&y&&delete a[o._src],e.noAudio=!1,o._state="unloaded",o._sounds=[],o=null,null},on:function(o,c,d,h){var y=this,x=y["_on"+o];return typeof c=="function"&&x.push(h?{id:d,fn:c,once:h}:{id:d,fn:c}),y},off:function(o,c,d){var h=this,y=h["_on"+o],x=0;if(typeof c=="number"&&(d=c,c=null),c||d)for(x=0;x<y.length;x++){var v=d===y[x].id;if(c===y[x].fn&&v||!c&&v){y.splice(x,1);break}}else if(o)h["_on"+o]=[];else{var C=Object.keys(h);for(x=0;x<C.length;x++)C[x].indexOf("_on")===0&&Array.isArray(h[C[x]])&&(h[C[x]]=[])}return h},once:function(o,c,d){var h=this;return h.on(o,c,d,1),h},_emit:function(o,c,d){for(var h=this,y=h["_on"+o],x=y.length-1;x>=0;x--)(!y[x].id||y[x].id===c||o==="load")&&(setTimeout(function(v){v.call(this,c,d)}.bind(h,y[x].fn),0),y[x].once&&h.off(o,y[x].fn,y[x].id));return h._loadQueue(o),h},_loadQueue:function(o){var c=this;if(c._queue.length>0){var d=c._queue[0];d.event===o&&(c._queue.shift(),c._loadQueue()),o||d.action()}return c},_ended:function(o){var c=this,d=o._sprite;if(!c._webAudio&&o._node&&!o._node.paused&&!o._node.ended&&o._node.currentTime<o._stop)return setTimeout(c._ended.bind(c,o),100),c;var h=!!(o._loop||c._sprite[d][2]);if(c._emit("end",o._id),!c._webAudio&&h&&c.stop(o._id,!0).play(o._id),c._webAudio&&h){c._emit("play",o._id),o._seek=o._start||0,o._rateSeek=0,o._playStart=e.ctx.currentTime;var y=(o._stop-o._start)*1e3/Math.abs(o._rate);c._endTimers[o._id]=setTimeout(c._ended.bind(c,o),y)}return c._webAudio&&!h&&(o._paused=!0,o._ended=!0,o._seek=o._start||0,o._rateSeek=0,c._clearTimer(o._id),c._cleanBuffer(o._node),e._autoSuspend()),!c._webAudio&&!h&&c.stop(o._id,!0),c},_clearTimer:function(o){var c=this;if(c._endTimers[o]){if(typeof c._endTimers[o]!="function")clearTimeout(c._endTimers[o]);else{var d=c._soundById(o);d&&d._node&&d._node.removeEventListener("ended",c._endTimers[o],!1)}delete c._endTimers[o]}return c},_soundById:function(o){for(var c=this,d=0;d<c._sounds.length;d++)if(o===c._sounds[d]._id)return c._sounds[d];return null},_inactiveSound:function(){var o=this;o._drain();for(var c=0;c<o._sounds.length;c++)if(o._sounds[c]._ended)return o._sounds[c].reset();return new i(o)},_drain:function(){var o=this,c=o._pool,d=0,h=0;if(!(o._sounds.length<c)){for(h=0;h<o._sounds.length;h++)o._sounds[h]._ended&&d++;for(h=o._sounds.length-1;h>=0;h--){if(d<=c)return;o._sounds[h]._ended&&(o._webAudio&&o._sounds[h]._node&&o._sounds[h]._node.disconnect(0),o._sounds.splice(h,1),d--)}}},_getSoundIds:function(o){var c=this;if(typeof o>"u"){for(var d=[],h=0;h<c._sounds.length;h++)d.push(c._sounds[h]._id);return d}else return[o]},_refreshBuffer:function(o){var c=this;return o._node.bufferSource=e.ctx.createBufferSource(),o._node.bufferSource.buffer=a[c._src],o._panner?o._node.bufferSource.connect(o._panner):o._node.bufferSource.connect(o._node),o._node.bufferSource.loop=o._loop,o._loop&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop||0),o._node.bufferSource.playbackRate.setValueAtTime(o._rate,e.ctx.currentTime),c},_cleanBuffer:function(o){var c=this,d=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&o.bufferSource&&(o.bufferSource.onended=null,o.bufferSource.disconnect(0),d))try{o.bufferSource.buffer=e._scratchBuffer}catch{}return o.bufferSource=null,c},_clearSound:function(o){var c=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);c||(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(o){this._parent=o,this.init()};i.prototype={init:function(){var o=this,c=o._parent;return o._muted=c._muted,o._loop=c._loop,o._volume=c._volume,o._rate=c._rate,o._seek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++e._counter,c._sounds.push(o),o.create(),o},create:function(){var o=this,c=o._parent,d=e._muted||o._muted||o._parent._muted?0:o._volume;return c._webAudio?(o._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),o._node.gain.setValueAtTime(d,e.ctx.currentTime),o._node.paused=!0,o._node.connect(e.masterGain)):e.noAudio||(o._node=e._obtainHtml5Audio(),o._errorFn=o._errorListener.bind(o),o._node.addEventListener("error",o._errorFn,!1),o._loadFn=o._loadListener.bind(o),o._node.addEventListener(e._canPlayEvent,o._loadFn,!1),o._endFn=o._endListener.bind(o),o._node.addEventListener("ended",o._endFn,!1),o._node.src=c._src,o._node.preload=c._preload===!0?"auto":c._preload,o._node.volume=d*e.volume(),o._node.load()),o},reset:function(){var o=this,c=o._parent;return o._muted=c._muted,o._loop=c._loop,o._volume=c._volume,o._rate=c._rate,o._seek=0,o._rateSeek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++e._counter,o},_errorListener:function(){var o=this;o._parent._emit("loaderror",o._id,o._node.error?o._node.error.code:0),o._node.removeEventListener("error",o._errorFn,!1)},_loadListener:function(){var o=this,c=o._parent;c._duration=Math.ceil(o._node.duration*10)/10,Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue()),o._node.removeEventListener(e._canPlayEvent,o._loadFn,!1)},_endListener:function(){var o=this,c=o._parent;c._duration===1/0&&(c._duration=Math.ceil(o._node.duration*10)/10,c._sprite.__default[1]===1/0&&(c._sprite.__default[1]=c._duration*1e3),c._ended(o)),o._node.removeEventListener("ended",o._endFn,!1)}};var a={},s=function(o){var c=o._src;if(a[c]){o._duration=a[c].duration,l(o);return}if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),h=new Uint8Array(d.length),y=0;y<d.length;++y)h[y]=d.charCodeAt(y);f(h.buffer,o)}else{var x=new XMLHttpRequest;x.open(o._xhr.method,c,!0),x.withCredentials=o._xhr.withCredentials,x.responseType="arraybuffer",o._xhr.headers&&Object.keys(o._xhr.headers).forEach(function(v){x.setRequestHeader(v,o._xhr.headers[v])}),x.onload=function(){var v=(x.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){o._emit("loaderror",null,"Failed loading audio file with status: "+x.status+".");return}f(x.response,o)},x.onerror=function(){o._webAudio&&(o._html5=!0,o._webAudio=!1,o._sounds=[],delete a[c],o.load())},u(x)}},u=function(o){try{o.send()}catch{o.onerror()}},f=function(o,c){var d=function(){c._emit("loaderror",null,"Decoding audio data failed.")},h=function(y){y&&c._sounds.length>0?(a[c._src]=y,l(c,y)):d()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(o).then(h).catch(d):e.ctx.decodeAudioData(o,h,d)},l=function(o,c){c&&!o._duration&&(o._duration=c.duration),Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue())},p=function(){if(!!e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var o=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),c=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=c?parseInt(c[1],10):null;if(o&&d&&d<9){var h=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!h&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};r.Howler=e,r.Howl=n,typeof Ue<"u"?(Ue.HowlerGlobal=t,Ue.Howler=e,Ue.Howl=n,Ue.Sound=i):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=n,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var i=n._howls.length-1;i>=0;i--)n._howls[i].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,i){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(n=typeof n!="number"?a._pos[1]:n,i=typeof i!="number"?a._pos[2]:i,typeof e=="number")a._pos=[e,n,i],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(e,n,i,a,s,u){var f=this;if(!f.ctx||!f.ctx.listener)return f;var l=f._orientation;if(n=typeof n!="number"?l[1]:n,i=typeof i!="number"?l[2]:i,a=typeof a!="number"?l[3]:a,s=typeof s!="number"?l[4]:s,u=typeof u!="number"?l[5]:u,typeof e=="number")f._orientation=[e,n,i,a,s,u],typeof f.ctx.listener.forwardX<"u"?(f.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),f.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),f.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),f.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),f.ctx.listener.upY.setTargetAtTime(s,Howler.ctx.currentTime,.1),f.ctx.listener.upZ.setTargetAtTime(u,Howler.ctx.currentTime,.1)):f.ctx.listener.setOrientation(e,n,i,a,s,u);else return l;return f},Howl.prototype.init=function(e){return function(n){var i=this;return i._orientation=n.orientation||[1,0,0],i._stereo=n.stereo||null,i._pos=n.pos||null,i._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},i._onstereo=n.onstereo?[{fn:n.onstereo}]:[],i._onpos=n.onpos?[{fn:n.onpos}]:[],i._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof e=="number")i._stereo=e,i._pos=[e,0,0];else return i._stereo;for(var s=i._getSoundIds(n),u=0;u<s.length;u++){var f=i._soundById(s[u]);if(f)if(typeof e=="number")f._stereo=e,f._pos=[e,0,0],f._node&&(f._pannerAttr.panningModel="equalpower",(!f._panner||!f._panner.pan)&&t(f,a),a==="spatial"?typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):f._panner.setPosition(e,0,0):f._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",f._id);else return f._stereo}return i},Howl.prototype.pos=function(e,n,i,a){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"pos",action:function(){s.pos(e,n,i,a)}}),s;if(n=typeof n!="number"?0:n,i=typeof i!="number"?-.5:i,typeof a>"u")if(typeof e=="number")s._pos=[e,n,i];else return s._pos;for(var u=s._getSoundIds(a),f=0;f<u.length;f++){var l=s._soundById(u[f]);if(l)if(typeof e=="number")l._pos=[e,n,i],l._node&&((!l._panner||l._panner.pan)&&t(l,"spatial"),typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setPosition(e,n,i)),s._emit("pos",l._id);else return l._pos}return s},Howl.prototype.orientation=function(e,n,i,a){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"orientation",action:function(){s.orientation(e,n,i,a)}}),s;if(n=typeof n!="number"?s._orientation[1]:n,i=typeof i!="number"?s._orientation[2]:i,typeof a>"u")if(typeof e=="number")s._orientation=[e,n,i];else return s._orientation;for(var u=s._getSoundIds(a),f=0;f<u.length;f++){var l=s._soundById(u[f]);if(l)if(typeof e=="number")l._orientation=[e,n,i],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),t(l,"spatial")),typeof l._panner.orientationX<"u"?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setOrientation(e,n,i)),s._emit("orientation",l._id);else return l._orientation}return s},Howl.prototype.pannerAttr=function(){var e=this,n=arguments,i,a,s;if(!e._webAudio)return e;if(n.length===0)return e._pannerAttr;if(n.length===1)if(typeof n[0]=="object")i=n[0],typeof a>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),e._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:e._panningModel});else return s=e._soundById(parseInt(n[0],10)),s?s._pannerAttr:e._pannerAttr;else n.length===2&&(i=n[0],a=parseInt(n[1],10));for(var u=e._getSoundIds(a),f=0;f<u.length;f++)if(s=e._soundById(u[f]),s){var l=s._pannerAttr;l={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:l.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:l.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:l.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:l.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:l.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:l.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:l.panningModel};var p=s._panner;p?(p.coneInnerAngle=l.coneInnerAngle,p.coneOuterAngle=l.coneOuterAngle,p.coneOuterGain=l.coneOuterGain,p.distanceModel=l.distanceModel,p.maxDistance=l.maxDistance,p.refDistance=l.refDistance,p.rolloffFactor=l.rolloffFactor,p.panningModel=l.panningModel):(s._pos||(s._pos=e._pos||[0,0,-.5]),t(s,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var n=this,i=n._parent;n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,e.call(this),n._stereo?i.stereo(n._stereo):n._pos&&i.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,i=n._parent;return n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,n._stereo?i.stereo(n._stereo):n._pos?i.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,i._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var t=function(e,n){n=n||"spatial",n==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(Qe);class xi{constructor(){ye(this,"diceSound",new Qe.Howl({src:["dice.mp3"]}));ye(this,"clickSound",new Qe.Howl({src:["click.mp3"]}));ye(this,"tadaSound",new Qe.Howl({src:["tada.mp3"]}));ye(this,"destroySound",new Qe.Howl({src:["destroy.ogg"]}))}playDice(){this.diceSound.play()}playClick(){this.clickSound.play()}playTada(){this.tadaSound.play()}playDestroy(){this.destroySound.play()}}const _t=new xi;function Si(r,t,e){return Object.assign(new Array(t).fill(null).map(()=>e()),r)}function Ci(r,t){return Math.floor(Math.random()*(t-r+1)+r)}function mn(){return Ci(1,6)}const it=(r=null)=>({id:Ti(),removing:!1,value:r}),Lt=()=>[it(),it(),it()],vt=()=>[Lt(),Lt(),Lt()];function st(r){return r.filter(t=>t.value!==null).map(t=>t.value*r.filter(e=>e.value===t.value).length).reduce((t,e)=>t+e,0)}function ze(r){return r.reduce((t,e)=>t+st(e),0)}function dr(r){return r.every(Et)}function Xe(r){return r===1?2:1}function Et(r){return r.every(t=>t.value!==null)}let ki=0;function Ti(){return++ki}function Rt(r,t){return t.filter(e=>e.value===r.value).length>1}function At(r){return r===1?"\u{1F984}":"\u{1F43C}"}class Pi{constructor(t){ye(this,"state",hn({type:"init"}));ye(this,"player");ye(this,"competitor");ye(this,"firstPlayerMove",1);this.player=t,this.competitor=Xe(t)}startGame(){this.state.set({type:"playing",boards:{1:vt(),2:vt()},currentMove:this.firstPlayerMove,dice:null,pause:!1})}action(t){switch(t.type){case"DICE":return this.setDice(t.value);case"GAME":return this.makeTurn(t.line);case"RESET":return this.resetGame();default:return!1}}makeTurn(t){const e=rt(this.state);if(e.type!=="playing")return!1;const{dice:n,currentMove:i,boards:a}=e;if(!n||Et(a[i][t]))return!1;const s={...a},u=Xe(i),f=s[i][t],l=s[u][t],p=f.findIndex(o=>o.value===null);if(f[p]=it(n),_t.playClick(),l.filter(o=>o.value===n).length&&(l.filter(o=>o.value===n).forEach(o=>{o.removing=!0}),_t.playDestroy(),setTimeout(()=>{s[u][t]=Si(l.filter(o=>o.value!==n),3,it),this.state.update(o=>o.type==="playing"?{...o,boards:s}:o)},1500)),this.checkEnd(s)){const o=this.getEndResult(s);this.state.set({type:"end",result:o,boards:s}),o==="win"&&_t.playTada()}else this.state.update(o=>({...o,boards:s,currentMove:Xe(i),dice:null}));return!0}setDice(t){return rt(this.state).type!=="playing"?!1:(this.state.update(n=>({...n,dice:t,pause:!0})),_t.playDice(),setTimeout(()=>{this.state.update(n=>({...n,pause:!1}))},1500),!0)}resetGame(){return rt(this.state).type!=="end"?!1:(this.state.set({type:"playing",boards:{1:vt(),2:vt()},currentMove:Xe(this.firstPlayerMove),dice:null,pause:!1}),this.firstPlayerMove=Xe(this.firstPlayerMove),!0)}checkEnd(t){return dr(t[1])||dr(t[2])}getEndResult(t){const e=ze(t[this.player]),n=ze(t[this.competitor]);return e===n?"draw":e>n?"win":"lose"}}const Ei="/knucklebones/assets/dice-1.ef65f48b.svg",Ri="/knucklebones/assets/dice-2.0fc66d7c.svg",Ai="/knucklebones/assets/dice-3.89a50367.svg",Oi="/knucklebones/assets/dice-4.d55f5abd.svg",Mi="/knucklebones/assets/dice-5.b27f5ebd.svg",Ii="/knucklebones/assets/dice-6.2867bcc8.svg";function Di(r){let t,e;return{c(){t=j("div"),P(t,"class",e=ne(`dice empty ${r[1]}`)+" svelte-oef3kg")},m(n,i){N(n,t,i)},p(n,i){i&2&&e!==(e=ne(`dice empty ${n[1]}`)+" svelte-oef3kg")&&P(t,"class",e)},d(n){n&&$(t)}}}function wi(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Ii)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 6"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function Bi(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Mi)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 5"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function ji(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Oi)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 4"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function Li(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Ai)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 3"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function Fi(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Ri)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 2"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function $i(r){let t,e,n;return{c(){t=j("img"),Me(t.src,e=Ei)||P(t,"src",e),P(t,"class",n=ne(`dice ${r[1]}`)+" svelte-oef3kg"),P(t,"alt","Dice 1"),Q(t,"removing",r[2]),Q(t,"doubled",r[3])},m(i,a){N(i,t,a)},p(i,a){a&2&&n!==(n=ne(`dice ${i[1]}`)+" svelte-oef3kg")&&P(t,"class",n),a&6&&Q(t,"removing",i[2]),a&10&&Q(t,"doubled",i[3])},d(i){i&&$(t)}}}function Ni(r){let t;function e(a,s){return a[0]===1?$i:a[0]===2?Fi:a[0]===3?Li:a[0]===4?ji:a[0]===5?Bi:a[0]===6?wi:Di}let n=e(r),i=n(r);return{c(){i.c(),t=Ne()},m(a,s){i.m(a,s),N(a,t,s)},p(a,[s]){n===(n=e(a))&&i?i.p(a,s):(i.d(1),i=n(a),i&&(i.c(),i.m(t.parentNode,t)))},i:W,o:W,d(a){i.d(a),a&&$(t)}}}function Gi(r,t,e){let{value:n}=t,{side:i}=t,{removing:a=!1}=t,{doubled:s=!1}=t;return r.$$set=u=>{"value"in u&&e(0,n=u.value),"side"in u&&e(1,i=u.side),"removing"in u&&e(2,a=u.removing),"doubled"in u&&e(3,s=u.doubled)},[n,i,a,s]}class we extends je{constructor(t){super(),Be(this,t,Gi,Ni,Ie,{value:0,side:1,removing:2,doubled:3})}}function pr(r){let t,e,n,i,a,s,u,f,l,p,o,c,d,h,y,x,v,C,A,I;return n=new we({props:{value:1,side:"none"}}),s=new we({props:{value:2,side:"none"}}),l=new we({props:{value:3,side:"none"}}),c=new we({props:{value:4,side:"none"}}),y=new we({props:{value:5,side:"none"}}),C=new we({props:{value:6,side:"none"}}),{c(){t=j("div"),e=j("div"),ve(n.$$.fragment),i=Y(),a=j("div"),ve(s.$$.fragment),u=Y(),f=j("div"),ve(l.$$.fragment),p=Y(),o=j("div"),ve(c.$$.fragment),d=Y(),h=j("div"),ve(y.$$.fragment),x=Y(),v=j("div"),ve(C.$$.fragment),P(e,"class","side one svelte-1odaak4"),P(a,"class","side two svelte-1odaak4"),P(f,"class","side three svelte-1odaak4"),P(o,"class","side four svelte-1odaak4"),P(h,"class","side five svelte-1odaak4"),P(v,"class","side six svelte-1odaak4"),P(t,"class",A=ne(`dice show-${r[0]}`)+" svelte-1odaak4")},m(E,B){N(E,t,B),M(t,e),de(n,e,null),M(t,i),M(t,a),de(s,a,null),M(t,u),M(t,f),de(l,f,null),M(t,p),M(t,o),de(c,o,null),M(t,d),M(t,h),de(y,h,null),M(t,x),M(t,v),de(C,v,null),I=!0},p(E,B){(!I||B&1&&A!==(A=ne(`dice show-${E[0]}`)+" svelte-1odaak4"))&&P(t,"class",A)},i(E){I||(V(n.$$.fragment,E),V(s.$$.fragment,E),V(l.$$.fragment,E),V(c.$$.fragment,E),V(y.$$.fragment,E),V(C.$$.fragment,E),I=!0)},o(E){X(n.$$.fragment,E),X(s.$$.fragment,E),X(l.$$.fragment,E),X(c.$$.fragment,E),X(y.$$.fragment,E),X(C.$$.fragment,E),I=!1},d(E){E&&$(t),pe(n),pe(s),pe(l),pe(c),pe(y),pe(C)}}}function Ui(r){let t,e,n=r[0]&&pr(r);return{c(){n&&n.c(),t=Ne()},m(i,a){n&&n.m(i,a),N(i,t,a),e=!0},p(i,[a]){i[0]?n?(n.p(i,a),a&1&&V(n,1)):(n=pr(i),n.c(),V(n,1),n.m(t.parentNode,t)):n&&(Te(),X(n,1,1,()=>{n=null}),Pe())},i(i){e||(V(n),e=!0)},o(i){X(n),e=!1},d(i){n&&n.d(i),i&&$(t)}}}function zi(r,t,e){let{value:n}=t;return r.$$set=i=>{"value"in i&&e(0,n=i.value)},[n]}class Vi extends je{constructor(t){super(),Be(this,t,zi,Ui,Ie,{value:0})}}function Qt(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function hr(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Zt(r,t,e){return t&&hr(r.prototype,t),e&&hr(r,e),r}function mr(r){return+r.replace(/px/,"")}function Hi(r){var t=window.devicePixelRatio,e=getComputedStyle(r),n=mr(e.getPropertyValue("width")),i=mr(e.getPropertyValue("height"));r.setAttribute("width",(n*t).toString()),r.setAttribute("height",(i*t).toString())}function be(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Math.random()*(t-r)+r;return Math.floor(n*Math.pow(10,e))/Math.pow(10,e)}function _r(r){return r[be(0,r.length)]}var qi=.00125,Ji=5e-4,Xi=9e-4,Wi=1e-5,Yi=6,Ki=80,Qi=.9,Zi=1.7,eo=.2,to=.6,ro=.03,no=.07,vr=15,gr=82,io=150,oo=100,ao=250,so=40,co=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function yr(r){var t=1920;return Math.log(r)/Math.log(t)}var br=function(){function r(t){Qt(this,r);var e=t.initialPosition,n=t.direction,i=t.confettiRadius,a=t.confettiColors,s=t.emojis,u=t.emojiSize,f=t.canvasWidth,l=be(Qi,Zi,3),p=l*yr(f);this.confettiSpeed={x:p,y:p},this.finalConfettiSpeedX=be(eo,to,3),this.rotationSpeed=s.length?.01:be(ro,no,3)*yr(f),this.dragForceCoefficient=be(Ji,Xi,6),this.radius={x:i,y:i},this.initialRadius=i,this.rotationAngle=n==="left"?be(0,.2,3):be(-.2,0,3),this.emojiSize=u,this.emojiRotationAngle=be(0,2*Math.PI),this.radiusYUpdateDirection="down";var o=n==="left"?be(gr,vr)*Math.PI/180:be(-vr,-gr)*Math.PI/180;this.absCos=Math.abs(Math.cos(o)),this.absSin=Math.abs(Math.sin(o));var c=be(-io,0),d={x:e.x+(n==="left"?-c:c)*this.absCos,y:e.y-c*this.absSin};this.currentPosition=Object.assign({},d),this.initialPosition=Object.assign({},d),this.color=s.length?null:_r(a),this.emoji=s.length?_r(s):null,this.createdAt=new Date().getTime(),this.direction=n}return Zt(r,[{key:"draw",value:function(e){var n=this.currentPosition,i=this.radius,a=this.color,s=this.emoji,u=this.rotationAngle,f=this.emojiRotationAngle,l=this.emojiSize,p=window.devicePixelRatio;a?(e.fillStyle=a,e.beginPath(),e.ellipse(n.x*p,n.y*p,i.x*p,i.y*p,u,0,2*Math.PI),e.fill()):s&&(e.font="".concat(l,"px serif"),e.save(),e.translate(p*n.x,p*n.y),e.rotate(f),e.textAlign="center",e.fillText(s,0,0),e.restore())}},{key:"updatePosition",value:function(e,n){var i=this.confettiSpeed,a=this.dragForceCoefficient,s=this.finalConfettiSpeedX,u=this.radiusYUpdateDirection,f=this.rotationSpeed,l=this.createdAt,p=this.direction,o=n-l;if(i.x>s&&(this.confettiSpeed.x-=a*e),this.currentPosition.x+=i.x*(p==="left"?-this.absCos:this.absCos)*e,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*o+qi*Math.pow(o,2)/2,this.rotationSpeed-=this.emoji?1e-4:Wi*e,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji){this.emojiRotationAngle+=this.rotationSpeed*e%(2*Math.PI);return}u==="down"?(this.radius.y-=e*f,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=e*f,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(e){return this.currentPosition.y<e+oo}}]),r}();function lo(){var r=document.createElement("canvas");return r.style.position="fixed",r.style.width="100%",r.style.height="100%",r.style.top="0",r.style.left="0",r.style.zIndex="1000",r.style.pointerEvents="none",document.body.appendChild(r),r}function fo(r){var t=r.confettiRadius,e=t===void 0?Yi:t,n=r.confettiNumber,i=n===void 0?r.confettiesNumber||(r.emojis?so:ao):n,a=r.confettiColors,s=a===void 0?co:a,u=r.emojis,f=u===void 0?r.emojies||[]:u,l=r.emojiSize,p=l===void 0?Ki:l;return r.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),r.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:e,confettiNumber:i,confettiColors:s,emojis:f,emojiSize:p}}var uo=function(){function r(t){var e=this;Qt(this,r),this.canvasContext=t,this.shapes=[],this.promise=new Promise(function(n){return e.resolvePromise=n})}return Zt(r,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var e;(e=this.shapes).push.apply(e,arguments)}},{key:"complete",value:function(){var e;return this.shapes.length?!1:((e=this.resolvePromise)===null||e===void 0||e.call(this),!0)}},{key:"processShapes",value:function(e,n,i){var a=this,s=e.timeDelta,u=e.currentTime;this.shapes=this.shapes.filter(function(f){return f.updatePosition(s,u),f.draw(a.canvasContext),i?f.getIsVisibleOnCanvas(n):!0})}}]),r}(),po=function(){function r(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Qt(this,r),this.activeConfettiBatches=[],this.canvas=t.canvas||lo(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=new Date().getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return Zt(r,[{key:"loop",value:function(){this.requestAnimationFrameRequested=!1,Hi(this.canvas);var e=new Date().getTime(),n=e-this.lastUpdated,i=this.canvas.offsetHeight,a=this.iterationIndex%10===0;this.activeConfettiBatches=this.activeConfettiBatches.filter(function(s){return s.processShapes({timeDelta:n,currentTime:e},i,a),a?!s.complete():!0}),this.iterationIndex++,this.queueAnimationFrameIfNeeded(e)}},{key:"queueAnimationFrameIfNeeded",value:function(e){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=e||new Date().getTime(),requestAnimationFrame(this.loop))}},{key:"addConfetti",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=fo(e),i=n.confettiRadius,a=n.confettiNumber,s=n.confettiColors,u=n.emojis,f=n.emojiSize,l=this.canvas.getBoundingClientRect(),p=l.width,o=l.height,c=o*5/7,d={x:0,y:c},h={x:p,y:c},y=new uo(this.canvasContext),x=0;x<a/2;x++){var v=new br({initialPosition:d,direction:"right",confettiRadius:i,confettiColors:s,confettiNumber:a,emojis:u,emojiSize:f,canvasWidth:p}),C=new br({initialPosition:h,direction:"left",confettiRadius:i,confettiColors:s,confettiNumber:a,emojis:u,emojiSize:f,canvasWidth:p});y.addShapes(v,C)}return this.activeConfettiBatches.push(y),this.queueAnimationFrameIfNeeded(),y.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}}]),r}();function xr(r,t,e){const n=r.slice();return n[13]=t[e],n[15]=e,n}function Sr(r,t,e){const n=r.slice();return n[16]=t[e],n}function Cr(r,t,e){const n=r.slice();return n[13]=t[e],n}function kr(r,t,e){const n=r.slice();return n[16]=t[e],n}function Tr(r){let t,e,n,i,a,s,u,f=ze(r[1].boards[r[5]])+"",l,p,o,c,d,h,y,x,v=ze(r[1].boards[r[4]])+"",C,A,I,E,B,U,w=r[1].boards[r[5]],D=[];for(let O=0;O<w.length;O+=1)D[O]=Er(Cr(r,w,O));const G=O=>X(D[O],1,1,()=>{D[O]=null}),Ce=[mo,ho],re=[];function te(O,z){return O[1].type==="playing"?0:O[1].type==="end"?1:-1}~(c=te(r))&&(d=re[c]=Ce[c](r));let Z=r[1].boards[r[4]],q=[];for(let O=0;O<Z.length;O+=1)q[O]=Ir(xr(r,Z,O));const me=O=>X(q[O],1,1,()=>{q[O]=null});return{c(){t=j("div"),e=j("h2"),e.textContent=`${At(r[5])} Player #${r[5]}`,n=Y(),i=j("div");for(let O=0;O<D.length;O+=1)D[O].c();a=Y(),s=j("h2"),u=fe("Score: "),l=fe(f),p=Y(),o=j("div"),d&&d.c(),h=Y(),y=j("h2"),x=fe("Score: "),C=fe(v),A=Y(),I=j("div");for(let O=0;O<q.length;O+=1)q[O].c();E=Y(),B=j("h2"),B.textContent=`${At(r[4])} Player #${r[4]}`,P(e,"class","player-info competitor svelte-1vgezg3"),Q(e,"turn",!r[0]),P(i,"class","board svelte-1vgezg3"),P(s,"class","points svelte-1vgezg3"),P(o,"class","state svelte-1vgezg3"),P(y,"class","points svelte-1vgezg3"),P(I,"class","board svelte-1vgezg3"),P(B,"class","player-info player svelte-1vgezg3"),Q(B,"turn",r[0]),P(t,"class","container svelte-1vgezg3")},m(O,z){N(O,t,z),M(t,e),M(t,n),M(t,i);for(let se=0;se<D.length;se+=1)D[se].m(i,null);M(t,a),M(t,s),M(s,u),M(s,l),M(t,p),M(t,o),~c&&re[c].m(o,null),M(t,h),M(t,y),M(y,x),M(y,C),M(t,A),M(t,I);for(let se=0;se<q.length;se+=1)q[se].m(I,null);M(t,E),M(t,B),U=!0},p(O,z){if((!U||z&1)&&Q(e,"turn",!O[0]),z&34){w=O[1].boards[O[5]];let H;for(H=0;H<w.length;H+=1){const ge=Cr(O,w,H);D[H]?(D[H].p(ge,z),V(D[H],1)):(D[H]=Er(ge),D[H].c(),V(D[H],1),D[H].m(i,null))}for(Te(),H=w.length;H<D.length;H+=1)G(H);Pe()}(!U||z&2)&&f!==(f=ze(O[1].boards[O[5]])+"")&&Se(l,f);let se=c;if(c=te(O),c===se?~c&&re[c].p(O,z):(d&&(Te(),X(re[se],1,1,()=>{re[se]=null}),Pe()),~c?(d=re[c],d?d.p(O,z):(d=re[c]=Ce[c](O),d.c()),V(d,1),d.m(o,null)):d=null),(!U||z&2)&&v!==(v=ze(O[1].boards[O[4]])+"")&&Se(C,v),z&86){Z=O[1].boards[O[4]];let H;for(H=0;H<Z.length;H+=1){const ge=xr(O,Z,H);q[H]?(q[H].p(ge,z),V(q[H],1)):(q[H]=Ir(ge),q[H].c(),V(q[H],1),q[H].m(I,null))}for(Te(),H=Z.length;H<q.length;H+=1)me(H);Pe()}(!U||z&1)&&Q(B,"turn",O[0])},i(O){if(!U){for(let z=0;z<w.length;z+=1)V(D[z]);V(d);for(let z=0;z<Z.length;z+=1)V(q[z]);U=!0}},o(O){D=D.filter(Boolean);for(let z=0;z<D.length;z+=1)X(D[z]);X(d),q=q.filter(Boolean);for(let z=0;z<q.length;z+=1)X(q[z]);U=!1},d(O){O&&$(t),cr(D,O),~c&&re[c].d(),cr(q,O)}}}function Pr(r,t){let e,n,i;return n=new we({props:{value:t[16].value,removing:t[16].removing,doubled:Rt(t[16],t[13]),side:"competitor"}}),{key:r,first:null,c(){e=Ne(),ve(n.$$.fragment),this.first=e},m(a,s){N(a,e,s),de(n,a,s),i=!0},p(a,s){t=a;const u={};s&2&&(u.value=t[16].value),s&2&&(u.removing=t[16].removing),s&2&&(u.doubled=Rt(t[16],t[13])),n.$set(u)},i(a){i||(V(n.$$.fragment,a),i=!0)},o(a){X(n.$$.fragment,a),i=!1},d(a){a&&$(e),pe(n,a)}}}function Er(r){let t,e,n=st(r[13])+"",i,a,s=[],u=new Map,f,l,p=r[13];const o=c=>c[16].id;for(let c=0;c<p.length;c+=1){let d=kr(r,p,c),h=o(d);u.set(h,s[c]=Pr(h,d))}return{c(){t=j("button"),e=j("h2"),i=fe(n),a=Y();for(let c=0;c<s.length;c+=1)s[c].c();f=Y(),P(e,"class","line-points svelte-1vgezg3"),P(t,"class","line line-copmetitor svelte-1vgezg3"),t.disabled=!0},m(c,d){N(c,t,d),M(t,e),M(e,i),M(t,a);for(let h=0;h<s.length;h+=1)s[h].m(t,null);M(t,f),l=!0},p(c,d){(!l||d&2)&&n!==(n=st(c[13])+"")&&Se(i,n),d&34&&(p=c[13],Te(),s=pn(s,d,o,1,c,p,u,t,dn,Pr,f,kr),Pe())},i(c){if(!l){for(let d=0;d<p.length;d+=1)V(s[d]);l=!0}},o(c){for(let d=0;d<s.length;d+=1)X(s[d]);l=!1},d(c){c&&$(t);for(let d=0;d<s.length;d+=1)s[d].d()}}}function ho(r){let t,e,n,i,a,s,u=r[1].result==="win"&&Rr(),f=r[1].result==="lose"&&Ar(),l=r[1].result==="draw"&&Or();return{c(){u&&u.c(),t=Y(),f&&f.c(),e=Y(),l&&l.c(),n=Y(),i=j("button"),i.textContent="\u{1F504} Reset"},m(p,o){u&&u.m(p,o),N(p,t,o),f&&f.m(p,o),N(p,e,o),l&&l.m(p,o),N(p,n,o),N(p,i,o),a||(s=ft(i,"click",r[7]),a=!0)},p(p,o){p[1].result==="win"?u||(u=Rr(),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),p[1].result==="lose"?f||(f=Ar(),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null),p[1].result==="draw"?l||(l=Or(),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},i:W,o:W,d(p){u&&u.d(p),p&&$(t),f&&f.d(p),p&&$(e),l&&l.d(p),p&&$(n),p&&$(i),a=!1,s()}}}function mo(r){let t,e=At(r[1].currentMove)+"",n,i,a=r[0]?"Your turn":"Opponent's move",s,u,f,l;return f=new Vi({props:{value:r[1].dice}}),{c(){t=j("h2"),n=fe(e),i=Y(),s=fe(a),u=Y(),ve(f.$$.fragment),P(t,"class","svelte-1vgezg3")},m(p,o){N(p,t,o),M(t,n),M(t,i),M(t,s),N(p,u,o),de(f,p,o),l=!0},p(p,o){(!l||o&2)&&e!==(e=At(p[1].currentMove)+"")&&Se(n,e),(!l||o&1)&&a!==(a=p[0]?"Your turn":"Opponent's move")&&Se(s,a);const c={};o&2&&(c.value=p[1].dice),f.$set(c)},i(p){l||(V(f.$$.fragment,p),l=!0)},o(p){X(f.$$.fragment,p),l=!1},d(p){p&&$(t),p&&$(u),pe(f,p)}}}function Rr(r){let t;return{c(){t=j("h2"),t.textContent="\u{1F3C6} You won!",P(t,"class","svelte-1vgezg3")},m(e,n){N(e,t,n)},d(e){e&&$(t)}}}function Ar(r){let t;return{c(){t=j("h2"),t.textContent="\u{1F625} You lose",P(t,"class","svelte-1vgezg3")},m(e,n){N(e,t,n)},d(e){e&&$(t)}}}function Or(r){let t;return{c(){t=j("h2"),t.textContent="\u{1F91D} Draw",P(t,"class","svelte-1vgezg3")},m(e,n){N(e,t,n)},d(e){e&&$(t)}}}function Mr(r,t){let e,n,i;return n=new we({props:{value:t[16].value,removing:t[16].removing,doubled:Rt(t[16],t[13]),side:"player"}}),{key:r,first:null,c(){e=Ne(),ve(n.$$.fragment),this.first=e},m(a,s){N(a,e,s),de(n,a,s),i=!0},p(a,s){t=a;const u={};s&2&&(u.value=t[16].value),s&2&&(u.removing=t[16].removing),s&2&&(u.doubled=Rt(t[16],t[13])),n.$set(u)},i(a){i||(V(n.$$.fragment,a),i=!0)},o(a){X(n.$$.fragment,a),i=!1},d(a){a&&$(e),pe(n,a)}}}function Ir(r){let t,e,n=st(r[13])+"",i,a,s=[],u=new Map,f,l,p,o,c,d=r[13];const h=x=>x[16].id;for(let x=0;x<d.length;x+=1){let v=Sr(r,d,x),C=h(v);u.set(C,s[x]=Mr(C,v))}function y(){return r[9](r[15])}return{c(){t=j("button"),e=j("h2"),i=fe(n),a=Y();for(let x=0;x<s.length;x+=1)s[x].c();f=Y(),P(e,"class","line-points svelte-1vgezg3"),P(t,"class","line svelte-1vgezg3"),t.disabled=l=r[2]||Et(r[13])},m(x,v){N(x,t,v),M(t,e),M(e,i),M(t,a);for(let C=0;C<s.length;C+=1)s[C].m(t,null);M(t,f),p=!0,o||(c=ft(t,"click",y),o=!0)},p(x,v){r=x,(!p||v&2)&&n!==(n=st(r[13])+"")&&Se(i,n),v&18&&(d=r[13],Te(),s=pn(s,v,h,1,r,d,u,t,dn,Mr,f,Sr),Pe()),(!p||v&6&&l!==(l=r[2]||Et(r[13])))&&(t.disabled=l)},i(x){if(!p){for(let v=0;v<d.length;v+=1)V(s[v]);p=!0}},o(x){for(let v=0;v<s.length;v+=1)X(s[v]);p=!1},d(x){x&&$(t);for(let v=0;v<s.length;v+=1)s[v].d();o=!1,c()}}}function _o(r){let t,e,n=(r[1].type==="playing"||r[1].type==="end")&&Tr(r);return{c(){n&&n.c(),t=Ne()},m(i,a){n&&n.m(i,a),N(i,t,a),e=!0},p(i,[a]){i[1].type==="playing"||i[1].type==="end"?n?(n.p(i,a),a&2&&V(n,1)):(n=Tr(i),n.c(),V(n,1),n.m(t.parentNode,t)):n&&(Te(),X(n,1,1,()=>{n=null}),Pe())},i(i){e||(V(n),e=!0)},o(i){X(n),e=!1},d(i){n&&n.d(i),i&&$(t)}}}function vo(r,t,e){let n,i,a,{game:s}=t;const{state:u,player:f,competitor:l}=s;cn(r,u,x=>e(1,a=x));const p=new po,o=di(),c=x=>o("action",x),d=x=>c({type:"GAME",line:x}),h=()=>c({type:"RESET"});Kt(()=>{s.startGame(),f===1&&c({type:"DICE",value:mn()})});const y=x=>d(x);return r.$$set=x=>{"game"in x&&e(8,s=x.game)},r.$$.update=()=>{r.$$.dirty&2&&e(0,n=a.type==="playing"&&f===a.currentMove),r.$$.dirty&3&&e(2,i=a.type!=="playing"||a.pause||!n),r.$$.dirty&2&&a.type==="end"&&a.result==="win"&&p.addConfetti({emojis:["\u{1F308}","\u26A1\uFE0F","\u{1F4A5}","\u2728","\u{1F4AB}","\u{1F338}","\u{1F389}","\u{1F38A}","\u{1F4A9}"]})},[n,a,i,u,f,l,d,h,s,y]}class go extends je{constructor(t){super(),Be(this,t,vo,_o,Ie,{game:8})}}var er={exports:{}};(function(r){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),r.exports.binaryFeatures=t;var e=r.exports.BlobBuilder;typeof window<"u"&&(e=r.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function n(){this._pieces=[],this._parts=[]}n.prototype.append=function(i){typeof i=="number"?this._pieces.push(i):(this.flush(),this._parts.push(i))},n.prototype.flush=function(){if(this._pieces.length>0){var i=new Uint8Array(this._pieces);t.useArrayBufferView||(i=i.buffer),this._parts.push(i),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var i=new e,a=0,s=this._parts.length;a<s;a++)i.append(this._parts[a]);return i.getBlob()}else return new Blob(this._parts)},r.exports.BufferBuilder=n})(er);var yo=er.exports.BufferBuilder,Dr=er.exports.binaryFeatures,bo={unpack:function(r){var t=new oe(r);return t.unpack()},pack:function(r){var t=new ae;t.pack(r);var e=t.getBuffer();return e}},wr=bo;function oe(r){this.index=0,this.dataBuffer=r,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}oe.prototype.unpack=function(){var r=this.unpack_uint8();if(r<128)return r;if((r^224)<32)return(r^224)-32;var t;if((t=r^160)<=15)return this.unpack_raw(t);if((t=r^176)<=15)return this.unpack_string(t);if((t=r^144)<=15)return this.unpack_array(t);if((t=r^128)<=15)return this.unpack_map(t);switch(r){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};oe.prototype.unpack_uint8=function(){var r=this.dataView[this.index]&255;return this.index++,r};oe.prototype.unpack_uint16=function(){var r=this.read(2),t=(r[0]&255)*256+(r[1]&255);return this.index+=2,t};oe.prototype.unpack_uint32=function(){var r=this.read(4),t=((r[0]*256+r[1])*256+r[2])*256+r[3];return this.index+=4,t};oe.prototype.unpack_uint64=function(){var r=this.read(8),t=((((((r[0]*256+r[1])*256+r[2])*256+r[3])*256+r[4])*256+r[5])*256+r[6])*256+r[7];return this.index+=8,t};oe.prototype.unpack_int8=function(){var r=this.unpack_uint8();return r<128?r:r-(1<<8)};oe.prototype.unpack_int16=function(){var r=this.unpack_uint16();return r<32768?r:r-(1<<16)};oe.prototype.unpack_int32=function(){var r=this.unpack_uint32();return r<Math.pow(2,31)?r:r-Math.pow(2,32)};oe.prototype.unpack_int64=function(){var r=this.unpack_uint64();return r<Math.pow(2,63)?r:r-Math.pow(2,64)};oe.prototype.unpack_raw=function(r){if(this.length<this.index+r)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+r+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+r);return this.index+=r,t};oe.prototype.unpack_string=function(r){for(var t=this.read(r),e=0,n="",i,a;e<r;)i=t[e],i<128?(n+=String.fromCharCode(i),e++):(i^192)<32?(a=(i^192)<<6|t[e+1]&63,n+=String.fromCharCode(a),e+=2):(a=(i&15)<<12|(t[e+1]&63)<<6|t[e+2]&63,n+=String.fromCharCode(a),e+=3);return this.index+=r,n};oe.prototype.unpack_array=function(r){for(var t=new Array(r),e=0;e<r;e++)t[e]=this.unpack();return t};oe.prototype.unpack_map=function(r){for(var t={},e=0;e<r;e++){var n=this.unpack(),i=this.unpack();t[n]=i}return t};oe.prototype.unpack_float=function(){var r=this.unpack_uint32(),t=r>>31,e=(r>>23&255)-127,n=r&8388607|8388608;return(t===0?1:-1)*n*Math.pow(2,e-23)};oe.prototype.unpack_double=function(){var r=this.unpack_uint32(),t=this.unpack_uint32(),e=r>>31,n=(r>>20&2047)-1023,i=r&1048575|1048576,a=i*Math.pow(2,n-20)+t*Math.pow(2,n-52);return(e===0?1:-1)*a};oe.prototype.read=function(r){var t=this.index;if(t+r<=this.length)return this.dataView.subarray(t,t+r);throw new Error("BinaryPackFailure: read index out of range")};function ae(){this.bufferBuilder=new yo}ae.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};ae.prototype.pack=function(r){var t=typeof r;if(t==="string")this.pack_string(r);else if(t==="number")Math.floor(r)===r?this.pack_integer(r):this.pack_double(r);else if(t==="boolean")r===!0?this.bufferBuilder.append(195):r===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(r===null)this.bufferBuilder.append(192);else{var e=r.constructor;if(e==Array)this.pack_array(r);else if(e==Blob||e==File||r instanceof Blob||r instanceof File)this.pack_bin(r);else if(e==ArrayBuffer)Dr.useArrayBufferView?this.pack_bin(new Uint8Array(r)):this.pack_bin(r);else if("BYTES_PER_ELEMENT"in r)Dr.useArrayBufferView?this.pack_bin(new Uint8Array(r.buffer)):this.pack_bin(r.buffer);else if(e==Object||e.toString().startsWith("class"))this.pack_object(r);else if(e==Date)this.pack_string(r.toString());else if(typeof r.toBinaryPack=="function")this.bufferBuilder.append(r.toBinaryPack());else throw new Error('Type "'+e.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};ae.prototype.pack_bin=function(r){var t=r.length||r.byteLength||r.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(r)};ae.prototype.pack_string=function(r){var t=So(r);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(r)};ae.prototype.pack_array=function(r){var t=r.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var e=0;e<t;e++)this.pack(r[e])};ae.prototype.pack_integer=function(r){if(r>=-32&&r<=127)this.bufferBuilder.append(r&255);else if(r>=0&&r<=255)this.bufferBuilder.append(204),this.pack_uint8(r);else if(r>=-128&&r<=127)this.bufferBuilder.append(208),this.pack_int8(r);else if(r>=0&&r<=65535)this.bufferBuilder.append(205),this.pack_uint16(r);else if(r>=-32768&&r<=32767)this.bufferBuilder.append(209),this.pack_int16(r);else if(r>=0&&r<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(r);else if(r>=-2147483648&&r<=2147483647)this.bufferBuilder.append(210),this.pack_int32(r);else if(r>=-9223372036854776e3&&r<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(r);else if(r>=0&&r<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(r);else throw new Error("Invalid integer")};ae.prototype.pack_double=function(r){var t=0;r<0&&(t=1,r=-r);var e=Math.floor(Math.log(r)/Math.LN2),n=r/Math.pow(2,e)-1,i=Math.floor(n*Math.pow(2,52)),a=Math.pow(2,32),s=t<<31|e+1023<<20|i/a&1048575,u=i%a;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(u)};ae.prototype.pack_object=function(r){var t=Object.keys(r),e=t.length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(e);else throw new Error("Invalid length");for(var n in r)r.hasOwnProperty(n)&&(this.pack(n),this.pack(r[n]))};ae.prototype.pack_uint8=function(r){this.bufferBuilder.append(r)};ae.prototype.pack_uint16=function(r){this.bufferBuilder.append(r>>8),this.bufferBuilder.append(r&255)};ae.prototype.pack_uint32=function(r){var t=r&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};ae.prototype.pack_uint64=function(r){var t=r/Math.pow(2,32),e=r%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};ae.prototype.pack_int8=function(r){this.bufferBuilder.append(r&255)};ae.prototype.pack_int16=function(r){this.bufferBuilder.append((r&65280)>>8),this.bufferBuilder.append(r&255)};ae.prototype.pack_int32=function(r){this.bufferBuilder.append(r>>>24&255),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255)};ae.prototype.pack_int64=function(r){var t=Math.floor(r/Math.pow(2,32)),e=r%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};function xo(r){var t=r.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function So(r){return r.length>600?new Blob([r]).size:r.replace(/[^\u0000-\u007F]/g,xo).length}let _n=!0,vn=!0;function Ze(r,t,e){const n=r.match(t);return n&&n.length>=e&&parseInt(n[e],10)}function Ve(r,t,e){if(!r.RTCPeerConnection)return;const n=r.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(s,u){if(s!==t)return i.apply(this,arguments);const f=l=>{const p=e(l);p&&(u.handleEvent?u.handleEvent(p):u(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,f),i.apply(this,[s,f])};const a=n.removeEventListener;n.removeEventListener=function(s,u){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(u))return a.apply(this,arguments);const f=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,f])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function Co(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(_n=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function ko(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(vn=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function tr(){if(typeof window=="object"){if(_n)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function It(r,t){!vn||console.warn(r+" is deprecated, please use "+t+" instead.")}function To(r){const t={browser:null,version:null};if(typeof r>"u"||!r.navigator)return t.browser="Not a browser.",t;const{navigator:e}=r;if(e.mozGetUserMedia)t.browser="firefox",t.version=Ze(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection&&!r.RTCIceGatherer)t.browser="chrome",t.version=Ze(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Ze(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(r.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Ze(e.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Br(r){return Object.prototype.toString.call(r)==="[object Object]"}function gn(r){return Br(r)?Object.keys(r).reduce(function(t,e){const n=Br(r[e]),i=n?gn(r[e]):r[e],a=n&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[e]:i})},{}):r}function Ut(r,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?Ut(r,r.get(t[n]),e):n.endsWith("Ids")&&t[n].forEach(i=>{Ut(r,r.get(i),e)})}))}function jr(r,t,e){const n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const a=[];return r.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(s=>{r.forEach(u=>{u.type===n&&u.trackId===s.id&&Ut(r,u,i)})}),i}const Lr=tr;function yn(r,t){const e=r&&r.navigator;if(!e.mediaDevices)return;const n=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const f={};return Object.keys(u).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const p=typeof u[l]=="object"?u[l]:{ideal:u[l]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const o=function(c,d){return c?c+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(p.ideal!==void 0){f.optional=f.optional||[];let c={};typeof p.ideal=="number"?(c[o("min",l)]=p.ideal,f.optional.push(c),c={},c[o("max",l)]=p.ideal,f.optional.push(c)):(c[o("",l)]=p.ideal,f.optional.push(c))}p.exact!==void 0&&typeof p.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[o("",l)]=p.exact):["min","max"].forEach(c=>{p[c]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[o(c,l)]=p[c])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},i=function(u,f){if(t.version>=61)return f(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const l=function(p,o,c){o in p&&!(c in p)&&(p[c]=p[o],delete p[o])};u=JSON.parse(JSON.stringify(u)),l(u.audio,"autoGainControl","googAutoGainControl"),l(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=n(u.audio)}if(u&&typeof u.video=="object"){let l=u.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const p=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete u.video.facingMode;let o;if(l.exact==="environment"||l.ideal==="environment"?o=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(o=["front"]),o)return e.mediaDevices.enumerateDevices().then(c=>{c=c.filter(h=>h.kind==="videoinput");let d=c.find(h=>o.some(y=>h.label.toLowerCase().includes(y)));return!d&&c.length&&o.includes("back")&&(d=c[c.length-1]),d&&(u.video.deviceId=l.exact?{exact:d.deviceId}:{ideal:d.deviceId}),u.video=n(u.video),Lr("chrome: "+JSON.stringify(u)),f(u)})}u.video=n(u.video)}return Lr("chrome: "+JSON.stringify(u)),f(u)},a=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(u,f,l){i(u,p=>{e.webkitGetUserMedia(p,f,o=>{l&&l(a(o))})})};if(e.getUserMedia=s.bind(e),e.mediaDevices.getUserMedia){const u=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(f){return i(f,l=>u(l).then(p=>{if(l.audio&&!p.getAudioTracks().length||l.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(a(p))))}}}function Po(r,t){if(!(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices)&&!!r.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}r.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const a=n.video&&n.video.width,s=n.video&&n.video.height,u=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:u||3}},a&&(n.video.mandatory.maxWidth=a),s&&(n.video.mandatory.maxHeight=s),r.navigator.mediaDevices.getUserMedia(n)})}}}function bn(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function xn(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;r.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(u=>u.track&&u.track.id===i.track.id):a={track:i.track};const s=new Event("track");s.track=i.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let a;r.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(u=>u.track&&u.track.id===i.id):a={track:i};const s=new Event("track");s.track=i,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ve(r,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Sn(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(u,f){let l=i.apply(this,arguments);return l||(l=t(this,u),this._senders.push(l)),l};const a=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(u){a.apply(this,arguments);const f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}const e=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],e.apply(this,[a]),a.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(s=>{const u=this._senders.find(f=>f.track===s);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Cn(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(f){const l={};return f.result().forEach(o=>{const c={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(d=>{c[d]=o.stat(d)}),l[c.id]=c}),l},u=function(f){return new Map(Object.keys(f).map(l=>[l,f[l]]))};if(arguments.length>=2){const f=function(l){i(u(s(l)))};return t.apply(this,[f,n])}return new Promise((f,l)=>{t.apply(this,[function(p){f(u(s(p)))},l])}).then(i,a)}}function kn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const e=r.RTCPeerConnection.prototype.getSenders;e&&(r.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(s=>s._pc=this),a});const n=r.RTCPeerConnection.prototype.addTrack;n&&(r.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),r.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>jr(s,a.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const e=r.RTCPeerConnection.prototype.getReceivers;e&&(r.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Ve(r,"track",n=>(n.receiver._pc=n.srcElement,n)),r.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>jr(a,i.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype))return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const n=arguments[0];let i,a,s;return this.getSenders().forEach(u=>{u.track===n&&(i?s=!0:i=u)}),this.getReceivers().forEach(u=>(u.track===n&&(a?s=!0:a=u),u.track===n)),s||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Tn(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(s,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};const e=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(o=>o.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();e.apply(this,arguments);const f=this.getSenders().filter(l=>u.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(f)};const n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};const i=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const f=this._shimmedLocalStreams[u].indexOf(s);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),i.apply(this,arguments)}}function Pn(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Tn(r);const e=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const p=e.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(o=>this._reverseStreams[o.id])};const n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(o=>{if(this.getSenders().find(d=>d.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const o=new r.MediaStream(p.getTracks());this._streams[p.id]=o,this._reverseStreams[o.id]=p,p=o}n.apply(this,[p])};const i=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},r.RTCPeerConnection.prototype.addTrack=function(p,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const c=[].slice.call(arguments,1);if(c.length!==1||!c[0].getTracks().find(y=>y===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[o.id];if(h)h.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new r.MediaStream([p]);this._streams[o.id]=y,this._reverseStreams[y.id]=o,this.addStream(y)}return this.getSenders().find(y=>y.track===p)};function a(l,p){let o=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(c=>{const d=l._reverseStreams[c],h=l._streams[d.id];o=o.replace(new RegExp(h.id,"g"),d.id)}),new RTCSessionDescription({type:p.type,sdp:o})}function s(l,p){let o=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(c=>{const d=l._reverseStreams[c],h=l._streams[d.id];o=o.replace(new RegExp(d.id,"g"),h.id)}),new RTCSessionDescription({type:p.type,sdp:o})}["createOffer","createAnswer"].forEach(function(l){const p=r.RTCPeerConnection.prototype[l],o={[l](){const c=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[h=>{const y=a(this,h);c[0].apply(null,[y])},h=>{c[1]&&c[1].apply(null,h)},arguments[2]]):p.apply(this,arguments).then(h=>a(this,h))}};r.RTCPeerConnection.prototype[l]=o[l]});const u=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=s(this,arguments[0]),u.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const l=f.get.apply(this);return l.type===""?l:a(this,l)}}),r.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let c;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(y=>p.track===y)&&(c=this._streams[d])}),c&&(c.getTracks().length===1?this.removeStream(this._reverseStreams[c.id]):c.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zt(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),!!r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const n=r.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new(e==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};r.RTCPeerConnection.prototype[e]=i[e]})}function En(r,t){Ve(r,"negotiationneeded",e=>{const n=e.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return e})}const Fr=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:bn,shimOnTrack:xn,shimGetSendersWithDtmf:Sn,shimGetStats:Cn,shimSenderReceiverGetStats:kn,shimAddTrackRemoveTrackWithNative:Tn,shimAddTrackRemoveTrack:Pn,shimPeerConnection:zt,fixNegotiationNeeded:En,shimGetUserMedia:yn,shimGetDisplayMedia:Po},Symbol.toStringTag,{value:"Module"}));function Eo(r,t){let e=!1;return r=JSON.parse(JSON.stringify(r)),r.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&It("RTCIceServer.url","RTCIceServer.urls");const a=typeof i=="string";return a&&(i=[i]),i=i.filter(s=>{if(s.indexOf("stun:")===0)return!1;const u=s.startsWith("turn")&&!s.startsWith("turn:[")&&s.includes("transport=udp");return u&&!e?(e=!0,!0):u&&!e}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}var rr={exports:{}};(function(r){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(function(n){return n.trim()})},t.splitSections=function(e){var n=e.split(`
m=`);return n.map(function(i,a){return(a>0?"m="+i:i).trim()+`\r
`})},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(function(i){return i.indexOf(n)===0})},t.parseCandidate=function(e){var n;e.indexOf("a=candidate:")===0?n=e.substring(12).split(" "):n=e.substring(10).split(" ");for(var i={foundation:n[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},a=8;a<n.length;a+=2)switch(n[a]){case"raddr":i.relatedAddress=n[a+1];break;case"rport":i.relatedPort=parseInt(n[a+1],10);break;case"tcptype":i.tcpType=n[a+1];break;case"ufrag":i.ufrag=n[a+1],i.usernameFragment=n[a+1];break;default:i[n[a]]=n[a+1];break}return i},t.writeCandidate=function(e){var n=[];n.push(e.foundation),n.push(e.component),n.push(e.protocol.toUpperCase()),n.push(e.priority),n.push(e.address||e.ip),n.push(e.port);var i=e.type;return n.push("typ"),n.push(i),i!=="host"&&e.relatedAddress&&e.relatedPort&&(n.push("raddr"),n.push(e.relatedAddress),n.push("rport"),n.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(n.push("ufrag"),n.push(e.usernameFragment||e.ufrag)),"candidate:"+n.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var n=e.substr(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){var n=e.payloadType;e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+n+" "+e.name+"/"+e.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(e){var n=e.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},t.parseFmtp=function(e){for(var n={},i,a=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<a.length;s++)i=a[s].trim().split("="),n[i[0].trim()]=i[1];return n},t.writeFmtp=function(e){var n="",i=e.payloadType;if(e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var a=[];Object.keys(e.parameters).forEach(function(s){e.parameters[s]?a.push(s+"="+e.parameters[s]):a.push(s)}),n+="a=fmtp:"+i+" "+a.join(";")+`\r
`}return n},t.parseRtcpFb=function(e){var n=e.substr(e.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},t.writeRtcpFb=function(e){var n="",i=e.payloadType;return e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(a){n+="a=rtcp-fb:"+i+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),n},t.parseSsrcMedia=function(e){var n=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,n-7),10)},a=e.indexOf(":",n);return a>-1?(i.attribute=e.substr(n+1,a-n-1),i.value=e.substr(a+1)):i.attribute=e.substr(n+1),i},t.parseSsrcGroup=function(e){var n=e.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(i){return parseInt(i,10)})}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var n=e.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},t.getDtlsParameters=function(e,n){var i=t.matchPrefix(e+n,"a=fingerprint:");return{role:"auto",fingerprints:i.map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,n){var i="a=setup:"+n+`\r
`;return e.fingerprints.forEach(function(a){i+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),i},t.parseCryptoLine=function(e){var n=e.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var n=e.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){var i=t.matchPrefix(e+n,"a=crypto:");return i.map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],a=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&a?{usernameFragment:i.substr(12),password:a.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e),a=i[0].split(" "),s=3;s<a.length;s++){var u=a[s],f=t.matchPrefix(e,"a=rtpmap:"+u+" ")[0];if(f){var l=t.parseRtpMap(f),p=t.matchPrefix(e,"a=fmtp:"+u+" ");switch(l.parameters=p.length?t.parseFmtp(p[0]):{},l.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),n.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(l.name.toUpperCase());break}}}return t.matchPrefix(e,"a=extmap:").forEach(function(o){n.headerExtensions.push(t.parseExtmap(o))}),n},t.writeRtpDescription=function(e,n){var i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map(function(s){return s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType}).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(function(s){i+=t.writeRtpMap(s),i+=t.writeFmtp(s),i+=t.writeRtcpFb(s)});var a=0;return n.codecs.forEach(function(s){s.maxptime>a&&(a=s.maxptime)}),a>0&&(i+="a=maxptime:"+a+`\r
`),i+=`a=rtcp-mux\r
`,n.headerExtensions&&n.headerExtensions.forEach(function(s){i+=t.writeExtmap(s)}),i},t.parseRtpEncodingParameters=function(e){var n=[],i=t.parseRtpParameters(e),a=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(e,"a=ssrc:").map(function(c){return t.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"}),f=u.length>0&&u[0].ssrc,l,p=t.matchPrefix(e,"a=ssrc-group:FID").map(function(c){var d=c.substr(17).split(" ");return d.map(function(h){return parseInt(h,10)})});p.length>0&&p[0].length>1&&p[0][0]===f&&(l=p[0][1]),i.codecs.forEach(function(c){if(c.name.toUpperCase()==="RTX"&&c.parameters.apt){var d={ssrc:f,codecPayloadType:parseInt(c.parameters.apt,10)};f&&l&&(d.rtx={ssrc:l}),n.push(d),a&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:f,mechanism:s?"red+ulpfec":"red"},n.push(d))}}),n.length===0&&f&&n.push({ssrc:f});var o=t.matchPrefix(e,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substr(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substr(5),10)*1e3*.95-50*40*8:o=void 0,n.forEach(function(c){c.maxBitrate=o})),n},t.parseRtcpParameters=function(e){var n={},i=t.matchPrefix(e,"a=ssrc:").map(function(u){return t.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var a=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=a.length>0,n.compound=a.length===0;var s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.parseMsid=function(e){var n,i=t.matchPrefix(e,"a=msid:");if(i.length===1)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};var a=t.matchPrefix(e,"a=ssrc:").map(function(s){return t.parseSsrcMedia(s)}).filter(function(s){return s.attribute==="msid"});if(a.length>0)return n=a[0].value.split(" "),{stream:n[0],track:n[1]}},t.parseSctpDescription=function(e){var n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:"),a;i.length>0&&(a=parseInt(i[0].substr(19),10)),isNaN(a)&&(a=65536);var s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:a};var u=t.matchPrefix(e,"a=sctpmap:");if(u.length>0){var f=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:a}}},t.writeSctpDescription=function(e,n){var i=[];return e.protocol!=="DTLS/SCTP"?i=["m="+e.kind+" 9 "+e.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:i=["m="+e.kind+" 9 "+e.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){var a,s=n!==void 0?n:2;e?a=e:a=t.generateSessionId();var u=i||"thisisadapterortc";return`v=0\r
o=`+u+" "+a+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(e,n,i,a){var s=t.writeRtpDescription(e.kind,n);if(s+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":"active"),s+="a=mid:"+e.mid+`\r
`,e.direction?s+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?s+=`a=sendrecv\r
`:e.rtpSender?s+=`a=sendonly\r
`:e.rtpReceiver?s+=`a=recvonly\r
`:s+=`a=inactive\r
`,e.rtpSender){var u="msid:"+a.id+" "+e.rtpSender.track.id+`\r
`;s+="a="+u,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+u,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+u,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),s},t.getDirection=function(e,n){for(var i=t.splitLines(e),a=0;a<i.length;a++)switch(i[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[a].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){var n=t.splitLines(e),i=n[0].split(" ");return i[0].substr(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){var n=t.splitLines(e),i=n[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0],i=n.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var n=t.splitLines(e),i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},r.exports=t})(rr);const Ct=rr.exports;var F=rr.exports;function Ro(r){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[r.type]||r.type}function $r(r,t,e,n,i){var a=F.writeRtpDescription(r.kind,t);if(a+=F.writeIceParameters(r.iceGatherer.getLocalParameters()),a+=F.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":i||"active"),a+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?a+=`a=sendrecv\r
`:r.rtpSender?a+=`a=sendonly\r
`:r.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,r.rtpSender){var s=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=s;var u="msid:"+(n?n.id:"-")+" "+s+`\r
`;a+="a="+u,a+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+u,r.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+u,a+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+F.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+F.localCName+`\r
`),a}function Ao(r,t){var e=!1;return r=JSON.parse(JSON.stringify(r)),r.filter(function(n){if(n&&(n.urls||n.url)){var i=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var a=typeof i=="string";return a&&(i=[i]),i=i.filter(function(s){var u=s.indexOf("turn:")===0&&s.indexOf("transport=udp")!==-1&&s.indexOf("turn:[")===-1&&!e;return u?(e=!0,!0):s.indexOf("stun:")===0&&t>=14393&&s.indexOf("?transport=udp")===-1}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}function gt(r,t){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(a,s){a=parseInt(a,10);for(var u=0;u<s.length;u++)if(s[u].payloadType===a||s[u].preferredPayloadType===a)return s[u]},i=function(a,s,u,f){var l=n(a.parameters.apt,u),p=n(s.parameters.apt,f);return l&&p&&l.name.toLowerCase()===p.name.toLowerCase()};return r.codecs.forEach(function(a){for(var s=0;s<t.codecs.length;s++){var u=t.codecs[s];if(a.name.toLowerCase()===u.name.toLowerCase()&&a.clockRate===u.clockRate){if(a.name.toLowerCase()==="rtx"&&a.parameters&&u.parameters.apt&&!i(a,u,r.codecs,t.codecs))continue;u=JSON.parse(JSON.stringify(u)),u.numChannels=Math.min(a.numChannels,u.numChannels),e.codecs.push(u),u.rtcpFeedback=u.rtcpFeedback.filter(function(f){for(var l=0;l<a.rtcpFeedback.length;l++)if(a.rtcpFeedback[l].type===f.type&&a.rtcpFeedback[l].parameter===f.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(a){for(var s=0;s<t.headerExtensions.length;s++){var u=t.headerExtensions[s];if(a.uri===u.uri){e.headerExtensions.push(u);break}}}),e}function Nr(r,t,e){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][r].indexOf(e)!==-1}function Ft(r,t){var e=r.getRemoteCandidates().find(function(n){return t.foundation===n.foundation&&t.ip===n.ip&&t.port===n.port&&t.priority===n.priority&&t.protocol===n.protocol&&t.type===n.type});return e||r.addRemoteCandidate(t),!e}function le(r,t){var e=new Error(t);return e.name=r,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],e}var Oo=function(r,t){function e(f,l){l.addTrack(f),l.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:f}))}function n(f,l){l.removeTrack(f),l.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:f}))}function i(f,l,p,o){var c=new Event("track");c.track=l,c.receiver=p,c.transceiver={receiver:p},c.streams=o,r.setTimeout(function(){f._dispatchEvent("track",c)})}var a=function(f){var l=this,p=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(c){l[c]=p[c].bind(p)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",f=JSON.parse(JSON.stringify(f||{})),this.usingBundle=f.bundlePolicy==="max-bundle",f.rtcpMuxPolicy==="negotiate")throw le("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require"),f.iceTransportPolicy){case"all":case"relay":break;default:f.iceTransportPolicy="all";break}switch(f.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:f.bundlePolicy="balanced";break}if(f.iceServers=Ao(f.iceServers||[],t),this._iceGatherers=[],f.iceCandidatePoolSize)for(var o=f.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy}));else f.iceCandidatePoolSize=0;this._config=f,this.transceivers=[],this._sdpSessionId=F.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(a.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(a.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),a.prototype.onicecandidate=null,a.prototype.onaddstream=null,a.prototype.ontrack=null,a.prototype.onremovestream=null,a.prototype.onsignalingstatechange=null,a.prototype.oniceconnectionstatechange=null,a.prototype.onconnectionstatechange=null,a.prototype.onicegatheringstatechange=null,a.prototype.onnegotiationneeded=null,a.prototype.ondatachannel=null,a.prototype._dispatchEvent=function(f,l){this._isClosed||(this.dispatchEvent(l),typeof this["on"+f]=="function"&&this["on"+f](l))},a.prototype._emitGatheringStateChange=function(){var f=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",f)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(f,l){var p=this.transceivers.length>0,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:f,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&p)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var c=this._createIceAndDtlsTransports();o.iceTransport=c.iceTransport,o.dtlsTransport=c.dtlsTransport}return l||this.transceivers.push(o),o},a.prototype.addTrack=function(f,l){if(this._isClosed)throw le("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var p=this.transceivers.find(function(d){return d.track===f});if(p)throw le("InvalidAccessError","Track already exists.");for(var o,c=0;c<this.transceivers.length;c++)!this.transceivers[c].track&&this.transceivers[c].kind===f.kind&&(o=this.transceivers[c]);return o||(o=this._createTransceiver(f.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(l)===-1&&this.localStreams.push(l),o.track=f,o.stream=l,o.rtpSender=new r.RTCRtpSender(f,o.dtlsTransport),o.rtpSender},a.prototype.addStream=function(f){var l=this;if(t>=15025)f.getTracks().forEach(function(o){l.addTrack(o,f)});else{var p=f.clone();f.getTracks().forEach(function(o,c){var d=p.getTracks()[c];o.addEventListener("enabled",function(h){d.enabled=h.enabled})}),p.getTracks().forEach(function(o){l.addTrack(o,p)})}},a.prototype.removeTrack=function(f){if(this._isClosed)throw le("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(f instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var l=this.transceivers.find(function(c){return c.rtpSender===f});if(!l)throw le("InvalidAccessError","Sender was not created by this connection.");var p=l.stream;l.rtpSender.stop(),l.rtpSender=null,l.track=null,l.stream=null;var o=this.transceivers.map(function(c){return c.stream});o.indexOf(p)===-1&&this.localStreams.indexOf(p)>-1&&this.localStreams.splice(this.localStreams.indexOf(p),1),this._maybeFireNegotiationNeeded()},a.prototype.removeStream=function(f){var l=this;f.getTracks().forEach(function(p){var o=l.getSenders().find(function(c){return c.track===p});o&&l.removeTrack(o)})},a.prototype.getSenders=function(){return this.transceivers.filter(function(f){return!!f.rtpSender}).map(function(f){return f.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(f){return!!f.rtpReceiver}).map(function(f){return f.rtpReceiver})},a.prototype._createIceGatherer=function(f,l){var p=this;if(l&&f>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[f].bufferedCandidateEvents=[],this.transceivers[f].bufferCandidates=function(c){var d=!c.candidate||Object.keys(c.candidate).length===0;o.state=d?"completed":"gathering",p.transceivers[f].bufferedCandidateEvents!==null&&p.transceivers[f].bufferedCandidateEvents.push(c)},o.addEventListener("localcandidate",this.transceivers[f].bufferCandidates),o},a.prototype._gather=function(f,l){var p=this,o=this.transceivers[l].iceGatherer;if(!o.onlocalcandidate){var c=this.transceivers[l].bufferedCandidateEvents;this.transceivers[l].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[l].bufferCandidates),o.onlocalcandidate=function(d){if(!(p.usingBundle&&l>0)){var h=new Event("icecandidate");h.candidate={sdpMid:f,sdpMLineIndex:l};var y=d.candidate,x=!y||Object.keys(y).length===0;if(x)(o.state==="new"||o.state==="gathering")&&(o.state="completed");else{o.state==="new"&&(o.state="gathering"),y.component=1,y.ufrag=o.getLocalParameters().usernameFragment;var v=F.writeCandidate(y);h.candidate=Object.assign(h.candidate,F.parseCandidate(v)),h.candidate.candidate=v,h.candidate.toJSON=function(){return{candidate:h.candidate.candidate,sdpMid:h.candidate.sdpMid,sdpMLineIndex:h.candidate.sdpMLineIndex,usernameFragment:h.candidate.usernameFragment}}}var C=F.getMediaSections(p._localDescription.sdp);x?C[h.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:C[h.candidate.sdpMLineIndex]+="a="+h.candidate.candidate+`\r
`,p._localDescription.sdp=F.getDescription(p._localDescription.sdp)+C.join("");var A=p.transceivers.every(function(I){return I.iceGatherer&&I.iceGatherer.state==="completed"});p.iceGatheringState!=="gathering"&&(p.iceGatheringState="gathering",p._emitGatheringStateChange()),x||p._dispatchEvent("icecandidate",h),A&&(p._dispatchEvent("icecandidate",new Event("icecandidate")),p.iceGatheringState="complete",p._emitGatheringStateChange())}},r.setTimeout(function(){c.forEach(function(d){o.onlocalcandidate(d)})},0)}},a.prototype._createIceAndDtlsTransports=function(){var f=this,l=new r.RTCIceTransport(null);l.onicestatechange=function(){f._updateIceConnectionState(),f._updateConnectionState()};var p=new r.RTCDtlsTransport(l);return p.ondtlsstatechange=function(){f._updateConnectionState()},p.onerror=function(){Object.defineProperty(p,"state",{value:"failed",writable:!0}),f._updateConnectionState()},{iceTransport:l,dtlsTransport:p}},a.prototype._disposeIceAndDtlsTransports=function(f){var l=this.transceivers[f].iceGatherer;l&&(delete l.onlocalcandidate,delete this.transceivers[f].iceGatherer);var p=this.transceivers[f].iceTransport;p&&(delete p.onicestatechange,delete this.transceivers[f].iceTransport);var o=this.transceivers[f].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[f].dtlsTransport)},a.prototype._transceive=function(f,l,p){var o=gt(f.localCapabilities,f.remoteCapabilities);l&&f.rtpSender&&(o.encodings=f.sendEncodingParameters,o.rtcp={cname:F.localCName,compound:f.rtcpParameters.compound},f.recvEncodingParameters.length&&(o.rtcp.ssrc=f.recvEncodingParameters[0].ssrc),f.rtpSender.send(o)),p&&f.rtpReceiver&&o.codecs.length>0&&(f.kind==="video"&&f.recvEncodingParameters&&t<15019&&f.recvEncodingParameters.forEach(function(c){delete c.rtx}),f.recvEncodingParameters.length?o.encodings=f.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:f.rtcpParameters.compound},f.rtcpParameters.cname&&(o.rtcp.cname=f.rtcpParameters.cname),f.sendEncodingParameters.length&&(o.rtcp.ssrc=f.sendEncodingParameters[0].ssrc),f.rtpReceiver.receive(o))},a.prototype.setLocalDescription=function(f){var l=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(le("TypeError",'Unsupported type "'+f.type+'"'));if(!Nr("setLocalDescription",f.type,l.signalingState)||l._isClosed)return Promise.reject(le("InvalidStateError","Can not set local "+f.type+" in state "+l.signalingState));var p,o;if(f.type==="offer")p=F.splitSections(f.sdp),o=p.shift(),p.forEach(function(d,h){var y=F.parseRtpParameters(d);l.transceivers[h].localCapabilities=y}),l.transceivers.forEach(function(d,h){l._gather(d.mid,h)});else if(f.type==="answer"){p=F.splitSections(l._remoteDescription.sdp),o=p.shift();var c=F.matchPrefix(o,"a=ice-lite").length>0;p.forEach(function(d,h){var y=l.transceivers[h],x=y.iceGatherer,v=y.iceTransport,C=y.dtlsTransport,A=y.localCapabilities,I=y.remoteCapabilities,E=F.isRejected(d)&&F.matchPrefix(d,"a=bundle-only").length===0;if(!E&&!y.rejected){var B=F.getIceParameters(d,o),U=F.getDtlsParameters(d,o);c&&(U.role="server"),(!l.usingBundle||h===0)&&(l._gather(y.mid,h),v.state==="new"&&v.start(x,B,c?"controlling":"controlled"),C.state==="new"&&C.start(U));var w=gt(A,I);l._transceive(y,w.codecs.length>0,!1)}})}return l._localDescription={type:f.type,sdp:f.sdp},f.type==="offer"?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve()},a.prototype.setRemoteDescription=function(f){var l=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(le("TypeError",'Unsupported type "'+f.type+'"'));if(!Nr("setRemoteDescription",f.type,l.signalingState)||l._isClosed)return Promise.reject(le("InvalidStateError","Can not set remote "+f.type+" in state "+l.signalingState));var p={};l.remoteStreams.forEach(function(v){p[v.id]=v});var o=[],c=F.splitSections(f.sdp),d=c.shift(),h=F.matchPrefix(d,"a=ice-lite").length>0,y=F.matchPrefix(d,"a=group:BUNDLE ").length>0;l.usingBundle=y;var x=F.matchPrefix(d,"a=ice-options:")[0];return x?l.canTrickleIceCandidates=x.substr(14).split(" ").indexOf("trickle")>=0:l.canTrickleIceCandidates=!1,c.forEach(function(v,C){var A=F.splitLines(v),I=F.getKind(v),E=F.isRejected(v)&&F.matchPrefix(v,"a=bundle-only").length===0,B=A[0].substr(2).split(" ")[2],U=F.getDirection(v,d),w=F.parseMsid(v),D=F.getMid(v)||F.generateIdentifier();if(E||I==="application"&&(B==="DTLS/SCTP"||B==="UDP/DTLS/SCTP")){l.transceivers[C]={mid:D,kind:I,protocol:B,rejected:!0};return}!E&&l.transceivers[C]&&l.transceivers[C].rejected&&(l.transceivers[C]=l._createTransceiver(I,!0));var G,Ce,re,te,Z,q,me,O,z,se=F.parseRtpParameters(v),H,ge;E||(H=F.getIceParameters(v,d),ge=F.getDtlsParameters(v,d),ge.role="client"),me=F.parseRtpEncodingParameters(v);var He=F.parseRtcpParameters(v),dt=F.matchPrefix(v,"a=end-of-candidates",d).length>0,Re=F.matchPrefix(v,"a=candidate:").map(function(ce){return F.parseCandidate(ce)}).filter(function(ce){return ce.component===1});if((f.type==="offer"||f.type==="answer")&&!E&&y&&C>0&&l.transceivers[C]&&(l._disposeIceAndDtlsTransports(C),l.transceivers[C].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[C].iceTransport=l.transceivers[0].iceTransport,l.transceivers[C].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[C].rtpSender&&l.transceivers[C].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[C].rtpReceiver&&l.transceivers[C].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),f.type==="offer"&&!E){G=l.transceivers[C]||l._createTransceiver(I),G.mid=D,G.iceGatherer||(G.iceGatherer=l._createIceGatherer(C,y)),Re.length&&G.iceTransport.state==="new"&&(dt&&(!y||C===0)?G.iceTransport.setRemoteCandidates(Re):Re.forEach(function(ce){Ft(G.iceTransport,ce)})),O=r.RTCRtpReceiver.getCapabilities(I),t<15019&&(O.codecs=O.codecs.filter(function(ce){return ce.name!=="rtx"})),q=G.sendEncodingParameters||[{ssrc:(2*C+2)*1001}];var qe=!1;if(U==="sendrecv"||U==="sendonly"){if(qe=!G.rtpReceiver,Z=G.rtpReceiver||new r.RTCRtpReceiver(G.dtlsTransport,I),qe){var De;z=Z.track,w&&w.stream==="-"||(w?(p[w.stream]||(p[w.stream]=new r.MediaStream,Object.defineProperty(p[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(z,"id",{get:function(){return w.track}}),De=p[w.stream]):(p.default||(p.default=new r.MediaStream),De=p.default)),De&&(e(z,De),G.associatedRemoteMediaStreams.push(De)),o.push([z,Z,De])}}else G.rtpReceiver&&G.rtpReceiver.track&&(G.associatedRemoteMediaStreams.forEach(function(ce){var pt=ce.getTracks().find(function(Bt){return Bt.id===G.rtpReceiver.track.id});pt&&n(pt,ce)}),G.associatedRemoteMediaStreams=[]);G.localCapabilities=O,G.remoteCapabilities=se,G.rtpReceiver=Z,G.rtcpParameters=He,G.sendEncodingParameters=q,G.recvEncodingParameters=me,l._transceive(l.transceivers[C],!1,qe)}else if(f.type==="answer"&&!E){G=l.transceivers[C],Ce=G.iceGatherer,re=G.iceTransport,te=G.dtlsTransport,Z=G.rtpReceiver,q=G.sendEncodingParameters,O=G.localCapabilities,l.transceivers[C].recvEncodingParameters=me,l.transceivers[C].remoteCapabilities=se,l.transceivers[C].rtcpParameters=He,Re.length&&re.state==="new"&&((h||dt)&&(!y||C===0)?re.setRemoteCandidates(Re):Re.forEach(function(ce){Ft(G.iceTransport,ce)})),(!y||C===0)&&(re.state==="new"&&re.start(Ce,H,"controlling"),te.state==="new"&&te.start(ge));var Dt=gt(G.localCapabilities,G.remoteCapabilities),wt=Dt.codecs.filter(function(ce){return ce.name.toLowerCase()==="rtx"}).length;!wt&&G.sendEncodingParameters[0].rtx&&delete G.sendEncodingParameters[0].rtx,l._transceive(G,U==="sendrecv"||U==="recvonly",U==="sendrecv"||U==="sendonly"),Z&&(U==="sendrecv"||U==="sendonly")?(z=Z.track,w?(p[w.stream]||(p[w.stream]=new r.MediaStream),e(z,p[w.stream]),o.push([z,Z,p[w.stream]])):(p.default||(p.default=new r.MediaStream),e(z,p.default),o.push([z,Z,p.default]))):delete G.rtpReceiver}}),l._dtlsRole===void 0&&(l._dtlsRole=f.type==="offer"?"active":"passive"),l._remoteDescription={type:f.type,sdp:f.sdp},f.type==="offer"?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(p).forEach(function(v){var C=p[v];if(C.getTracks().length){if(l.remoteStreams.indexOf(C)===-1){l.remoteStreams.push(C);var A=new Event("addstream");A.stream=C,r.setTimeout(function(){l._dispatchEvent("addstream",A)})}o.forEach(function(I){var E=I[0],B=I[1];C.id===I[2].id&&i(l,E,B,[C])})}}),o.forEach(function(v){v[2]||i(l,v[0],v[1],[])}),r.setTimeout(function(){!(l&&l.transceivers)||l.transceivers.forEach(function(v){v.iceTransport&&v.iceTransport.state==="new"&&v.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),v.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},a.prototype.close=function(){this.transceivers.forEach(function(f){f.iceTransport&&f.iceTransport.stop(),f.dtlsTransport&&f.dtlsTransport.stop(),f.rtpSender&&f.rtpSender.stop(),f.rtpReceiver&&f.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(f){this.signalingState=f;var l=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",l)},a.prototype._maybeFireNegotiationNeeded=function(){var f=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,r.setTimeout(function(){if(f.needNegotiation){f.needNegotiation=!1;var l=new Event("negotiationneeded");f._dispatchEvent("negotiationneeded",l)}},0))},a.prototype._updateIceConnectionState=function(){var f,l={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(o){o.iceTransport&&!o.rejected&&l[o.iceTransport.state]++}),f="new",l.failed>0?f="failed":l.checking>0?f="checking":l.disconnected>0?f="disconnected":l.new>0?f="new":l.connected>0?f="connected":l.completed>0&&(f="completed"),f!==this.iceConnectionState){this.iceConnectionState=f;var p=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",p)}},a.prototype._updateConnectionState=function(){var f,l={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(o){o.iceTransport&&o.dtlsTransport&&!o.rejected&&(l[o.iceTransport.state]++,l[o.dtlsTransport.state]++)}),l.connected+=l.completed,f="new",l.failed>0?f="failed":l.connecting>0?f="connecting":l.disconnected>0?f="disconnected":l.new>0?f="new":l.connected>0&&(f="connected"),f!==this.connectionState){this.connectionState=f;var p=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",p)}},a.prototype.createOffer=function(){var f=this;if(f._isClosed)return Promise.reject(le("InvalidStateError","Can not call createOffer after close"));var l=f.transceivers.filter(function(h){return h.kind==="audio"}).length,p=f.transceivers.filter(function(h){return h.kind==="video"}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");o.offerToReceiveAudio!==void 0&&(o.offerToReceiveAudio===!0?l=1:o.offerToReceiveAudio===!1?l=0:l=o.offerToReceiveAudio),o.offerToReceiveVideo!==void 0&&(o.offerToReceiveVideo===!0?p=1:o.offerToReceiveVideo===!1?p=0:p=o.offerToReceiveVideo)}for(f.transceivers.forEach(function(h){h.kind==="audio"?(l--,l<0&&(h.wantReceive=!1)):h.kind==="video"&&(p--,p<0&&(h.wantReceive=!1))});l>0||p>0;)l>0&&(f._createTransceiver("audio"),l--),p>0&&(f._createTransceiver("video"),p--);var c=F.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.transceivers.forEach(function(h,y){var x=h.track,v=h.kind,C=h.mid||F.generateIdentifier();h.mid=C,h.iceGatherer||(h.iceGatherer=f._createIceGatherer(y,f.usingBundle));var A=r.RTCRtpSender.getCapabilities(v);t<15019&&(A.codecs=A.codecs.filter(function(E){return E.name!=="rtx"})),A.codecs.forEach(function(E){E.name==="H264"&&E.parameters["level-asymmetry-allowed"]===void 0&&(E.parameters["level-asymmetry-allowed"]="1"),h.remoteCapabilities&&h.remoteCapabilities.codecs&&h.remoteCapabilities.codecs.forEach(function(B){E.name.toLowerCase()===B.name.toLowerCase()&&E.clockRate===B.clockRate&&(E.preferredPayloadType=B.payloadType)})}),A.headerExtensions.forEach(function(E){var B=h.remoteCapabilities&&h.remoteCapabilities.headerExtensions||[];B.forEach(function(U){E.uri===U.uri&&(E.id=U.id)})});var I=h.sendEncodingParameters||[{ssrc:(2*y+1)*1001}];x&&t>=15019&&v==="video"&&!I[0].rtx&&(I[0].rtx={ssrc:I[0].ssrc+1}),h.wantReceive&&(h.rtpReceiver=new r.RTCRtpReceiver(h.dtlsTransport,v)),h.localCapabilities=A,h.sendEncodingParameters=I}),f._config.bundlePolicy!=="max-compat"&&(c+="a=group:BUNDLE "+f.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`,f.transceivers.forEach(function(h,y){c+=$r(h,h.localCapabilities,"offer",h.stream,f._dtlsRole),c+=`a=rtcp-rsize\r
`,h.iceGatherer&&f.iceGatheringState!=="new"&&(y===0||!f.usingBundle)&&(h.iceGatherer.getLocalCandidates().forEach(function(x){x.component=1,c+="a="+F.writeCandidate(x)+`\r
`}),h.iceGatherer.state==="completed"&&(c+=`a=end-of-candidates\r
`))});var d=new r.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(d)},a.prototype.createAnswer=function(){var f=this;if(f._isClosed)return Promise.reject(le("InvalidStateError","Can not call createAnswer after close"));if(!(f.signalingState==="have-remote-offer"||f.signalingState==="have-local-pranswer"))return Promise.reject(le("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState));var l=F.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.usingBundle&&(l+="a=group:BUNDLE "+f.transceivers.map(function(c){return c.mid}).join(" ")+`\r
`),l+=`a=ice-options:trickle\r
`;var p=F.getMediaSections(f._remoteDescription.sdp).length;f.transceivers.forEach(function(c,d){if(!(d+1>p)){if(c.rejected){c.kind==="application"?c.protocol==="DTLS/SCTP"?l+=`m=application 0 DTLS/SCTP 5000\r
`:l+="m=application 0 "+c.protocol+` webrtc-datachannel\r
`:c.kind==="audio"?l+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:c.kind==="video"&&(l+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),l+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+c.mid+`\r
`;return}if(c.stream){var h;c.kind==="audio"?h=c.stream.getAudioTracks()[0]:c.kind==="video"&&(h=c.stream.getVideoTracks()[0]),h&&t>=15019&&c.kind==="video"&&!c.sendEncodingParameters[0].rtx&&(c.sendEncodingParameters[0].rtx={ssrc:c.sendEncodingParameters[0].ssrc+1})}var y=gt(c.localCapabilities,c.remoteCapabilities),x=y.codecs.filter(function(v){return v.name.toLowerCase()==="rtx"}).length;!x&&c.sendEncodingParameters[0].rtx&&delete c.sendEncodingParameters[0].rtx,l+=$r(c,y,"answer",c.stream,f._dtlsRole),c.rtcpParameters&&c.rtcpParameters.reducedSize&&(l+=`a=rtcp-rsize\r
`)}});var o=new r.RTCSessionDescription({type:"answer",sdp:l});return Promise.resolve(o)},a.prototype.addIceCandidate=function(f){var l=this,p;return f&&!(f.sdpMLineIndex!==void 0||f.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(o,c){if(l._remoteDescription)if(!f||f.candidate==="")for(var d=0;d<l.transceivers.length&&!(!l.transceivers[d].rejected&&(l.transceivers[d].iceTransport.addRemoteCandidate({}),p=F.getMediaSections(l._remoteDescription.sdp),p[d]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=F.getDescription(l._remoteDescription.sdp)+p.join(""),l.usingBundle));d++);else{var h=f.sdpMLineIndex;if(f.sdpMid){for(var y=0;y<l.transceivers.length;y++)if(l.transceivers[y].mid===f.sdpMid){h=y;break}}var x=l.transceivers[h];if(x){if(x.rejected)return o();var v=Object.keys(f.candidate).length>0?F.parseCandidate(f.candidate):{};if(v.protocol==="tcp"&&(v.port===0||v.port===9)||v.component&&v.component!==1)return o();if((h===0||h>0&&x.iceTransport!==l.transceivers[0].iceTransport)&&!Ft(x.iceTransport,v))return c(le("OperationError","Can not add ICE candidate"));var C=f.candidate.trim();C.indexOf("a=")===0&&(C=C.substr(2)),p=F.getMediaSections(l._remoteDescription.sdp),p[h]+="a="+(v.type?C:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=F.getDescription(l._remoteDescription.sdp)+p.join("")}else return c(le("OperationError","Can not add ICE candidate"))}else return c(le("InvalidStateError","Can not add ICE candidate without a remote description"));o()})},a.prototype.getStats=function(f){if(f&&f instanceof r.MediaStreamTrack){var l=null;if(this.transceivers.forEach(function(o){o.rtpSender&&o.rtpSender.track===f?l=o.rtpSender:o.rtpReceiver&&o.rtpReceiver.track===f&&(l=o.rtpReceiver)}),!l)throw le("InvalidAccessError","Invalid selector.");return l.getStats()}var p=[];return this.transceivers.forEach(function(o){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){o[c]&&p.push(o[c].getStats())})}),Promise.all(p).then(function(o){var c=new Map;return o.forEach(function(d){d.forEach(function(h){c.set(h.id,h)})}),c})};var s=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];s.forEach(function(f){var l=r[f];if(l&&l.prototype&&l.prototype.getStats){var p=l.prototype.getStats;l.prototype.getStats=function(){return p.apply(this).then(function(o){var c=new Map;return Object.keys(o).forEach(function(d){o[d].type=Ro(o[d]),c.set(d,o[d])}),c})}}});var u=["createOffer","createAnswer"];return u.forEach(function(f){var l=a.prototype[f];a.prototype[f]=function(){var p=arguments;return typeof p[0]=="function"||typeof p[1]=="function"?l.apply(this,[arguments[2]]).then(function(o){typeof p[0]=="function"&&p[0].apply(null,[o])},function(o){typeof p[1]=="function"&&p[1].apply(null,[o])}):l.apply(this,arguments)}}),u=["setLocalDescription","setRemoteDescription","addIceCandidate"],u.forEach(function(f){var l=a.prototype[f];a.prototype[f]=function(){var p=arguments;return typeof p[1]=="function"||typeof p[2]=="function"?l.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)},function(o){typeof p[2]=="function"&&p[2].apply(null,[o])}):l.apply(this,arguments)}}),["getStats"].forEach(function(f){var l=a.prototype[f];a.prototype[f]=function(){var p=arguments;return typeof p[1]=="function"?l.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)}):l.apply(this,arguments)}}),a};function Rn(r){const t=r&&r.navigator,e=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return n(i).catch(a=>Promise.reject(e(a)))}}function An(r){"getDisplayMedia"in r.navigator&&(!r.navigator.mediaDevices||r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||(r.navigator.mediaDevices.getDisplayMedia=r.navigator.getDisplayMedia.bind(r.navigator)))}function Vt(r,t){if(r.RTCIceGatherer&&(r.RTCIceCandidate||(r.RTCIceCandidate=function(i){return i}),r.RTCSessionDescription||(r.RTCSessionDescription=function(i){return i}),t.version<15025)){const n=Object.getOwnPropertyDescriptor(r.MediaStreamTrack.prototype,"enabled");Object.defineProperty(r.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const a=new Event("enabled");a.enabled=i,this.dispatchEvent(a)}})}r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)&&Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new r.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),r.RTCDtmfSender&&!r.RTCDTMFSender&&(r.RTCDTMFSender=r.RTCDtmfSender);const e=Oo(r,t.version);r.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=Eo(i.iceServers,t.version),tr("ICE servers after filtering:",i.iceServers)),new e(i)},r.RTCPeerConnection.prototype=e.prototype}function On(r){r.RTCRtpSender&&!("replaceTrack"in r.RTCRtpSender.prototype)&&(r.RTCRtpSender.prototype.replaceTrack=r.RTCRtpSender.prototype.setTrack)}const Gr=Object.freeze(Object.defineProperty({__proto__:null,shimPeerConnection:Vt,shimReplaceTrack:On,shimGetUserMedia:Rn,shimGetDisplayMedia:An},Symbol.toStringTag,{value:"Module"}));function Mn(r,t){const e=r&&r.navigator,n=r&&r.MediaStreamTrack;if(e.getUserMedia=function(i,a,s){It("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(i).then(a,s)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const i=function(s,u,f){u in s&&!(f in s)&&(s[f]=s[u],delete s[u])},a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),a(s)},n&&n.prototype.getSettings){const s=n.prototype.getSettings;n.prototype.getSettings=function(){const u=s.apply(this,arguments);return i(u,"mozAutoGainControl","autoGainControl"),i(u,"mozNoiseSuppression","noiseSuppression"),u}}if(n&&n.prototype.applyConstraints){const s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),i(u,"autoGainControl","mozAutoGainControl"),i(u,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[u])}}}}function Mo(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||!r.navigator.mediaDevices||(r.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(n)})}function In(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ht(r,t){if(typeof r!="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=r.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[i]=s[i]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[a,s,u]=arguments;return n.apply(this,[a||null]).then(f=>{if(t.version<53&&!s)try{f.forEach(l=>{l.type=e[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;f.forEach((p,o)=>{f.set(o,Object.assign({},p,{type:e[p.type]||p.type}))})}return f}).then(s,u)}}function Dn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});const e=r.RTCPeerConnection.prototype.addTrack;e&&(r.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function wn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ve(r,"track",e=>(e.receiver._pc=e.srcElement,e)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Bn(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){It("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&e.getTracks().includes(n.track)&&this.removeTrack(n)})})}function jn(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function Ln(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(i){const{sender:s}=a,u=s.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=n.sendEncodings,s.sendEncodings=n.sendEncodings,this.setParametersPromises.push(s.setParameters(u).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return a})}function Fn(r){if(!(typeof r=="object"&&r.RTCRtpSender))return;const t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function $n(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Nn(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Ur=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:In,shimPeerConnection:Ht,shimSenderGetStats:Dn,shimReceiverGetStats:wn,shimRemoveStream:Bn,shimRTCDataChannel:jn,shimAddTransceiver:Ln,shimGetParameters:Fn,shimCreateOffer:$n,shimCreateAnswer:Nn,shimGetUserMedia:Mn,shimGetDisplayMedia:Mo},Symbol.toStringTag,{value:"Module"}));function Gn(r){if(!(typeof r!="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},r.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})})}}function Un(r){if(!(typeof r!="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function zn(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype,e=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(l,p){const o=arguments.length>=2?arguments[2]:arguments[0],c=e.apply(this,[o]);return p?(c.then(l,p),Promise.resolve()):c},t.createAnswer=function(l,p){const o=arguments.length>=2?arguments[2]:arguments[0],c=n.apply(this,[o]);return p?(c.then(l,p),Promise.resolve()):c};let u=function(f,l,p){const o=i.apply(this,[f]);return p?(o.then(l,p),Promise.resolve()):o};t.setLocalDescription=u,u=function(f,l,p){const o=a.apply(this,[f]);return p?(o.then(l,p),Promise.resolve()):o},t.setRemoteDescription=u,u=function(f,l,p){const o=s.apply(this,[f]);return p?(o.then(l,p),Promise.resolve()):o},t.addIceCandidate=u}function Vn(r){const t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=i=>n(Hn(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}.bind(t))}function Hn(r){return r&&r.video!==void 0?Object.assign({},r,{video:gn(r.video)}):r}function qn(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection;r.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let s=0;s<n.iceServers.length;s++){let u=n.iceServers[s];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(It("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,a.push(u)):a.push(n.iceServers[s])}n.iceServers=a}return new t(n,i)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Jn(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xn(r){const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video")}return t.apply(this,arguments)}}function Wn(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}const zr=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:Gn,shimRemoteStreamsAPI:Un,shimCallbacksAPI:zn,shimGetUserMedia:Vn,shimConstraints:Hn,shimRTCIceServerUrls:qn,shimTrackEventTransceiver:Jn,shimCreateOfferLegacy:Xn,shimAudioContext:Wn},Symbol.toStringTag,{value:"Module"}));function kt(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const t=r.RTCIceCandidate;r.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),a=Ct.parseCandidate(n.candidate),s=Object.assign(i,a);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},r.RTCIceCandidate.prototype=t.prototype,Ve(r,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new r.RTCIceCandidate(e.candidate),writable:"false"}),e))}function et(r,t){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(u){if(!u||!u.sdp)return!1;const f=Ct.splitSections(u.sdp);return f.shift(),f.some(l=>{const p=Ct.parseMLine(l);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},n=function(u){const f=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const l=parseInt(f[1],10);return l!==l?-1:l},i=function(u){let f=65536;return t.browser==="firefox"&&(t.version<57?u===-1?f=16384:f=2147483637:t.version<60?f=t.version===57?65535:65536:f=2147483637),f},a=function(u,f){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);const p=Ct.matchPrefix(u.sdp,"a=max-message-size:");return p.length>0?l=parseInt(p[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(l=2147483637),l},s=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const f=n(arguments[0]),l=i(f),p=a(arguments[0],f);let o;l===0&&p===0?o=Number.POSITIVE_INFINITY:l===0||p===0?o=Math.max(l,p):o=Math.min(l,p);const c={};Object.defineProperty(c,"maxMessageSize",{get(){return o}}),this._sctp=c}return s.apply(this,arguments)}}function tt(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(n,i){const a=n.send;n.send=function(){const u=arguments[0],f=u.length||u.size||u.byteLength;if(n.readyState==="open"&&i.sctp&&f>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)}}const e=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return t(i,this),i},Ve(r,"datachannel",n=>(t(n.channel,n.target),n))}function qt(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const s=new Event("connectionstatechange",i);a.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Jt(r,t){if(!r.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&i instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return e.apply(this,arguments)}}function Tt(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const e=r.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const Io=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:kt,shimMaxMessageSize:et,shimSendThrowTypeError:tt,shimConnectionState:qt,removeExtmapAllowMixed:Jt,shimAddIceCandidateNullOrEmpty:Tt},Symbol.toStringTag,{value:"Module"}));function Do({window:r}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=tr,n=To(r),i={browserDetails:n,commonShim:Io,extractVersion:Ze,disableLog:Co,disableWarnings:ko};switch(n.browser){case"chrome":if(!Fr||!zt||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),i;if(n.version===null)return e("Chrome shim can not determine version, not shimming."),i;e("adapter.js shimming chrome."),i.browserShim=Fr,Tt(r,n),yn(r,n),bn(r),zt(r,n),xn(r),Pn(r,n),Sn(r),Cn(r),kn(r),En(r,n),kt(r),qt(r),et(r,n),tt(r),Jt(r,n);break;case"firefox":if(!Ur||!Ht||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),i;e("adapter.js shimming firefox."),i.browserShim=Ur,Tt(r,n),Mn(r,n),Ht(r,n),In(r),Bn(r),Dn(r),wn(r),jn(r),Ln(r),Fn(r),$n(r),Nn(r),kt(r),qt(r),et(r,n),tt(r);break;case"edge":if(!Gr||!Vt||!t.shimEdge)return e("MS edge shim is not included in this adapter release."),i;e("adapter.js shimming edge."),i.browserShim=Gr,Rn(r),An(r),Vt(r,n),On(r),et(r,n),tt(r);break;case"safari":if(!zr||!t.shimSafari)return e("Safari shim is not included in this adapter release."),i;e("adapter.js shimming safari."),i.browserShim=zr,Tt(r,n),qn(r),Xn(r),zn(r),Gn(r),Un(r),Jn(r),Vn(r),Wn(r),kt(r),et(r,n),tt(r),Jt(r,n);break;default:e("Unsupported browser!");break}return i}const Vr=Do({window:typeof window>"u"?void 0:window});function Ee(r,t,e,n){Object.defineProperty(r,t,{get:e,set:n,enumerable:!0,configurable:!0})}var $t=Vr.default||Vr,We=new(function(){function r(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return r.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},r.prototype.isBrowserSupported=function(){var t=this.getBrowser(),e=this.getVersion(),n=this.supportedBrowsers.includes(t);return n?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1},r.prototype.getBrowser=function(){return $t.browserDetails.browser},r.prototype.getVersion=function(){return $t.browserDetails.version||0},r.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),e=$t.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),i=!0}catch{}finally{n&&n.close()}return i},r.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},r}()),Hr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},wo=function(){function r(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Hr,this.browser=We.getBrowser(),this.browserVersion=We.getVersion(),this.supports=function(){var t={browser:We.isBrowserSupported(),webRTC:We.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var e;try{e=new RTCPeerConnection(Hr),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!We.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{e&&e.close()}return t}(),this.pack=wr.pack,this.unpack=wr.unpack,this._dataCount=1}return r.prototype.noop=function(){},r.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},r.prototype.chunk=function(t){for(var e=[],n=t.size,i=Math.ceil(n/K.chunkedMTU),a=0,s=0;s<n;){var u=Math.min(n,s+K.chunkedMTU),f=t.slice(s,u),l={__peerData:this._dataCount,n:a,data:f,total:i};e.push(l),s=u,a++}return this._dataCount++,e},r.prototype.blobToArrayBuffer=function(t,e){var n=new FileReader;return n.onload=function(i){i.target&&e(i.target.result)},n.readAsArrayBuffer(t),n},r.prototype.binaryStringToArrayBuffer=function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n)&255;return e.buffer},r.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},r.prototype.isSecure=function(){return location.protocol==="https:"},r}(),K=new wo,Yn={};Ee(Yn,"Peer",()=>Yt,r=>Yt=r);var ut={},Bo=Object.prototype.hasOwnProperty,he="~";function ct(){}Object.create&&(ct.prototype=Object.create(null),new ct().__proto__||(he=!1));function jo(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function Kn(r,t,e,n,i){if(typeof e!="function")throw new TypeError("The listener must be a function");var a=new jo(e,n||r,i),s=he?he+t:t;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],a]:r._events[s].push(a):(r._events[s]=a,r._eventsCount++),r}function Pt(r,t){--r._eventsCount===0?r._events=new ct:delete r._events[t]}function ue(){this._events=new ct,this._eventsCount=0}ue.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)Bo.call(e,n)&&t.push(he?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};ue.prototype.listeners=function(t){var e=he?he+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s};ue.prototype.listenerCount=function(t){var e=he?he+t:t,n=this._events[e];return n?n.fn?1:n.length:0};ue.prototype.emit=function(t,e,n,i,a,s){var u=he?he+t:t;if(!this._events[u])return!1;var f=this._events[u],l=arguments.length,p,o;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,i),!0;case 5:return f.fn.call(f.context,e,n,i,a),!0;case 6:return f.fn.call(f.context,e,n,i,a,s),!0}for(o=1,p=new Array(l-1);o<l;o++)p[o-1]=arguments[o];f.fn.apply(f.context,p)}else{var c=f.length,d;for(o=0;o<c;o++)switch(f[o].once&&this.removeListener(t,f[o].fn,void 0,!0),l){case 1:f[o].fn.call(f[o].context);break;case 2:f[o].fn.call(f[o].context,e);break;case 3:f[o].fn.call(f[o].context,e,n);break;case 4:f[o].fn.call(f[o].context,e,n,i);break;default:if(!p)for(d=1,p=new Array(l-1);d<l;d++)p[d-1]=arguments[d];f[o].fn.apply(f[o].context,p)}}return!0};ue.prototype.on=function(t,e,n){return Kn(this,t,e,n,!1)};ue.prototype.once=function(t,e,n){return Kn(this,t,e,n,!0)};ue.prototype.removeListener=function(t,e,n,i){var a=he?he+t:t;if(!this._events[a])return this;if(!e)return Pt(this,a),this;var s=this._events[a];if(s.fn)s.fn===e&&(!i||s.once)&&(!n||s.context===n)&&Pt(this,a);else{for(var u=0,f=[],l=s.length;u<l;u++)(s[u].fn!==e||i&&!s[u].once||n&&s[u].context!==n)&&f.push(s[u]);f.length?this._events[a]=f.length===1?f[0]:f:Pt(this,a)}return this};ue.prototype.removeAllListeners=function(t){var e;return t?(e=he?he+t:t,this._events[e]&&Pt(this,e)):(this._events=new ct,this._eventsCount=0),this};ue.prototype.off=ue.prototype.removeListener;ue.prototype.addListener=ue.prototype.on;ue.prefixed=he;ue.EventEmitter=ue;ut=ue;var R={};Ee(R,"LogLevel",()=>_e,r=>_e=r);Ee(R,"default",()=>qr,r=>qr=r);var Le=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(s)throw s.error}}return a},Fe=function(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return r.concat(a||Array.prototype.slice.call(t))},Lo="PeerJS: ",_e;(function(r){r[r.Disabled=0]="Disabled",r[r.Errors=1]="Errors",r[r.Warnings=2]="Warnings",r[r.All=3]="All"})(_e||(_e={}));var Fo=function(){function r(){this._logLevel=_e.Disabled}return Object.defineProperty(r.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),r.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=_e.All&&this._print.apply(this,Fe([_e.All],Le(t),!1))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=_e.Warnings&&this._print.apply(this,Fe([_e.Warnings],Le(t),!1))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=_e.Errors&&this._print.apply(this,Fe([_e.Errors],Le(t),!1))},r.prototype.setLogFunction=function(t){this._print=t},r.prototype._print=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=Fe([Lo],Le(e),!1);for(var a in i)i[a]instanceof Error&&(i[a]="("+i[a].name+") "+i[a].message);t>=_e.All?console.log.apply(console,Fe([],Le(i),!1)):t>=_e.Warnings?console.warn.apply(console,Fe(["WARNING"],Le(i),!1)):t>=_e.Errors&&console.error.apply(console,Fe(["ERROR"],Le(i),!1))},r}(),qr=new Fo,Qn={};Ee(Qn,"Socket",()=>Jr,r=>Jr=r);var xe;(function(r){r.Data="data",r.Media="media"})(xe||(xe={}));var ee;(function(r){r.BrowserIncompatible="browser-incompatible",r.Disconnected="disconnected",r.InvalidID="invalid-id",r.InvalidKey="invalid-key",r.Network="network",r.PeerUnavailable="peer-unavailable",r.SslUnavailable="ssl-unavailable",r.ServerError="server-error",r.SocketError="socket-error",r.SocketClosed="socket-closed",r.UnavailableID="unavailable-id",r.WebRTC="webrtc"})(ee||(ee={}));var Ae;(function(r){r.Binary="binary",r.BinaryUTF8="binary-utf8",r.JSON="json"})(Ae||(Ae={}));var Oe;(function(r){r.Message="message",r.Disconnected="disconnected",r.Error="error",r.Close="close"})(Oe||(Oe={}));var ie;(function(r){r.Heartbeat="HEARTBEAT",r.Candidate="CANDIDATE",r.Offer="OFFER",r.Answer="ANSWER",r.Open="OPEN",r.Error="ERROR",r.IdTaken="ID-TAKEN",r.InvalidKey="INVALID-KEY",r.Leave="LEAVE",r.Expire="EXPIRE"})(ie||(ie={}));var nr={};nr=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var $o=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),No=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(s)throw s.error}}return a},Go=function(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return r.concat(a||Array.prototype.slice.call(t))},Uo=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Jr=function(r){$o(t,r);function t(e,n,i,a,s,u){u===void 0&&(u=5e3);var f=r.call(this)||this;f.pingInterval=u,f._disconnected=!0,f._messagesQueue=[];var l=e?"wss://":"ws://";return f._baseUrl=l+n+":"+i+a+"peerjs?key="+s,f}return t.prototype.start=function(e,n){var i=this;this._id=e;var a="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(n);!!this._socket||!this._disconnected||(this._socket=new WebSocket(a+"&version="+nr.version),this._disconnected=!1,this._socket.onmessage=function(s){var u;try{u=JSON.parse(s.data),R.default.log("Server message received:",u)}catch{R.default.log("Invalid server message",s.data);return}i.emit(Oe.Message,u)},this._socket.onclose=function(s){i._disconnected||(R.default.log("Socket closed.",s),i._cleanup(),i._disconnected=!0,i.emit(Oe.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),R.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){R.default.log("Cannot send heartbeat, because socket closed");return}var e=JSON.stringify({type:ie.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var e,n,i=Go([],No(this._messagesQueue),!1);this._messagesQueue=[];try{for(var a=Uo(i),s=a.next();!s.done;s=a.next()){var u=s.value;this.send(u)}}catch(f){e={error:f}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected){if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Oe.Error,"Invalid message");return}if(!!this._wsOpen()){var n=JSON.stringify(e);this._socket.send(n)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(ut.EventEmitter),Xt={};Ee(Xt,"MediaConnection",()=>Yr,r=>Yr=r);var ir={};Ee(ir,"Negotiator",()=>Xr,r=>Xr=r);var Ot=function(){return Ot=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Ot.apply(this,arguments)},yt=function(r,t,e,n){function i(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function u(p){try{l(n.next(p))}catch(o){s(o)}}function f(p){try{l(n.throw(p))}catch(o){s(o)}}function l(p){p.done?a(p.value):i(p.value).then(u,f)}l((n=n.apply(r,t||[])).next())})},bt=function(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(l){return function(p){return f([l,p])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){e.label=l[1];break}if(l[0]===6&&e.label<a[1]){e.label=a[1],a=l;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(l);break}a[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(r,e)}catch(p){l=[6,p],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Xr=function(){function r(t){this.connection=t}return r.prototype.startConnection=function(t){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===xe.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){if(this.connection.type===xe.Data){var n=this.connection,i={ordered:!!t.reliable},a=e.createDataChannel(n.label,i);n.initialize(a)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},r.prototype._startPeerConnection=function(){R.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},r.prototype._setupListeners=function(t){var e=this,n=this.connection.peer,i=this.connection.connectionId,a=this.connection.type,s=this.connection.provider;R.default.log("Listening for ICE candidates."),t.onicecandidate=function(u){!u.candidate||!u.candidate.candidate||(R.default.log("Received ICE candidates for ".concat(n,":"),u.candidate),s.socket.send({type:ie.Candidate,payload:{candidate:u.candidate,type:a,connectionId:i},dst:n}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":R.default.log("iceConnectionState is failed, closing connections to "+n),e.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),e.connection.close();break;case"closed":R.default.log("iceConnectionState is closed, closing connections to "+n),e.connection.emit("error",new Error("Connection to "+n+" closed.")),e.connection.close();break;case"disconnected":R.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":t.onicecandidate=K.noop;break}e.connection.emit("iceStateChanged",t.iceConnectionState)},R.default.log("Listening for data channel"),t.ondatachannel=function(u){R.default.log("Received data channel");var f=u.channel,l=s.getConnection(n,i);l.initialize(f)},R.default.log("Listening for remote stream"),t.ontrack=function(u){R.default.log("Received remote stream");var f=u.streams[0],l=s.getConnection(n,i);if(l.type===xe.Media){var p=l;e._addStreamToMediaConnection(f,p)}}},r.prototype.cleanup=function(){R.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(!!t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var e=t.signalingState!=="closed",n=!1;if(this.connection.type===xe.Data){var i=this.connection,a=i.dataChannel;a&&(n=!!a.readyState&&a.readyState!=="closed")}(e||n)&&t.close()}},r.prototype._makeOffer=function(){return yt(this,void 0,Promise,function(){var t,e,n,i,a,s,u;return bt(this,function(f){switch(f.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,f.label=1;case 1:return f.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:n=f.sent(),R.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),f.label=3;case 3:return f.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return f.sent(),R.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:K.browser},this.connection.type===xe.Data&&(a=this.connection,i=Ot(Ot({},i),{label:a.label,reliable:a.reliable,serialization:a.serialization})),e.socket.send({type:ie.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return s=f.sent(),s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(ee.WebRTC,s),R.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return u=f.sent(),e.emitError(ee.WebRTC,u),R.default.log("Failed to createOffer, ",u),[3,8];case 8:return[2]}})})},r.prototype._makeAnswer=function(){return yt(this,void 0,Promise,function(){var t,e,n,i,a;return bt(this,function(s){switch(s.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:n=s.sent(),R.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return s.sent(),R.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),e.socket.send({type:ie.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:K.browser},dst:this.connection.peer}),[3,6];case 5:return i=s.sent(),e.emitError(ee.WebRTC,i),R.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return a=s.sent(),e.emitError(ee.WebRTC,a),R.default.log("Failed to create answer, ",a),[3,8];case 8:return[2]}})})},r.prototype.handleSDP=function(t,e){return yt(this,void 0,Promise,function(){var n,i,a,s;return bt(this,function(u){switch(u.label){case 0:e=new RTCSessionDescription(e),n=this.connection.peerConnection,i=this.connection.provider,R.default.log("Setting remote description",e),a=this,u.label=1;case 1:return u.trys.push([1,5,,6]),[4,n.setRemoteDescription(e)];case 2:return u.sent(),R.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,a._makeAnswer()];case 3:u.sent(),u.label=4;case 4:return[3,6];case 5:return s=u.sent(),i.emitError(ee.WebRTC,s),R.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}})})},r.prototype.handleCandidate=function(t){return yt(this,void 0,Promise,function(){var e,n,i,a,s,u;return bt(this,function(f){switch(f.label){case 0:R.default.log("handleCandidate:",t),e=t.candidate,n=t.sdpMLineIndex,i=t.sdpMid,a=this.connection.peerConnection,s=this.connection.provider,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,a.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:e}))];case 2:return f.sent(),R.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return u=f.sent(),s.emitError(ee.WebRTC,u),R.default.log("Failed to handleCandidate, ",u),[3,4];case 4:return[2]}})})},r.prototype._addTracksToConnection=function(t,e){if(R.default.log("add tracks from stream ".concat(t.id," to peer connection")),!e.addTrack)return R.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(n){e.addTrack(n,t)})},r.prototype._addStreamToMediaConnection=function(t,e){R.default.log("add stream ".concat(t.id," to media connection ").concat(e.connectionId)),e.addStream(t)},r}(),or={};Ee(or,"BaseConnection",()=>Wr,r=>Wr=r);var zo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Wr=function(r){zo(t,r);function t(e,n,i){var a=r.call(this)||this;return a.peer=e,a.provider=n,a.options=i,a._open=!1,a.metadata=i.metadata,a}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(ut.EventEmitter),Vo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Mt=function(){return Mt=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Mt.apply(this,arguments)},Ho=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Yr=function(r){Vo(t,r);function t(e,n,i){var a=r.call(this,e,n,i)||this;return a._localStream=a.options._stream,a.connectionId=a.options.connectionId||t.ID_PREFIX+K.randomToken(),a._negotiator=new ir.Negotiator(a),a._localStream&&a._negotiator.startConnection({_stream:a._localStream,originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return xe.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(e){R.default.log("Receiving stream",e),this._remoteStream=e,r.prototype.emit.call(this,"stream",e)},t.prototype.handleMessage=function(e){var n=e.type,i=e.payload;switch(e.type){case ie.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case ie.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:R.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},t.prototype.answer=function(e,n){var i,a;if(n===void 0&&(n={}),this._localStream){R.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(Mt(Mt({},this.options._payload),{_stream:e}));var s=this.provider._getMessages(this.connectionId);try{for(var u=Ho(s),f=u.next();!f.done;f=u.next()){var l=f.value;this.handleMessage(l)}}catch(p){i={error:p}}finally{try{f&&!f.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,r.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(or.BaseConnection),Wt={};Ee(Wt,"DataConnection",()=>Qr,r=>Qr=r);var Zn={};Ee(Zn,"EncodingQueue",()=>Kr,r=>Kr=r);var qo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Kr=function(r){qo(t,r);function t(){var e=r.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(n){e._processing=!1,n.target&&e.emit("done",n.target.result),e.doNextTask()},e.fileReader.onerror=function(n){R.default.error("EncodingQueue error:",n),e._processing=!1,e.destroy(),e.emit("error",n)},e}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(ut.EventEmitter),Jo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Xo=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Qr=function(r){Jo(t,r);function t(e,n,i){var a=r.call(this,e,n,i)||this;return a.stringify=JSON.stringify,a.parse=JSON.parse,a._buffer=[],a._bufferSize=0,a._buffering=!1,a._chunkedData={},a._encodingQueue=new Zn.EncodingQueue,a.connectionId=a.options.connectionId||t.ID_PREFIX+K.randomToken(),a.label=a.options.label||a.connectionId,a.serialization=a.options.serialization||Ae.Binary,a.reliable=!!a.options.reliable,a._encodingQueue.on("done",function(s){a._bufferedSend(s)}),a._encodingQueue.on("error",function(){R.default.error("DC#".concat(a.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),a.close()}),a._negotiator=new ir.Negotiator(a),a._negotiator.startConnection(a.options._payload||{originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return xe.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;(!K.supports.binaryBlob||K.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){R.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(n){R.default.log("DC#".concat(e.connectionId," dc onmessage:"),n.data),e._handleDataMessage(n)},this.dataChannel.onclose=function(){R.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},t.prototype._handleDataMessage=function(e){var n=this,i=e.data,a=i.constructor,s=this.serialization===Ae.Binary||this.serialization===Ae.BinaryUTF8,u=i;if(s){if(a===Blob){K.blobToArrayBuffer(i,function(l){var p=K.unpack(l);n.emit("data",p)});return}else if(a===ArrayBuffer)u=K.unpack(i);else if(a===String){var f=K.binaryStringToArrayBuffer(i);u=K.unpack(f)}}else this.serialization===Ae.JSON&&(u=this.parse(i));if(u.__peerData){this._handleChunk(u);return}r.prototype.emit.call(this,"data",u)},t.prototype._handleChunk=function(e){var n=e.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:e.total};if(i.data[e.n]=e.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var a=new Blob(i.data);this._handleDataMessage({data:a})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,r.prototype.emit.call(this,"close"))},t.prototype.send=function(e,n){if(!this.open){r.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Ae.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===Ae.Binary||this.serialization===Ae.BinaryUTF8){var i=K.pack(e);if(!n&&i.size>K.chunkedMTU){this._sendChunks(i);return}K.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(e)},t.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(i){return R.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var n,i,a=K.chunk(e);R.default.log("DC#".concat(this.connectionId," Try to send ").concat(a.length," chunks..."));try{for(var s=Xo(a),u=s.next();!u.done;u=s.next()){var f=u.value;this.send(f,!0)}}catch(l){n={error:l}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.handleMessage=function(e){var n=e.payload;switch(e.type){case ie.Answer:this._negotiator.handleSDP(e.type,n.sdp);break;case ie.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:R.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(or.BaseConnection),ei={};Ee(ei,"API",()=>tn,r=>tn=r);var Zr=function(r,t,e,n){function i(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function u(p){try{l(n.next(p))}catch(o){s(o)}}function f(p){try{l(n.throw(p))}catch(o){s(o)}}function l(p){p.done?a(p.value):i(p.value).then(u,f)}l((n=n.apply(r,t||[])).next())})},en=function(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(l){return function(p){return f([l,p])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){e.label=l[1];break}if(l[0]===6&&e.label<a[1]){e.label=a[1],a=l;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(l);break}a[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(r,e)}catch(p){l=[6,p],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},tn=function(){function r(t){this._options=t}return r.prototype._buildRequest=function(t){var e=this._options.secure?"https":"http",n=this._options,i=n.host,a=n.port,s=n.path,u=n.key,f=new URL("".concat(e,"://").concat(i,":").concat(a).concat(s).concat(u,"/").concat(t));return f.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),f.searchParams.set("version",nr.version),fetch(f.href,{referrerPolicy:this._options.referrerPolicy})},r.prototype.retrieveId=function(){return Zr(this,void 0,Promise,function(){var t,e,n;return en(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=i.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw e=i.sent(),R.default.error("Error retrieving ID",e),n="",this._options.path==="/"&&this._options.host!==K.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},r.prototype.listAllPeers=function(){return Zr(this,void 0,Promise,function(){var t,e,n;return en(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=i.sent(),t.status!==200)throw t.status===401?(e="",this._options.host===K.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw n=i.sent(),R.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},r}(),Wo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),ot=function(){return ot=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},ot.apply(this,arguments)},Ye=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Yo=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(s)throw s.error}}return a},Yt=function(r){Wo(t,r);function t(e,n){var i=r.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var a;return e&&e.constructor==Object?n=e:e&&(a=e.toString()),n=ot({debug:0,host:K.CLOUD_HOST,port:K.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:K.randomToken(),config:K.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==K.CLOUD_HOST?i._options.secure=K.isSecure():i._options.host==K.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&R.default.setLogFunction(i._options.logFunction),R.default.logLevel=i._options.debug||0,i._api=new ei.API(n),i._socket=i._createServerConnection(),!K.supports.audioVideo&&!K.supports.data?(i._delayedAbort(ee.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!a&&!K.validateId(a)?(i._delayedAbort(ee.InvalidID,'ID "'.concat(a,'" is invalid')),i):(a?i._initialize(a):i._api.retrieveId().then(function(s){return i._initialize(s)}).catch(function(s){return i._abort(ee.ServerError,s)}),i)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,n,i=Object.create(null);try{for(var a=Ye(this._connections),s=a.next();!s.done;s=a.next()){var u=Yo(s.value,2),f=u[0],l=u[1];i[f]=l}}catch(p){e={error:p}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,n=new Qn.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(Oe.Message,function(i){e._handleMessage(i)}),n.on(Oe.Error,function(i){e._abort(ee.SocketError,i)}),n.on(Oe.Disconnected,function(){e.disconnected||(e.emitError(ee.Network,"Lost connection to server."),e.disconnect())}),n.on(Oe.Close,function(){e.disconnected||e._abort(ee.SocketClosed,"Underlying socket is already closed.")}),n},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var n,i,a=e.type,s=e.payload,u=e.src;switch(a){case ie.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case ie.Error:this._abort(ee.ServerError,s.msg);break;case ie.IdTaken:this._abort(ee.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case ie.InvalidKey:this._abort(ee.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case ie.Leave:R.default.log("Received leave message from ".concat(u)),this._cleanupPeer(u),this._connections.delete(u);break;case ie.Expire:this.emitError(ee.PeerUnavailable,"Could not connect to peer ".concat(u));break;case ie.Offer:var h=s.connectionId,y=this.getConnection(u,h);if(y&&(y.close(),R.default.warn("Offer received for existing Connection ID:".concat(h))),s.type===xe.Media){var f=new Xt.MediaConnection(u,this,{connectionId:h,_payload:s,metadata:s.metadata});y=f,this._addConnection(u,y),this.emit("call",f)}else if(s.type===xe.Data){var l=new Wt.DataConnection(u,this,{connectionId:h,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});y=l,this._addConnection(u,y),this.emit("connection",l)}else{R.default.warn("Received malformed connection type:".concat(s.type));return}var p=this._getMessages(h);try{for(var o=Ye(p),c=o.next();!c.done;c=o.next()){var d=c.value;y.handleMessage(d)}}catch(x){n={error:x}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}break;default:if(!s){R.default.warn("You received a malformed message from ".concat(u," of type ").concat(a));return}var h=s.connectionId,y=this.getConnection(u,h);y&&y.peerConnection?y.handleMessage(e):h?this._storeMessage(h,e):R.default.warn("You received an unrecognized message:",e);break}},t.prototype._storeMessage=function(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)},t.prototype._getMessages=function(e){var n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]},t.prototype.connect=function(e,n){if(n===void 0&&(n={}),this.disconnected){R.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ee.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new Wt.DataConnection(e,this,n);return this._addConnection(e,i),i},t.prototype.call=function(e,n,i){if(i===void 0&&(i={}),this.disconnected){R.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ee.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){R.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var a=new Xt.MediaConnection(e,this,ot(ot({},i),{_stream:n}));return this._addConnection(e,a),a},t.prototype._addConnection=function(e,n){R.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)},t.prototype._removeConnection=function(e){var n=this._connections.get(e.peer);if(n){var i=n.indexOf(e);i!==-1&&n.splice(i,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,n){var i,a,s=this._connections.get(e);if(!s)return null;try{for(var u=Ye(s),f=u.next();!f.done;f=u.next()){var l=f.value;if(l.connectionId===n)return l}}catch(p){i={error:p}}finally{try{f&&!f.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(e,n){var i=this;setTimeout(function(){i._abort(e,n)},0)},t.prototype._abort=function(e,n){R.default.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,n){R.default.error("Error:",n);var i;typeof n=="string"?i=new Error(n):i=n,i.type=e,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(R.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var e,n;try{for(var i=Ye(this._connections.keys()),a=i.next();!a.done;a=i.next()){var s=a.value;this._cleanupPeer(s),this._connections.delete(s)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var n,i,a=this._connections.get(e);if(!!a)try{for(var s=Ye(a),u=s.next();!u.done;u=s.next()){var f=u.value;f.close()}}catch(l){n={error:l}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;R.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)R.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)R.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(e){var n=this;e===void 0&&(e=function(i){}),this._api.listAllPeers().then(function(i){return e(i)}).catch(function(i){return n._abort(ee.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(ut.EventEmitter);Yn.Peer;class Ko{constructor(t,e){ye(this,"connectionState",hn({type:"init"}));ye(this,"peer",new Yt);this.onMessage=e,this.peer.on("open",n=>{console.log("Connection to the PeerServer is established."),t?this.onConnection(this.peer.connect(t)):this.connectionState.set({type:"ready",peerId:n})}),this.peer.on("error",n=>{console.error("Failed to connect to the PeerServer.",n),this.connectionState.set({type:"error",error:n})}),t||this.peer.on("connection",n=>{console.log("New data connection is established from a remote peer."),this.onConnection(n)})}send(t){const e=rt(this.connectionState);e.type==="connected"&&(console.log("%c\u2B07\uFE0F Send data to the remote peer.","color: red",t),e.connection.send(t))}onConnection(t){rt(this.connectionState).type!=="connected"&&(this.connectionState.set({type:"connecting"}),t.on("open",()=>{console.log("The connection is established and ready-to-use."),this.connectionState.set({type:"connected",connection:t})}),t.on("close",()=>{console.log("Either you or the remote peer closes the data connection."),this.connectionState.set({type:"disconnected"})}),t.on("data",n=>{console.log("%c\u2B06\uFE0F Data is received from the remote peer.","color: green",n),this.onMessage(n)}),t.on("error",n=>{console.log("Failed to connect to the remote peer.",n),this.connectionState.set({type:"error",error:n})}))}}function Qo(r){let t,e=r[0]?"\u2714\uFE0F":"\u{1F4CB}",n,i,a=r[0]?"Copied!":"Copy",s,u,f;return{c(){t=j("button"),n=fe(e),i=Y(),s=fe(a)},m(l,p){N(l,t,p),M(t,n),M(t,i),M(t,s),u||(f=ft(t,"click",r[1]),u=!0)},p(l,[p]){p&1&&e!==(e=l[0]?"\u2714\uFE0F":"\u{1F4CB}")&&Se(n,e),p&1&&a!==(a=l[0]?"Copied!":"Copy")&&Se(s,a)},i:W,o:W,d(l){l&&$(t),u=!1,f()}}}function Zo(r,t,e){let{textToCopy:n}=t,i=!1;function a(){navigator.clipboard.writeText(n).then(()=>{e(0,i=!0),setTimeout(()=>e(0,i=!1),2e3)},s=>console.error("Could not copy text: ",s))}return r.$$set=s=>{"textToCopy"in s&&e(2,n=s.textToCopy)},[i,a,n]}class ea extends je{constructor(t){super(),Be(this,t,Zo,Qo,Ie,{textToCopy:2})}}var ti={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(Ue,function(){var e=function(){},n=Object.prototype.hasOwnProperty,i=Array.prototype.slice;function a(_,m){var g;return typeof Object.create=="function"?g=Object.create(_):(e.prototype=_,g=new e,e.prototype=null),m&&u(!0,g,m),g}function s(_,m,g,b){var S=this;return typeof _!="string"&&(b=g,g=m,m=_,_=null),typeof m!="function"&&(b=g,g=m,m=function(){return S.apply(this,arguments)}),u(!1,m,S,b),m.prototype=a(S.prototype,g),m.prototype.constructor=m,m.class_=_||S.class_,m.super_=S,m}function u(_,m,g){g=i.call(arguments,2);for(var b,S,k=0,T=g.length;k<T;k++){S=g[k];for(b in S)(!_||n.call(S,b))&&(m[b]=S[b])}}var f=s;function l(){}l.class_="Nevis",l.super_=Object,l.extend=f;var p=l,o=p,c=o.extend(function(_,m,g){this.qrious=_,this.element=m,this.element.qrious=_,this.enabled=Boolean(g)},{draw:function(_){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(_){var m=this.qrious,g=m.padding||0,b=Math.floor((m.size-g*2)/_.width);return Math.max(1,b)},getOffset:function(_){var m=this.qrious,g=m.padding;if(g!=null)return g;var b=this.getModuleSize(_),S=Math.floor((m.size-b*_.width)/2);return Math.max(0,S)},render:function(_){this.enabled&&(this.resize(),this.reset(),this.draw(_))},reset:function(){},resize:function(){}}),d=c,h=d.extend({draw:function(_){var m,g,b=this.qrious,S=this.getModuleSize(_),k=this.getOffset(_),T=this.element.getContext("2d");for(T.fillStyle=b.foreground,T.globalAlpha=b.foregroundAlpha,m=0;m<_.width;m++)for(g=0;g<_.width;g++)_.buffer[g*_.width+m]&&T.fillRect(S*m+k,S*g+k,S,S)},reset:function(){var _=this.qrious,m=this.element.getContext("2d"),g=_.size;m.lineWidth=1,m.clearRect(0,0,g,g),m.fillStyle=_.background,m.globalAlpha=_.backgroundAlpha,m.fillRect(0,0,g,g)},resize:function(){var _=this.element;_.width=_.height=this.qrious.size}}),y=h,x=o.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),v=x,C=o.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),A=C,I=o.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),E=I,B=o.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),U=B,w=o.extend(function(_){var m,g,b,S,k,T=_.value.length;for(this._badness=[],this._level=A.LEVELS[_.level],this._polynomial=[],this._value=_.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,b=(this._level-1)*4+(this._version-1)*16,S=A.BLOCKS[b++],k=A.BLOCKS[b++],m=A.BLOCKS[b++],g=A.BLOCKS[b],b=m*(S+k)+k-3+(this._version<=9),!(T<=b)););this._dataBlock=m,this._eccBlock=g,this._neccBlock1=S,this._neccBlock2=k;var L=this.width=17+4*this._version;this.buffer=w._createArray(L*L),this._ecc=w._createArray(m+(m+g)*(S+k)+k),this._mask=w._createArray((L*(L+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+L*(L-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(T),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()},{_addAlignment:function(_,m){var g,b=this.buffer,S=this.width;for(b[_+S*m]=1,g=-2;g<2;g++)b[_+g+S*(m-2)]=1,b[_-2+S*(m+g+1)]=1,b[_+2+S*(m+g)]=1,b[_+g+1+S*(m+2)]=1;for(g=0;g<2;g++)this._setMask(_-1,m+g),this._setMask(_+1,m-g),this._setMask(_-g,m-1),this._setMask(_+g,m+1)},_appendData:function(_,m,g,b){var S,k,T,L=this._polynomial,J=this._stringBuffer;for(k=0;k<b;k++)J[g+k]=0;for(k=0;k<m;k++){if(S=E.LOG[J[_+k]^J[g]],S!==255)for(T=1;T<b;T++)J[g+T-1]=J[g+T]^E.EXPONENT[w._modN(S+L[b-T])];else for(T=g;T<g+b;T++)J[T]=J[T+1];J[g+b-1]=S===255?0:E.EXPONENT[w._modN(S+L[0])]}},_appendEccToData:function(){var _,m=0,g=this._dataBlock,b=this._calculateMaxLength(),S=this._eccBlock;for(_=0;_<this._neccBlock1;_++)this._appendData(m,g,b,S),m+=g,b+=S;for(_=0;_<this._neccBlock2;_++)this._appendData(m,g+1,b,S),m+=g+1,b+=S},_applyMask:function(_){var m,g,b,S,k=this.buffer,T=this.width;switch(_){case 0:for(S=0;S<T;S++)for(b=0;b<T;b++)!(b+S&1)&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 1:for(S=0;S<T;S++)for(b=0;b<T;b++)!(S&1)&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 2:for(S=0;S<T;S++)for(m=0,b=0;b<T;b++,m++)m===3&&(m=0),!m&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 3:for(g=0,S=0;S<T;S++,g++)for(g===3&&(g=0),m=g,b=0;b<T;b++,m++)m===3&&(m=0),!m&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 4:for(S=0;S<T;S++)for(m=0,g=S>>1&1,b=0;b<T;b++,m++)m===3&&(m=0,g=!g),!g&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 5:for(g=0,S=0;S<T;S++,g++)for(g===3&&(g=0),m=0,b=0;b<T;b++,m++)m===3&&(m=0),!((b&S&1)+!(!m|!g))&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 6:for(g=0,S=0;S<T;S++,g++)for(g===3&&(g=0),m=0,b=0;b<T;b++,m++)m===3&&(m=0),!((b&S&1)+(m&&m===g)&1)&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break;case 7:for(g=0,S=0;S<T;S++,g++)for(g===3&&(g=0),m=0,b=0;b<T;b++,m++)m===3&&(m=0),!((m&&m===g)+(b+S&1)&1)&&!this._isMasked(b,S)&&(k[b+S*T]^=1);break}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var _,m,g=this._eccBlock,b=this._polynomial;for(b[0]=1,_=0;_<g;_++){for(b[_+1]=1,m=_;m>0;m--)b[m]=b[m]?b[m-1]^E.EXPONENT[w._modN(E.LOG[b[m]]+_)]:b[m-1];b[0]=E.EXPONENT[w._modN(E.LOG[b[0]]+_)]}for(_=0;_<=g;_++)b[_]=E.LOG[b[_]]},_checkBadness:function(){var _,m,g,b,S,k=0,T=this._badness,L=this.buffer,J=this.width;for(S=0;S<J-1;S++)for(b=0;b<J-1;b++)(L[b+J*S]&&L[b+1+J*S]&&L[b+J*(S+1)]&&L[b+1+J*(S+1)]||!(L[b+J*S]||L[b+1+J*S]||L[b+J*(S+1)]||L[b+1+J*(S+1)]))&&(k+=w.N2);var ke=0;for(S=0;S<J;S++){for(g=0,T[0]=0,_=0,b=0;b<J;b++)m=L[b+J*S],_===m?T[g]++:T[++g]=1,_=m,ke+=_?1:-1;k+=this._getBadness(g)}ke<0&&(ke=-ke);var ar=0,Je=ke;for(Je+=Je<<2,Je<<=1;Je>J*J;)Je-=J*J,ar++;for(k+=ar*w.N4,b=0;b<J;b++){for(g=0,T[0]=0,_=0,S=0;S<J;S++)m=L[b+J*S],_===m?T[g]++:T[++g]=1,_=m;k+=this._getBadness(g)}return k},_convertBitStream:function(_){var m,g,b=this._ecc,S=this._version;for(g=0;g<_;g++)b[g]=this._value.charCodeAt(g);var k=this._stringBuffer=b.slice(),T=this._calculateMaxLength();_>=T-2&&(_=T-2,S>9&&_--);var L=_;if(S>9){for(k[L+2]=0,k[L+3]=0;L--;)m=k[L],k[L+3]|=255&m<<4,k[L+2]=m>>4;k[2]|=255&_<<4,k[1]=_>>4,k[0]=64|_>>12}else{for(k[L+1]=0,k[L+2]=0;L--;)m=k[L],k[L+2]|=255&m<<4,k[L+1]=m>>4;k[1]|=255&_<<4,k[0]=64|_>>4}for(L=_+3-(S<10);L<T;)k[L++]=236,k[L++]=17},_getBadness:function(_){var m,g=0,b=this._badness;for(m=0;m<=_;m++)b[m]>=5&&(g+=w.N1+b[m]-5);for(m=3;m<_-1;m+=2)b[m-2]===b[m+2]&&b[m+2]===b[m-1]&&b[m-1]===b[m+1]&&b[m-1]*3===b[m]&&(b[m-3]===0||m+3>_||b[m-3]*3>=b[m]*4||b[m+3]*3>=b[m]*4)&&(g+=w.N3);return g},_finish:function(){this._stringBuffer=this.buffer.slice();var _,m,g=0,b=3e4;for(m=0;m<8&&(this._applyMask(m),_=this._checkBadness(),_<b&&(b=_,g=m),g!==7);m++)this.buffer=this._stringBuffer.slice();g!==m&&this._applyMask(g),b=A.FINAL_FORMAT[g+(this._level-1<<3)];var S=this.buffer,k=this.width;for(m=0;m<8;m++,b>>=1)b&1&&(S[k-1-m+k*8]=1,m<6?S[8+k*m]=1:S[8+k*(m+1)]=1);for(m=0;m<7;m++,b>>=1)b&1&&(S[8+k*(k-7+m)]=1,m?S[6-m+k*8]=1:S[7+k*8]=1)},_interleaveBlocks:function(){var _,m,g=this._dataBlock,b=this._ecc,S=this._eccBlock,k=0,T=this._calculateMaxLength(),L=this._neccBlock1,J=this._neccBlock2,ke=this._stringBuffer;for(_=0;_<g;_++){for(m=0;m<L;m++)b[k++]=ke[_+m*g];for(m=0;m<J;m++)b[k++]=ke[L*g+_+m*(g+1)]}for(m=0;m<J;m++)b[k++]=ke[L*g+_+m*(g+1)];for(_=0;_<S;_++)for(m=0;m<L+J;m++)b[k++]=ke[T+_+m*S];this._stringBuffer=b},_insertAlignments:function(){var _,m,g,b=this._version,S=this.width;if(b>1)for(_=v.BLOCK[b],g=S-7;;){for(m=S-7;m>_-3&&(this._addAlignment(m,g),!(m<_));)m-=_;if(g<=_+9)break;g-=_,this._addAlignment(6,g),this._addAlignment(g,6)}},_insertFinders:function(){var _,m,g,b,S=this.buffer,k=this.width;for(_=0;_<3;_++){for(m=0,b=0,_===1&&(m=k-7),_===2&&(b=k-7),S[b+3+k*(m+3)]=1,g=0;g<6;g++)S[b+g+k*m]=1,S[b+k*(m+g+1)]=1,S[b+6+k*(m+g)]=1,S[b+g+1+k*(m+6)]=1;for(g=1;g<5;g++)this._setMask(b+g,m+1),this._setMask(b+1,m+g+1),this._setMask(b+5,m+g),this._setMask(b+g+1,m+5);for(g=2;g<4;g++)S[b+g+k*(m+2)]=1,S[b+2+k*(m+g+1)]=1,S[b+4+k*(m+g)]=1,S[b+g+1+k*(m+4)]=1}},_insertTimingGap:function(){var _,m,g=this.width;for(m=0;m<7;m++)this._setMask(7,m),this._setMask(g-8,m),this._setMask(7,m+g-7);for(_=0;_<8;_++)this._setMask(_,7),this._setMask(_+g-8,7),this._setMask(_,g-8)},_insertTimingRowAndColumn:function(){var _,m=this.buffer,g=this.width;for(_=0;_<g-14;_++)_&1?(this._setMask(8+_,6),this._setMask(6,8+_)):(m[8+_+g*6]=1,m[6+g*(8+_)]=1)},_insertVersion:function(){var _,m,g,b,S=this.buffer,k=this._version,T=this.width;if(k>6)for(_=U.BLOCK[k-7],m=17,g=0;g<6;g++)for(b=0;b<3;b++,m--)1&(m>11?k>>m-12:_>>m)?(S[5-g+T*(2-b+T-11)]=1,S[2-b+T-11+T*(5-g)]=1):(this._setMask(5-g,2-b+T-11),this._setMask(2-b+T-11,5-g))},_isMasked:function(_,m){var g=w._getMaskBit(_,m);return this._mask[g]===1},_pack:function(){var _,m,g,b=1,S=1,k=this.width,T=k-1,L=k-1,J=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(m=0;m<J;m++)for(_=this._stringBuffer[m],g=0;g<8;g++,_<<=1){128&_&&(this.buffer[T+k*L]=1);do S?T--:(T++,b?L!==0?L--:(T-=2,b=!b,T===6&&(T--,L=9)):L!==k-1?L++:(T-=2,b=!b,T===6&&(T--,L-=8))),S=!S;while(this._isMasked(T,L))}},_reverseMask:function(){var _,m,g=this.width;for(_=0;_<9;_++)this._setMask(_,8);for(_=0;_<8;_++)this._setMask(_+g-8,8),this._setMask(8,_);for(m=0;m<7;m++)this._setMask(8,m+g-7)},_setMask:function(_,m){var g=w._getMaskBit(_,m);this._mask[g]=1},_syncMask:function(){var _,m,g=this.width;for(m=0;m<g;m++)for(_=0;_<=m;_++)this.buffer[_+g*m]&&this._setMask(_,m)}},{_createArray:function(_){var m,g=[];for(m=0;m<_;m++)g[m]=0;return g},_getMaskBit:function(_,m){var g;return _>m&&(g=_,_=m,m=g),g=m,g+=m*m,g>>=1,g+=_,g},_modN:function(_){for(;_>=255;)_-=255,_=(_>>8)+(_&255);return _},N1:3,N2:3,N3:40,N4:10}),D=w,G=d.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var _=this.element;_.width=_.height=this.qrious.size}}),Ce=G,re=o.extend(function(_,m,g,b){this.name=_,this.modifiable=Boolean(m),this.defaultValue=g,this._valueTransformer=b},{transform:function(_){var m=this._valueTransformer;return typeof m=="function"?m(_,this):_}}),te=re,Z=o.extend(null,{abs:function(_){return _!=null?Math.abs(_):null},hasOwn:function(_,m){return Object.prototype.hasOwnProperty.call(_,m)},noop:function(){},toUpperCase:function(_){return _!=null?_.toUpperCase():null}}),q=Z,me=o.extend(function(_){this.options={},_.forEach(function(m){this.options[m.name]=m},this)},{exists:function(_){return this.options[_]!=null},get:function(_,m){return me._get(this.options[_],m)},getAll:function(_){var m,g=this.options,b={};for(m in g)q.hasOwn(g,m)&&(b[m]=me._get(g[m],_));return b},init:function(_,m,g){typeof g!="function"&&(g=q.noop);var b,S;for(b in this.options)q.hasOwn(this.options,b)&&(S=this.options[b],me._set(S,S.defaultValue,m),me._createAccessor(S,m,g));this._setAll(_,m,!0)},set:function(_,m,g){return this._set(_,m,g)},setAll:function(_,m){return this._setAll(_,m)},_set:function(_,m,g,b){var S=this.options[_];if(!S)throw new Error("Invalid option: "+_);if(!S.modifiable&&!b)throw new Error("Option cannot be modified: "+_);return me._set(S,m,g)},_setAll:function(_,m,g){if(!_)return!1;var b,S=!1;for(b in _)q.hasOwn(_,b)&&this._set(b,_[b],m,g)&&(S=!0);return S}},{_createAccessor:function(_,m,g){var b={get:function(){return me._get(_,m)}};_.modifiable&&(b.set=function(S){me._set(_,S,m)&&g(S,_)}),Object.defineProperty(m,_.name,b)},_get:function(_,m){return m["_"+_.name]},_set:function(_,m,g){var b="_"+_.name,S=g[b],k=_.transform(m!=null?m:_.defaultValue);return g[b]=k,k!==S}}),O=me,z=o.extend(function(){this._services={}},{getService:function(_){var m=this._services[_];if(!m)throw new Error("Service is not being managed with name: "+_);return m},setService:function(_,m){if(this._services[_])throw new Error("Service is already managed with name: "+_);m&&(this._services[_]=m)}}),se=z,H=new O([new te("background",!0,"white"),new te("backgroundAlpha",!0,1,q.abs),new te("element"),new te("foreground",!0,"black"),new te("foregroundAlpha",!0,1,q.abs),new te("level",!0,"L",q.toUpperCase),new te("mime",!0,"image/png"),new te("padding",!0,null,q.abs),new te("size",!0,100,q.abs),new te("value",!0,"")]),ge=new se,He=o.extend(function(_){H.init(_,this,this.update.bind(this));var m=H.get("element",this),g=ge.getService("element"),b=m&&g.isCanvas(m)?m:g.createCanvas(),S=m&&g.isImage(m)?m:g.createImage();this._canvasRenderer=new y(this,b,!0),this._imageRenderer=new Ce(this,S,S===m),this.update()},{get:function(){return H.getAll(this)},set:function(_){H.setAll(_,this)&&this.update()},toDataURL:function(_){return this.canvas.toDataURL(_||this.mime)},update:function(){var _=new D({level:this.level,value:this.value});this._canvasRenderer.render(_),this._imageRenderer.render(_)}},{use:function(_){ge.setService(_.getName(),_)}});Object.defineProperties(He.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var dt=He,Re=dt,qe=o.extend({getName:function(){}}),De=qe,Dt=De.extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(_){},isImage:function(_){}}),wt=Dt,ce=wt.extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(_){return _ instanceof HTMLCanvasElement},isImage:function(_){return _ instanceof HTMLImageElement}}),pt=ce;Re.use(new pt);var Bt=Re;return Bt})})(ti);const ta=ti.exports;function ra(r){let t,e,n,i;return{c(){t=j("div"),e=j("img"),Me(e.src,n=r[2])||P(e,"src",n),P(e,"alt",r[0]),P(e,"class",i=ne(r[1])+" svelte-1rf1xd0"),P(t,"class","wrapper svelte-1rf1xd0")},m(a,s){N(a,t,s),M(t,e)},p(a,[s]){s&4&&!Me(e.src,n=a[2])&&P(e,"src",n),s&1&&P(e,"alt",a[0]),s&2&&i!==(i=ne(a[1])+" svelte-1rf1xd0")&&P(e,"class",i)},i:W,o:W,d(a){a&&$(t)}}}function na(r,t,e){const n=new ta;let{errorCorrection:i="L"}=t,{background:a="#fff"}=t,{color:s="#000"}=t,{size:u="200"}=t,{value:f}=t,{padding:l=0}=t,{className:p="qrcode"}=t,o="";function c(){n.set({background:a,foreground:s,level:i,padding:l,size:u,value:f}),e(2,o=n.toDataURL("image/jpeg"))}function d(){return o}return Kt(()=>{c()}),r.$$set=h=>{"errorCorrection"in h&&e(3,i=h.errorCorrection),"background"in h&&e(4,a=h.background),"color"in h&&e(5,s=h.color),"size"in h&&e(6,u=h.size),"value"in h&&e(0,f=h.value),"padding"in h&&e(7,l=h.padding),"className"in h&&e(1,p=h.className)},r.$$.update=()=>{r.$$.dirty&1&&f&&c()},[f,p,o,i,a,s,u,l,d]}class ia extends je{constructor(t){super(),Be(this,t,na,ra,Ie,{errorCorrection:3,background:4,color:5,size:6,value:0,padding:7,className:1,getImage:8})}get getImage(){return this.$$.ctx[8]}}function rn(r){let t,e,n,i;const a=[fa,la,ca,sa,aa,oa],s=[];function u(f,l){if(f[0].type==="init")return 0;if(f[0].type==="connecting")return 1;if(f[0].type==="disconnected")return 2;if(f[0].type==="ready")return 3;return f[0].type,4;return 5}return e=u(r),n=s[e]=a[e](r),{c(){t=j("section"),n.c(),P(t,"class","svelte-eywiag")},m(f,l){N(f,t,l),s[e].m(t,null),i=!0},p(f,l){let p=e;e=u(f),e===p?s[e].p(f,l):(Te(),X(s[p],1,1,()=>{s[p]=null}),Pe(),n=s[e],n?n.p(f,l):(n=s[e]=a[e](f),n.c()),V(n,1),n.m(t,null))},i(f){i||(V(n),i=!0)},o(f){X(n),i=!1},d(f){f&&$(t),s[e].d()}}}function oa(r){let t,e,n,i;return{c(){t=j("h1"),t.textContent="\u{1F914} Wrong state",e=Y(),n=j("p"),i=fe(r[0])},m(a,s){N(a,t,s),N(a,e,s),N(a,n,s),M(n,i)},p(a,s){s&1&&Se(i,a[0])},i:W,o:W,d(a){a&&$(t),a&&$(e),a&&$(n)}}}function aa(r){let t,e,n,i=r[0].error+"",a;return{c(){t=j("h1"),t.textContent="\u{1F635} Error",e=Y(),n=j("p"),a=fe(i)},m(s,u){N(s,t,u),N(s,e,u),N(s,n,u),M(n,a)},p(s,u){u&1&&i!==(i=s[0].error+"")&&Se(a,i)},i:W,o:W,d(s){s&&$(t),s&&$(e),s&&$(n)}}}function sa(r){let t,e,n,i,a,s,u,f,l,p,o,c,d;return p=new ea({props:{textToCopy:r[1]}}),c=new ia({props:{value:r[1]}}),{c(){t=j("div"),e=j("h1"),e.textContent="\u{1F3B2} KNUCKLEBONES \u{1F3B2}",n=Y(),i=j("p"),a=fe("Send the link below to another player:"),s=j("br"),u=j("a"),f=fe(r[1]),l=Y(),ve(p.$$.fragment),o=Y(),ve(c.$$.fragment),P(e,"class","game-title svelte-eywiag"),P(u,"href",r[1]),P(t,"class","ready-container svelte-eywiag")},m(h,y){N(h,t,y),M(t,e),M(t,n),M(t,i),M(i,a),M(i,s),M(i,u),M(u,f),M(t,l),de(p,t,null),M(t,o),de(c,t,null),d=!0},p(h,y){(!d||y&2)&&Se(f,h[1]),(!d||y&2)&&P(u,"href",h[1]);const x={};y&2&&(x.textToCopy=h[1]),p.$set(x);const v={};y&2&&(v.value=h[1]),c.$set(v)},i(h){d||(V(p.$$.fragment,h),V(c.$$.fragment,h),d=!0)},o(h){X(p.$$.fragment,h),X(c.$$.fragment,h),d=!1},d(h){h&&$(t),pe(p),pe(c)}}}function ca(r){let t,e,n,i,a;return{c(){t=j("p"),t.textContent="Remote peer closes the data connection.",e=Y(),n=j("button"),n.textContent="\u{1F6AA} Go to start page"},m(s,u){N(s,t,u),N(s,e,u),N(s,n,u),i||(a=ft(n,"click",r[3]),i=!0)},p:W,i:W,o:W,d(s){s&&$(t),s&&$(e),s&&$(n),i=!1,a()}}}function la(r){let t;return{c(){t=j("p"),t.textContent="\u231B Connectioning to the remote player",P(t,"class","loading svelte-eywiag")},m(e,n){N(e,t,n)},p:W,i:W,o:W,d(e){e&&$(t)}}}function fa(r){let t;return{c(){t=j("p"),t.textContent="\u231B Connection to the PeerServer",P(t,"class","loading svelte-eywiag")},m(e,n){N(e,t,n)},p:W,i:W,o:W,d(e){e&&$(t)}}}function nn(r){let t;const e=r[6].default,n=ai(e,r,r[5],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&32)&&ci(n,e,i,i[5],t?si(e,i[5],a,null):li(i[5]),null)},i(i){t||(V(n,i),t=!0)},o(i){X(n,i),t=!1},d(i){n&&n.d(i)}}}function ua(r){let t,e,n,i=r[0].type!=="connected"&&rn(r),a=r[0].type==="connected"&&nn(r);return{c(){i&&i.c(),t=Y(),a&&a.c(),e=Ne()},m(s,u){i&&i.m(s,u),N(s,t,u),a&&a.m(s,u),N(s,e,u),n=!0},p(s,[u]){s[0].type!=="connected"?i?(i.p(s,u),u&1&&V(i,1)):(i=rn(s),i.c(),V(i,1),i.m(t.parentNode,t)):i&&(Te(),X(i,1,1,()=>{i=null}),Pe()),s[0].type==="connected"?a?(a.p(s,u),u&1&&V(a,1)):(a=nn(s),a.c(),V(a,1),a.m(e.parentNode,e)):a&&(Te(),X(a,1,1,()=>{a=null}),Pe())},i(s){n||(V(i),V(a),n=!0)},o(s){X(i),X(a),n=!1},d(s){i&&i.d(s),s&&$(t),a&&a.d(s),s&&$(e)}}}function da(r,t,e){let n,i,{$$slots:a={},$$scope:s}=t,{p2p:u}=t;const{connectionState:f}=u;cn(r,f,p=>e(0,i=p));const l=()=>window.location=window.location.pathname;return r.$$set=p=>{"p2p"in p&&e(4,u=p.p2p),"$$scope"in p&&e(5,s=p.$$scope)},r.$$.update=()=>{r.$$.dirty&1&&e(1,n=i.type==="ready"?`${window.location.href}?id=${i.peerId}`:"")},[i,n,f,l,u,s,a]}class pa extends je{constructor(t){super(),Be(this,t,da,ua,Ie,{p2p:4})}}function ha(r){let t,e;return t=new go({props:{game:r[1]}}),t.$on("action",r[2]),{c(){ve(t.$$.fragment)},m(n,i){de(t,n,i),e=!0},p:W,i(n){e||(V(t.$$.fragment,n),e=!0)},o(n){X(t.$$.fragment,n),e=!1},d(n){pe(t,n)}}}function ma(r){let t,e,n,i;return t=new pa({props:{p2p:r[0],$$slots:{default:[ha]},$$scope:{ctx:r}}}),n=new bi({}),{c(){ve(t.$$.fragment),e=Y(),ve(n.$$.fragment)},m(a,s){de(t,a,s),N(a,e,s),de(n,a,s),i=!0},p(a,[s]){const u={};s&32&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){i||(V(t.$$.fragment,a),V(n.$$.fragment,a),i=!0)},o(a){X(t.$$.fragment,a),X(n.$$.fragment,a),i=!1},d(a){pe(t,a),a&&$(e),pe(n,a)}}}function _a(r){const t=new URLSearchParams(window.location.search).get("id"),e=new Ko(t,i),n=new Pi(t?2:1);function i(s){const u=s;if(n.action(u),u.type==="GAME"||u.type==="RESET"){const l={type:"DICE",value:mn()};n.action(l),e.send(l)}}function a(s){n.action(s.detail)&&e.send(s.detail)}return[e,n,a]}class va extends je{constructor(t){super(),Be(this,t,_a,ma,Ie,{})}}new va({target:document.getElementById("app")});
