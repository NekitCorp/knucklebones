var Gi=Object.defineProperty;var zi=(n,t,e)=>t in n?Gi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var ue=(n,t,e)=>(zi(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function N(){}function Hi(n,t){for(const e in t)n[e]=t[e];return n}function Ar(n){return n()}function An(){return Object.create(null)}function st(n){n.forEach(Ar)}function xr(n){return typeof n=="function"}function Se(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}let ft;function Ce(n,t){return ft||(ft=document.createElement("a")),ft.href=t,n===ft.href}function Vi(n){return Object.keys(n).length===0}function Ir(n,...t){if(n==null)return N;const e=n.subscribe(...t);return e.unsubscribe?()=>e.unsubscribe():e}function Qe(n){let t;return Ir(n,e=>t=e)(),t}function wr(n,t,e){n.$$.on_destroy.push(Ir(t,e))}function Ji(n,t,e,r){if(n){const i=Mr(n,t,e,r);return n[0](i)}}function Mr(n,t,e,r){return n[1]&&r?Hi(e.ctx.slice(),n[1](r(t))):e.ctx}function qi(n,t,e,r){if(n[2]&&r){const i=n[2](r(e));if(t.dirty===void 0)return i;if(typeof i=="object"){const o=[],s=Math.max(t.dirty.length,i.length);for(let f=0;f<s;f+=1)o[f]=t.dirty[f]|i[f];return o}return t.dirty|i}return t.dirty}function Yi(n,t,e,r,i,o){if(i){const s=Mr(t,e,r,o);n.p(s,i)}}function Ki(n){if(n.ctx.length>32){const t=[],e=n.ctx.length/32;for(let r=0;r<e;r++)t[r]=-1;return t}return-1}function Z(n){return n==null?"":n}function R(n,t){n.appendChild(t)}function O(n,t,e){n.insertBefore(t,e||null)}function M(n){n.parentNode.removeChild(n)}function xn(n,t){for(let e=0;e<n.length;e+=1)n[e]&&n[e].d(t)}function I(n){return document.createElement(n)}function Q(n){return document.createTextNode(n)}function $(){return Q(" ")}function we(){return Q("")}function Me(n,t,e,r){return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}function T(n,t,e){e==null?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}function Wi(n){return Array.from(n.childNodes)}function pe(n,t){t=""+t,n.wholeText!==t&&(n.data=t)}function G(n,t,e){n.classList[e?"add":"remove"](t)}function Xi(n,t,{bubbles:e=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(n,e,r,t),i}let rt;function Ze(n){rt=n}function un(){if(!rt)throw new Error("Function called outside component initialization");return rt}function fn(n){un().$$.on_mount.push(n)}function Qi(n){un().$$.on_destroy.push(n)}function Zi(){const n=un();return(t,e,{cancelable:r=!1}={})=>{const i=n.$$.callbacks[t];if(i){const o=Xi(t,e,{cancelable:r});return i.slice().forEach(s=>{s.call(n,o)}),!o.defaultPrevented}return!0}}const qe=[],In=[],bt=[],wn=[],eo=Promise.resolve();let Yt=!1;function to(){Yt||(Yt=!0,eo.then(Dr))}function Kt(n){bt.push(n)}const $t=new Set;let dt=0;function Dr(){const n=rt;do{for(;dt<qe.length;){const t=qe[dt];dt++,Ze(t),no(t.$$)}for(Ze(null),qe.length=0,dt=0;In.length;)In.pop()();for(let t=0;t<bt.length;t+=1){const e=bt[t];$t.has(e)||($t.add(e),e())}bt.length=0}while(qe.length);for(;wn.length;)wn.pop()();Yt=!1,$t.clear(),Ze(n)}function no(n){if(n.fragment!==null){n.update(),st(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(Kt)}}const Ct=new Set;let Ie;function he(){Ie={r:0,c:[],p:Ie}}function me(){Ie.r||st(Ie.c),Ie=Ie.p}function B(n,t){n&&n.i&&(Ct.delete(n),n.i(t))}function j(n,t,e,r){if(n&&n.o){if(Ct.has(n))return;Ct.add(n),Ie.c.push(()=>{Ct.delete(n),r&&(e&&n.d(1),r())}),n.o(t)}else r&&r()}function Or(n,t){j(n,1,1,()=>{t.delete(n.key)})}function Br(n,t,e,r,i,o,s,f,c,l,d,a){let u=n.length,p=o.length,h=u;const g={};for(;h--;)g[n[h].key]=h;const _=[],m=new Map,v=new Map;for(h=p;h--;){const S=a(i,o,h),P=e(S);let w=s.get(P);w?r&&w.p(S,t):(w=l(P,S),w.c()),m.set(P,_[h]=w),P in g&&v.set(P,Math.abs(h-g[P]))}const y=new Set,b=new Set;function C(S){B(S,1),S.m(f,d),s.set(S.key,S),d=S.first,p--}for(;u&&p;){const S=_[p-1],P=n[u-1],w=S.key,E=P.key;S===P?(d=S.first,u--,p--):m.has(E)?!s.has(w)||y.has(w)?C(S):b.has(E)?u--:v.get(w)>v.get(E)?(b.add(w),C(S)):(y.add(E),u--):(c(P,s),u--)}for(;u--;){const S=n[u];m.has(S.key)||c(S,s)}for(;p;)C(_[p-1]);return _}function ce(n){n&&n.c()}function te(n,t,e,r){const{fragment:i,after_update:o}=n.$$;i&&i.m(t,e),r||Kt(()=>{const s=n.$$.on_mount.map(Ar).filter(xr);n.$$.on_destroy?n.$$.on_destroy.push(...s):st(s),n.$$.on_mount=[]}),o.forEach(Kt)}function ne(n,t){const e=n.$$;e.fragment!==null&&(st(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function ro(n,t){n.$$.dirty[0]===-1&&(qe.push(n),to(),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function Ee(n,t,e,r,i,o,s,f=[-1]){const c=rt;Ze(n);const l=n.$$={fragment:null,ctx:[],props:o,update:N,not_equal:i,bound:An(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:An(),dirty:f,skip_bound:!1,root:t.target||c.$$.root};s&&s(l.root);let d=!1;if(l.ctx=e?e(n,t.props||{},(a,u,...p)=>{const h=p.length?p[0]:u;return l.ctx&&i(l.ctx[a],l.ctx[a]=h)&&(!l.skip_bound&&l.bound[a]&&l.bound[a](h),d&&ro(n,a)),u}):[],l.update(),d=!0,st(l.before_update),l.fragment=r?r(l.ctx):!1,t.target){if(t.hydrate){const a=Wi(t.target);l.fragment&&l.fragment.l(a),a.forEach(M)}else l.fragment&&l.fragment.c();t.intro&&B(n.$$.fragment),te(n,t.target,t.anchor,t.customElement),Dr()}Ze(c)}class Pe{$destroy(){ne(this,1),this.$destroy=N}$on(t,e){if(!xr(e))return N;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!Vi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Mn(n){let t,e,r,i,o,s,f,c,l;return{c(){t=I("div"),e=I("button"),e.textContent="\u2716\uFE0F",r=$(),i=I("p"),i.textContent="For a better gaming experience, it is recommended to hide the toolbar.",o=$(),s=I("img"),T(e,"class","button svelte-rjtj2u"),T(i,"class","text svelte-rjtj2u"),Ce(s.src,f="hide-toolbar.png")||T(s,"src",f),T(s,"alt","hide toolbar guide"),T(t,"class","overlay svelte-rjtj2u")},m(d,a){O(d,t,a),R(t,e),R(t,r),R(t,i),R(t,o),R(t,s),c||(l=Me(e,"click",n[1]),c=!0)},p:N,d(d){d&&M(t),c=!1,l()}}}function io(n){let t,e=n[0]&&Mn(n);return{c(){e&&e.c(),t=we()},m(r,i){e&&e.m(r,i),O(r,t,i)},p(r,[i]){r[0]?e?e.p(r,i):(e=Mn(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:N,o:N,d(r){e&&e.d(r),r&&M(t)}}}function oo(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)}function ao(n,t,e){let r=!1;function i(){e(0,r=!1)}return fn(()=>{oo()&&e(0,r=!0)}),[r,i]}class so extends Pe{constructor(t){super(),Ee(this,t,ao,io,Se,{})}}const Be=[];function Lr(n,t=N){let e;const r=new Set;function i(f){if(Se(n,f)&&(n=f,e)){const c=!Be.length;for(const l of r)l[1](),Be.push(l,n);if(c){for(let l=0;l<Be.length;l+=2)Be[l][0](Be[l+1]);Be.length=0}}}function o(f){i(f(n))}function s(f,c=N){const l=[f,c];return r.add(l),r.size===1&&(e=t(i)||N),f(n),()=>{r.delete(l),r.size===0&&(e(),e=null)}}return{set:i,update:o,subscribe:s}}var ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ye={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(n){(function(){var t=function(){this.init()};t.prototype={init:function(){var a=this||e;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator=typeof window<"u"&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var u=this||e;if(a=parseFloat(a),u.ctx||d(),typeof a<"u"&&a>=0&&a<=1){if(u._volume=a,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(a,e.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var h=u._howls[p]._getSoundIds(),g=0;g<h.length;g++){var _=u._howls[p]._soundById(h[g]);_&&_._node&&(_._node.volume=_._volume*a)}return u}return u._volume},mute:function(a){var u=this||e;u.ctx||d(),u._muted=a,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(a?0:u._volume,e.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var h=u._howls[p]._getSoundIds(),g=0;g<h.length;g++){var _=u._howls[p]._soundById(h[g]);_&&_._node&&(_._node.muted=a?!0:_._muted)}return u},stop:function(){for(var a=this||e,u=0;u<a._howls.length;u++)a._howls[u].stop();return a},unload:function(){for(var a=this||e,u=a._howls.length-1;u>=0;u--)a._howls[u].unload();return a.usingWebAudio&&a.ctx&&typeof a.ctx.close<"u"&&(a.ctx.close(),a.ctx=null,d()),a},codecs:function(a){return(this||e)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||e;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(a._canPlayEvent="canplay")}catch{a.noAudio=!0}else a.noAudio=!0;try{var u=new Audio;u.muted&&(a.noAudio=!0)}catch{}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||e,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return a}if(!u||typeof u.canPlayType!="function")return a;var p=u.canPlayType("audio/mpeg;").replace(/^no$/,""),h=a._navigator?a._navigator.userAgent:"",g=h.match(/OPR\/([0-6].)/g),_=g&&parseInt(g[0].split("/")[1],10)<33,m=h.indexOf("Safari")!==-1&&h.indexOf("Chrome")===-1,v=h.match(/Version\/(.*?) /),y=m&&v&&parseInt(v[1],10)<15;return a._codecs={mp3:!!(!_&&(p||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||e;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,!a._mobileUnloaded&&a.ctx.sampleRate!==44100&&(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var u=function(p){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var h=new Audio;h._unlocked=!0,a._releaseHtml5Audio(h)}catch{a.noAudio=!0;break}for(var g=0;g<a._howls.length;g++)if(!a._howls[g]._webAudio)for(var _=a._howls[g]._getSoundIds(),m=0;m<_.length;m++){var v=a._howls[g]._soundById(_[m]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}a._autoResume();var y=a.ctx.createBufferSource();y.buffer=a._scratchBuffer,y.connect(a.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof a.ctx.resume=="function"&&a.ctx.resume(),y.onended=function(){y.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),a}},_obtainHtml5Audio:function(){var a=this||e;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var u=this||e;return a._unlocked&&u._html5AudioPool.push(a),u},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx||typeof a.ctx.suspend>"u"||!e.usingWebAudio)){for(var u=0;u<a._howls.length;u++)if(a._howls[u]._webAudio){for(var p=0;p<a._howls[u]._sounds.length;p++)if(!a._howls[u]._sounds[p]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(!!a.autoSuspend){a._suspendTimer=null,a.state="suspending";var h=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(h,h)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx||typeof a.ctx.resume>"u"||!e.usingWebAudio))return a.state==="running"&&a.ctx.state!=="interrupted"&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):a.state==="suspended"||a.state==="running"&&a.ctx.state==="interrupted"?(a.ctx.resume().then(function(){a.state="running";for(var u=0;u<a._howls.length;u++)a._howls[u]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):a.state==="suspending"&&(a._resumeAfterSuspend=!0),a}};var e=new t,r=function(a){var u=this;if(!a.src||a.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(a)};r.prototype={init:function(a){var u=this;return e.ctx||d(),u._autoplay=a.autoplay||!1,u._format=typeof a.format!="string"?a.format:[a.format],u._html5=a.html5||!1,u._muted=a.mute||!1,u._loop=a.loop||!1,u._pool=a.pool||5,u._preload=typeof a.preload=="boolean"||a.preload==="metadata"?a.preload:!0,u._rate=a.rate||1,u._sprite=a.sprite||{},u._src=typeof a.src!="string"?a.src:[a.src],u._volume=a.volume!==void 0?a.volume:1,u._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=a.onend?[{fn:a.onend}]:[],u._onfade=a.onfade?[{fn:a.onfade}]:[],u._onload=a.onload?[{fn:a.onload}]:[],u._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],u._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],u._onpause=a.onpause?[{fn:a.onpause}]:[],u._onplay=a.onplay?[{fn:a.onplay}]:[],u._onstop=a.onstop?[{fn:a.onstop}]:[],u._onmute=a.onmute?[{fn:a.onmute}]:[],u._onvolume=a.onvolume?[{fn:a.onvolume}]:[],u._onrate=a.onrate?[{fn:a.onrate}]:[],u._onseek=a.onseek?[{fn:a.onseek}]:[],u._onunlock=a.onunlock?[{fn:a.onunlock}]:[],u._onresume=[],u._webAudio=e.usingWebAudio&&!u._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var a=this,u=null;if(e.noAudio){a._emit("loaderror",null,"No audio support.");return}typeof a._src=="string"&&(a._src=[a._src]);for(var p=0;p<a._src.length;p++){var h,g;if(a._format&&a._format[p])h=a._format[p];else{if(g=a._src[p],typeof g!="string"){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}h=/^data:audio\/([^;,]+);/i.exec(g),h||(h=/\.([^.]+)$/.exec(g.split("?",1)[0])),h&&(h=h[1].toLowerCase())}if(h||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),h&&e.codecs(h)){u=a._src[p];break}}if(!u){a._emit("loaderror",null,"No codec support for selected audio sources.");return}return a._src=u,a._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(a._html5=!0,a._webAudio=!1),new i(a),a._webAudio&&s(a),a},play:function(a,u){var p=this,h=null;if(typeof a=="number")h=a,a=null;else{if(typeof a=="string"&&p._state==="loaded"&&!p._sprite[a])return null;if(typeof a>"u"&&(a="__default",!p._playLock)){for(var g=0,_=0;_<p._sounds.length;_++)p._sounds[_]._paused&&!p._sounds[_]._ended&&(g++,h=p._sounds[_]._id);g===1?a=null:h=null}}var m=h?p._soundById(h):p._inactiveSound();if(!m)return null;if(h&&!a&&(a=m._sprite||"__default"),p._state!=="loaded"){m._sprite=a,m._ended=!1;var v=m._id;return p._queue.push({event:"play",action:function(){p.play(v)}}),v}if(h&&!m._paused)return u||p._loadQueue("play"),m._id;p._webAudio&&e._autoResume();var y=Math.max(0,m._seek>0?m._seek:p._sprite[a][0]/1e3),b=Math.max(0,(p._sprite[a][0]+p._sprite[a][1])/1e3-y),C=b*1e3/Math.abs(m._rate),S=p._sprite[a][0]/1e3,P=(p._sprite[a][0]+p._sprite[a][1])/1e3;m._sprite=a,m._ended=!1;var w=function(){m._paused=!1,m._seek=y,m._start=S,m._stop=P,m._loop=!!(m._loop||p._sprite[a][2])};if(y>=P){p._ended(m);return}var E=m._node;if(p._webAudio){var x=function(){p._playLock=!1,w(),p._refreshBuffer(m);var H=m._muted||p._muted?0:m._volume;E.gain.setValueAtTime(H,e.ctx.currentTime),m._playStart=e.ctx.currentTime,typeof E.bufferSource.start>"u"?m._loop?E.bufferSource.noteGrainOn(0,y,86400):E.bufferSource.noteGrainOn(0,y,b):m._loop?E.bufferSource.start(0,y,86400):E.bufferSource.start(0,y,b),C!==1/0&&(p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),C)),u||setTimeout(function(){p._emit("play",m._id),p._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?x():(p._playLock=!0,p.once("resume",x),p._clearTimer(m._id))}else{var ie=function(){E.currentTime=y,E.muted=m._muted||p._muted||e._muted||E.muted,E.volume=m._volume*e.volume(),E.playbackRate=m._rate;try{var H=E.play();if(H&&typeof Promise<"u"&&(H instanceof Promise||typeof H.then=="function")?(p._playLock=!0,w(),H.then(function(){p._playLock=!1,E._unlocked=!0,u?p._loadQueue():p._emit("play",m._id)}).catch(function(){p._playLock=!1,p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):u||(p._playLock=!1,w(),p._emit("play",m._id)),E.playbackRate=m._rate,E.paused){p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}a!=="__default"||m._loop?p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),C):(p._endTimers[m._id]=function(){p._ended(m),E.removeEventListener("ended",p._endTimers[m._id],!1)},E.addEventListener("ended",p._endTimers[m._id],!1))}catch(z){p._emit("playerror",m._id,z)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=p._src,E.load());var J=window&&window.ejecta||!E.readyState&&e._navigator.isCocoonJS;if(E.readyState>=3||J)ie();else{p._playLock=!0,p._state="loading";var q=function(){p._state="loaded",ie(),E.removeEventListener(e._canPlayEvent,q,!1)};E.addEventListener(e._canPlayEvent,q,!1),p._clearTimer(m._id)}}return m._id},pause:function(a){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(a)}}),u;for(var p=u._getSoundIds(a),h=0;h<p.length;h++){u._clearTimer(p[h]);var g=u._soundById(p[h]);if(g&&!g._paused&&(g._seek=u.seek(p[h]),g._rateSeek=0,g._paused=!0,u._stopFade(p[h]),g._node))if(u._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),u._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||u._emit("pause",g?g._id:null)}return u},stop:function(a,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(a)}}),p;for(var h=p._getSoundIds(a),g=0;g<h.length;g++){p._clearTimer(h[g]);var _=p._soundById(h[g]);_&&(_._seek=_._start||0,_._rateSeek=0,_._paused=!0,_._ended=!0,p._stopFade(h[g]),_._node&&(p._webAudio?_._node.bufferSource&&(typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),p._cleanBuffer(_._node)):(!isNaN(_._node.duration)||_._node.duration===1/0)&&(_._node.currentTime=_._start||0,_._node.pause(),_._node.duration===1/0&&p._clearSound(_._node))),u||p._emit("stop",_._id))}return p},mute:function(a,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(a,u)}}),p;if(typeof u>"u")if(typeof a=="boolean")p._muted=a;else return p._muted;for(var h=p._getSoundIds(u),g=0;g<h.length;g++){var _=p._soundById(h[g]);_&&(_._muted=a,_._interval&&p._stopFade(_._id),p._webAudio&&_._node?_._node.gain.setValueAtTime(a?0:_._volume,e.ctx.currentTime):_._node&&(_._node.muted=e._muted?!0:a),p._emit("mute",_._id))}return p},volume:function(){var a=this,u=arguments,p,h;if(u.length===0)return a._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var g=a._getSoundIds(),_=g.indexOf(u[0]);_>=0?h=parseInt(u[0],10):p=parseFloat(u[0])}else u.length>=2&&(p=parseFloat(u[0]),h=parseInt(u[1],10));var m;if(typeof p<"u"&&p>=0&&p<=1){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,u)}}),a;typeof h>"u"&&(a._volume=p),h=a._getSoundIds(h);for(var v=0;v<h.length;v++)m=a._soundById(h[v]),m&&(m._volume=p,u[2]||a._stopFade(h[v]),a._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(p,e.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=p*e.volume()),a._emit("volume",m._id))}else return m=h?a._soundById(h):a._sounds[0],m?m._volume:0;return a},fade:function(a,u,p,h){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(a,u,p,h)}}),g;a=Math.min(Math.max(0,parseFloat(a)),1),u=Math.min(Math.max(0,parseFloat(u)),1),p=parseFloat(p),g.volume(a,h);for(var _=g._getSoundIds(h),m=0;m<_.length;m++){var v=g._soundById(_[m]);if(v){if(h||g._stopFade(_[m]),g._webAudio&&!v._muted){var y=e.ctx.currentTime,b=y+p/1e3;v._volume=a,v._node.gain.setValueAtTime(a,y),v._node.gain.linearRampToValueAtTime(u,b)}g._startFadeInterval(v,a,u,p,_[m],typeof h>"u")}}return g},_startFadeInterval:function(a,u,p,h,g,_){var m=this,v=u,y=p-u,b=Math.abs(y/.01),C=Math.max(4,b>0?h/b:h),S=Date.now();a._fadeTo=p,a._interval=setInterval(function(){var P=(Date.now()-S)/h;S=Date.now(),v+=y*P,v=Math.round(v*100)/100,y<0?v=Math.max(p,v):v=Math.min(p,v),m._webAudio?a._volume=v:m.volume(v,a._id,!0),_&&(m._volume=v),(p<u&&v<=p||p>u&&v>=p)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,m.volume(p,a._id),m._emit("fade",a._id))},C)},_stopFade:function(a){var u=this,p=u._soundById(a);return p&&p._interval&&(u._webAudio&&p._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(p._interval),p._interval=null,u.volume(p._fadeTo,a),p._fadeTo=null,u._emit("fade",a)),u},loop:function(){var a=this,u=arguments,p,h,g;if(u.length===0)return a._loop;if(u.length===1)if(typeof u[0]=="boolean")p=u[0],a._loop=p;else return g=a._soundById(parseInt(u[0],10)),g?g._loop:!1;else u.length===2&&(p=u[0],h=parseInt(u[1],10));for(var _=a._getSoundIds(h),m=0;m<_.length;m++)g=a._soundById(_[m]),g&&(g._loop=p,a._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=p,p&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,a.playing(_[m])&&(a.pause(_[m],!0),a.play(_[m],!0)))));return a},rate:function(){var a=this,u=arguments,p,h;if(u.length===0)h=a._sounds[0]._id;else if(u.length===1){var g=a._getSoundIds(),_=g.indexOf(u[0]);_>=0?h=parseInt(u[0],10):p=parseFloat(u[0])}else u.length===2&&(p=parseFloat(u[0]),h=parseInt(u[1],10));var m;if(typeof p=="number"){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,u)}}),a;typeof h>"u"&&(a._rate=p),h=a._getSoundIds(h);for(var v=0;v<h.length;v++)if(m=a._soundById(h[v]),m){a.playing(h[v])&&(m._rateSeek=a.seek(h[v]),m._playStart=a._webAudio?e.ctx.currentTime:m._playStart),m._rate=p,a._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(p,e.ctx.currentTime):m._node&&(m._node.playbackRate=p);var y=a.seek(h[v]),b=(a._sprite[m._sprite][0]+a._sprite[m._sprite][1])/1e3-y,C=b*1e3/Math.abs(m._rate);(a._endTimers[h[v]]||!m._paused)&&(a._clearTimer(h[v]),a._endTimers[h[v]]=setTimeout(a._ended.bind(a,m),C)),a._emit("rate",m._id)}}else return m=a._soundById(h),m?m._rate:a._rate;return a},seek:function(){var a=this,u=arguments,p,h;if(u.length===0)a._sounds.length&&(h=a._sounds[0]._id);else if(u.length===1){var g=a._getSoundIds(),_=g.indexOf(u[0]);_>=0?h=parseInt(u[0],10):a._sounds.length&&(h=a._sounds[0]._id,p=parseFloat(u[0]))}else u.length===2&&(p=parseFloat(u[0]),h=parseInt(u[1],10));if(typeof h>"u")return 0;if(typeof p=="number"&&(a._state!=="loaded"||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,u)}}),a;var m=a._soundById(h);if(m)if(typeof p=="number"&&p>=0){var v=a.playing(h);v&&a.pause(h,!0),m._seek=p,m._ended=!1,a._clearTimer(h),!a._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=p);var y=function(){v&&a.play(h,!0),a._emit("seek",h)};if(v&&!a._webAudio){var b=function(){a._playLock?setTimeout(b,0):y()};setTimeout(b,0)}else y()}else if(a._webAudio){var C=a.playing(h)?e.ctx.currentTime-m._playStart:0,S=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(S+C*Math.abs(m._rate))}else return m._node.currentTime;return a},playing:function(a){var u=this;if(typeof a=="number"){var p=u._soundById(a);return p?!p._paused:!1}for(var h=0;h<u._sounds.length;h++)if(!u._sounds[h]._paused)return!0;return!1},duration:function(a){var u=this,p=u._duration,h=u._soundById(a);return h&&(p=u._sprite[h._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var a=this,u=a._sounds,p=0;p<u.length;p++)u[p]._paused||a.stop(u[p]._id),a._webAudio||(a._clearSound(u[p]._node),u[p]._node.removeEventListener("error",u[p]._errorFn,!1),u[p]._node.removeEventListener(e._canPlayEvent,u[p]._loadFn,!1),u[p]._node.removeEventListener("ended",u[p]._endFn,!1),e._releaseHtml5Audio(u[p]._node)),delete u[p]._node,a._clearTimer(u[p]._id);var h=e._howls.indexOf(a);h>=0&&e._howls.splice(h,1);var g=!0;for(p=0;p<e._howls.length;p++)if(e._howls[p]._src===a._src||a._src.indexOf(e._howls[p]._src)>=0){g=!1;break}return o&&g&&delete o[a._src],e.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,u,p,h){var g=this,_=g["_on"+a];return typeof u=="function"&&_.push(h?{id:p,fn:u,once:h}:{id:p,fn:u}),g},off:function(a,u,p){var h=this,g=h["_on"+a],_=0;if(typeof u=="number"&&(p=u,u=null),u||p)for(_=0;_<g.length;_++){var m=p===g[_].id;if(u===g[_].fn&&m||!u&&m){g.splice(_,1);break}}else if(a)h["_on"+a]=[];else{var v=Object.keys(h);for(_=0;_<v.length;_++)v[_].indexOf("_on")===0&&Array.isArray(h[v[_]])&&(h[v[_]]=[])}return h},once:function(a,u,p){var h=this;return h.on(a,u,p,1),h},_emit:function(a,u,p){for(var h=this,g=h["_on"+a],_=g.length-1;_>=0;_--)(!g[_].id||g[_].id===u||a==="load")&&(setTimeout(function(m){m.call(this,u,p)}.bind(h,g[_].fn),0),g[_].once&&h.off(a,g[_].fn,g[_].id));return h._loadQueue(a),h},_loadQueue:function(a){var u=this;if(u._queue.length>0){var p=u._queue[0];p.event===a&&(u._queue.shift(),u._loadQueue()),a||p.action()}return u},_ended:function(a){var u=this,p=a._sprite;if(!u._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(u._ended.bind(u,a),100),u;var h=!!(a._loop||u._sprite[p][2]);if(u._emit("end",a._id),!u._webAudio&&h&&u.stop(a._id,!0).play(a._id),u._webAudio&&h){u._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=e.ctx.currentTime;var g=(a._stop-a._start)*1e3/Math.abs(a._rate);u._endTimers[a._id]=setTimeout(u._ended.bind(u,a),g)}return u._webAudio&&!h&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,u._clearTimer(a._id),u._cleanBuffer(a._node),e._autoSuspend()),!u._webAudio&&!h&&u.stop(a._id,!0),u},_clearTimer:function(a){var u=this;if(u._endTimers[a]){if(typeof u._endTimers[a]!="function")clearTimeout(u._endTimers[a]);else{var p=u._soundById(a);p&&p._node&&p._node.removeEventListener("ended",u._endTimers[a],!1)}delete u._endTimers[a]}return u},_soundById:function(a){for(var u=this,p=0;p<u._sounds.length;p++)if(a===u._sounds[p]._id)return u._sounds[p];return null},_inactiveSound:function(){var a=this;a._drain();for(var u=0;u<a._sounds.length;u++)if(a._sounds[u]._ended)return a._sounds[u].reset();return new i(a)},_drain:function(){var a=this,u=a._pool,p=0,h=0;if(!(a._sounds.length<u)){for(h=0;h<a._sounds.length;h++)a._sounds[h]._ended&&p++;for(h=a._sounds.length-1;h>=0;h--){if(p<=u)return;a._sounds[h]._ended&&(a._webAudio&&a._sounds[h]._node&&a._sounds[h]._node.disconnect(0),a._sounds.splice(h,1),p--)}}},_getSoundIds:function(a){var u=this;if(typeof a>"u"){for(var p=[],h=0;h<u._sounds.length;h++)p.push(u._sounds[h]._id);return p}else return[a]},_refreshBuffer:function(a){var u=this;return a._node.bufferSource=e.ctx.createBufferSource(),a._node.bufferSource.buffer=o[u._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,e.ctx.currentTime),u},_cleanBuffer:function(a){var u=this,p=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),p))try{a.bufferSource.buffer=e._scratchBuffer}catch{}return a.bufferSource=null,u},_clearSound:function(a){var u=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);u||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(a){this._parent=a,this.init()};i.prototype={init:function(){var a=this,u=a._parent;return a._muted=u._muted,a._loop=u._loop,a._volume=u._volume,a._rate=u._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,u._sounds.push(a),a.create(),a},create:function(){var a=this,u=a._parent,p=e._muted||a._muted||a._parent._muted?0:a._volume;return u._webAudio?(a._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),a._node.gain.setValueAtTime(p,e.ctx.currentTime),a._node.paused=!0,a._node.connect(e.masterGain)):e.noAudio||(a._node=e._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(e._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=u._src,a._node.preload=u._preload===!0?"auto":u._preload,a._node.volume=p*e.volume(),a._node.load()),a},reset:function(){var a=this,u=a._parent;return a._muted=u._muted,a._loop=u._loop,a._volume=u._volume,a._rate=u._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,u=a._parent;u._duration=Math.ceil(a._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),a._node.removeEventListener(e._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,u=a._parent;u._duration===1/0&&(u._duration=Math.ceil(a._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}};var o={},s=function(a){var u=a._src;if(o[u]){a._duration=o[u].duration,l(a);return}if(/^data:[^;]+;base64,/.test(u)){for(var p=atob(u.split(",")[1]),h=new Uint8Array(p.length),g=0;g<p.length;++g)h[g]=p.charCodeAt(g);c(h.buffer,a)}else{var _=new XMLHttpRequest;_.open(a._xhr.method,u,!0),_.withCredentials=a._xhr.withCredentials,_.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(m){_.setRequestHeader(m,a._xhr.headers[m])}),_.onload=function(){var m=(_.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){a._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");return}c(_.response,a)},_.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete o[u],a.load())},f(_)}},f=function(a){try{a.send()}catch{a.onerror()}},c=function(a,u){var p=function(){u._emit("loaderror",null,"Decoding audio data failed.")},h=function(g){g&&u._sounds.length>0?(o[u._src]=g,l(u,g)):p()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(a).then(h).catch(p):e.ctx.decodeAudioData(a,h,p)},l=function(a,u){u&&!a._duration&&(a._duration=u.duration),Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue())},d=function(){if(!!e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),u=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=u?parseInt(u[1],10):null;if(a&&p&&p<9){var h=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!h&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};n.Howler=e,n.Howl=r,typeof ze<"u"?(ze.HowlerGlobal=t,ze.Howler=e,ze.Howl=r,ze.Sound=i):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=r,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var i=r._howls.length-1;i>=0;i--)r._howls[i].stereo(e);return r},HowlerGlobal.prototype.pos=function(e,r,i){var o=this;if(!o.ctx||!o.ctx.listener)return o;if(r=typeof r!="number"?o._pos[1]:r,i=typeof i!="number"?o._pos[2]:i,typeof e=="number")o._pos=[e,r,i],typeof o.ctx.listener.positionX<"u"?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]);else return o._pos;return o},HowlerGlobal.prototype.orientation=function(e,r,i,o,s,f){var c=this;if(!c.ctx||!c.ctx.listener)return c;var l=c._orientation;if(r=typeof r!="number"?l[1]:r,i=typeof i!="number"?l[2]:i,o=typeof o!="number"?l[3]:o,s=typeof s!="number"?l[4]:s,f=typeof f!="number"?l[5]:f,typeof e=="number")c._orientation=[e,r,i,o,s,f],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(s,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(f,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(e,r,i,o,s,f);else return l;return c},Howl.prototype.init=function(e){return function(r){var i=this;return i._orientation=r.orientation||[1,0,0],i._stereo=r.stereo||null,i._pos=r.pos||null,i._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},i._onstereo=r.onstereo?[{fn:r.onstereo}]:[],i._onpos=r.onpos?[{fn:r.onpos}]:[],i._onorientation=r.onorientation?[{fn:r.onorientation}]:[],e.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,r){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(e,r)}}),i;var o=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof e=="number")i._stereo=e,i._pos=[e,0,0];else return i._stereo;for(var s=i._getSoundIds(r),f=0;f<s.length;f++){var c=i._soundById(s[f]);if(c)if(typeof e=="number")c._stereo=e,c._pos=[e,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&t(c,o),o==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(e,0,0):c._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",c._id);else return c._stereo}return i},Howl.prototype.pos=function(e,r,i,o){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"pos",action:function(){s.pos(e,r,i,o)}}),s;if(r=typeof r!="number"?0:r,i=typeof i!="number"?-.5:i,typeof o>"u")if(typeof e=="number")s._pos=[e,r,i];else return s._pos;for(var f=s._getSoundIds(o),c=0;c<f.length;c++){var l=s._soundById(f[c]);if(l)if(typeof e=="number")l._pos=[e,r,i],l._node&&((!l._panner||l._panner.pan)&&t(l,"spatial"),typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setPosition(e,r,i)),s._emit("pos",l._id);else return l._pos}return s},Howl.prototype.orientation=function(e,r,i,o){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"orientation",action:function(){s.orientation(e,r,i,o)}}),s;if(r=typeof r!="number"?s._orientation[1]:r,i=typeof i!="number"?s._orientation[2]:i,typeof o>"u")if(typeof e=="number")s._orientation=[e,r,i];else return s._orientation;for(var f=s._getSoundIds(o),c=0;c<f.length;c++){var l=s._soundById(f[c]);if(l)if(typeof e=="number")l._orientation=[e,r,i],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),t(l,"spatial")),typeof l._panner.orientationX<"u"?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setOrientation(e,r,i)),s._emit("orientation",l._id);else return l._orientation}return s},Howl.prototype.pannerAttr=function(){var e=this,r=arguments,i,o,s;if(!e._webAudio)return e;if(r.length===0)return e._pannerAttr;if(r.length===1)if(typeof r[0]=="object")i=r[0],typeof o>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),e._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:e._panningModel});else return s=e._soundById(parseInt(r[0],10)),s?s._pannerAttr:e._pannerAttr;else r.length===2&&(i=r[0],o=parseInt(r[1],10));for(var f=e._getSoundIds(o),c=0;c<f.length;c++)if(s=e._soundById(f[c]),s){var l=s._pannerAttr;l={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:l.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:l.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:l.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:l.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:l.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:l.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:l.panningModel};var d=s._panner;d?(d.coneInnerAngle=l.coneInnerAngle,d.coneOuterAngle=l.coneOuterAngle,d.coneOuterGain=l.coneOuterGain,d.distanceModel=l.distanceModel,d.maxDistance=l.maxDistance,d.refDistance=l.refDistance,d.rolloffFactor=l.rolloffFactor,d.panningModel=l.panningModel):(s._pos||(s._pos=e._pos||[0,0,-.5]),t(s,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var r=this,i=r._parent;r._orientation=i._orientation,r._stereo=i._stereo,r._pos=i._pos,r._pannerAttr=i._pannerAttr,e.call(this),r._stereo?i.stereo(r._stereo):r._pos&&i.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var r=this,i=r._parent;return r._orientation=i._orientation,r._stereo=i._stereo,r._pos=i._pos,r._pannerAttr=i._pannerAttr,r._stereo?i.stereo(r._stereo):r._pos?i.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,i._refreshBuffer(r)),e.call(this)}}(Sound.prototype.reset);var t=function(e,r){r=r||"spatial",r==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(Ye);class co{constructor(){ue(this,"diceSound",new Ye.Howl({src:["dice.mp3"]}));ue(this,"clickSound",new Ye.Howl({src:["click.mp3"]}));ue(this,"tadaSound",new Ye.Howl({src:["tada.mp3"]}));ue(this,"destroySound",new Ye.Howl({src:["destroy.ogg"]}))}playDice(){this.diceSound.play()}playClick(){this.clickSound.play()}playTada(){this.tadaSound.play()}playDestroy(){this.destroySound.play()}}const pt=new co;function lo(n,t,e){return Object.assign(new Array(t).fill(null).map(()=>e()),n)}function uo(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function Fr(){return uo(1,6)}const et=(n=null)=>({id:po(),removing:!1,value:n}),Nt=()=>[et(),et(),et()],ht=()=>[Nt(),Nt(),Nt()];function it(n){return n.filter(t=>t.value!==null).map(t=>t.value*n.filter(e=>e.value===t.value).length).reduce((t,e)=>t+e,0)}function Le(n){return n.reduce((t,e)=>t+it(e),0)}function Dn(n){return n.every(Pt)}function He(n){return n===1?2:1}function Pt(n){return n.every(t=>t.value!==null)}let fo=0;function po(){return++fo}function Rt(n,t){return t.filter(e=>e.value===n.value).length>1}function At(n){return n===1?"\u{1F984}":"\u{1F43C}"}class ho{constructor(t){ue(this,"state",Lr({type:"init"}));ue(this,"player");ue(this,"competitor");ue(this,"firstPlayerMove",1);this.player=t,this.competitor=He(t)}startGame(){this.state.set({type:"playing",boards:{1:ht(),2:ht()},currentMove:this.firstPlayerMove,dice:null,pause:!1})}action(t){switch(t.type){case"DICE":return this.setDice(t.value);case"GAME":return this.makeTurn(t.line);case"RESET":return this.resetGame();default:return!1}}makeTurn(t){const e=Qe(this.state);if(e.type!=="playing")return!1;const{dice:r,currentMove:i,boards:o}=e;if(!r||Pt(o[i][t]))return!1;const s={...o},f=He(i),c=s[i][t],l=s[f][t],d=c.findIndex(a=>a.value===null);if(c[d]=et(r),pt.playClick(),l.filter(a=>a.value===r).length&&(l.filter(a=>a.value===r).forEach(a=>{a.removing=!0}),pt.playDestroy(),setTimeout(()=>{s[f][t]=lo(l.filter(a=>a.value!==r),3,et),this.state.update(a=>a.type==="playing"?{...a,boards:s}:a)},1500)),this.checkEnd(s)){const a=this.getEndResult(s);this.state.set({type:"end",result:a,boards:s}),a==="win"&&pt.playTada()}else this.state.update(a=>({...a,boards:s,currentMove:He(i),dice:null}));return!0}setDice(t){return Qe(this.state).type!=="playing"?!1:(this.state.update(r=>({...r,dice:t,pause:!0})),pt.playDice(),setTimeout(()=>{this.state.update(r=>({...r,pause:!1}))},1500),!0)}resetGame(){return Qe(this.state).type!=="end"?!1:(this.state.set({type:"playing",boards:{1:ht(),2:ht()},currentMove:He(this.firstPlayerMove),dice:null,pause:!1}),this.firstPlayerMove=He(this.firstPlayerMove),!0)}checkEnd(t){return Dn(t[1])||Dn(t[2])}getEndResult(t){const e=Le(t[this.player]),r=Le(t[this.competitor]);return e===r?"draw":e>r?"win":"lose"}}const mo="/knucklebones/assets/dice-1.ef65f48b.svg",go="/knucklebones/assets/dice-2.0fc66d7c.svg",_o="/knucklebones/assets/dice-3.89a50367.svg",vo="/knucklebones/assets/dice-4.d55f5abd.svg",yo="/knucklebones/assets/dice-5.b27f5ebd.svg",bo="/knucklebones/assets/dice-6.2867bcc8.svg";function Co(n){let t,e;return{c(){t=I("div"),T(t,"class",e=Z(`dice empty ${n[1]}`)+" svelte-oef3kg")},m(r,i){O(r,t,i)},p(r,i){i&2&&e!==(e=Z(`dice empty ${r[1]}`)+" svelte-oef3kg")&&T(t,"class",e)},d(r){r&&M(t)}}}function So(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=bo)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 6"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function To(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=yo)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 5"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function ko(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=vo)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 4"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function Eo(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=_o)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 3"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function Po(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=go)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 2"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function Ro(n){let t,e,r;return{c(){t=I("img"),Ce(t.src,e=mo)||T(t,"src",e),T(t,"class",r=Z(`dice ${n[1]}`)+" svelte-oef3kg"),T(t,"alt","Dice 1"),G(t,"removing",n[2]),G(t,"doubled",n[3])},m(i,o){O(i,t,o)},p(i,o){o&2&&r!==(r=Z(`dice ${i[1]}`)+" svelte-oef3kg")&&T(t,"class",r),o&6&&G(t,"removing",i[2]),o&10&&G(t,"doubled",i[3])},d(i){i&&M(t)}}}function Ao(n){let t;function e(o,s){return o[0]===1?Ro:o[0]===2?Po:o[0]===3?Eo:o[0]===4?ko:o[0]===5?To:o[0]===6?So:Co}let r=e(n),i=r(n);return{c(){i.c(),t=we()},m(o,s){i.m(o,s),O(o,t,s)},p(o,[s]){r===(r=e(o))&&i?i.p(o,s):(i.d(1),i=r(o),i&&(i.c(),i.m(t.parentNode,t)))},i:N,o:N,d(o){i.d(o),o&&M(t)}}}function xo(n,t,e){let{value:r}=t,{side:i}=t,{removing:o=!1}=t,{doubled:s=!1}=t;return n.$$set=f=>{"value"in f&&e(0,r=f.value),"side"in f&&e(1,i=f.side),"removing"in f&&e(2,o=f.removing),"doubled"in f&&e(3,s=f.doubled)},[r,i,o,s]}class Te extends Pe{constructor(t){super(),Ee(this,t,xo,Ao,Se,{value:0,side:1,removing:2,doubled:3})}}function On(n){let t,e,r,i,o,s,f,c,l,d,a,u,p,h,g,_,m,v,y,b;return r=new Te({props:{value:1,side:"none"}}),s=new Te({props:{value:2,side:"none"}}),l=new Te({props:{value:3,side:"none"}}),u=new Te({props:{value:4,side:"none"}}),g=new Te({props:{value:5,side:"none"}}),v=new Te({props:{value:6,side:"none"}}),{c(){t=I("div"),e=I("div"),ce(r.$$.fragment),i=$(),o=I("div"),ce(s.$$.fragment),f=$(),c=I("div"),ce(l.$$.fragment),d=$(),a=I("div"),ce(u.$$.fragment),p=$(),h=I("div"),ce(g.$$.fragment),_=$(),m=I("div"),ce(v.$$.fragment),T(e,"class","side one svelte-1odaak4"),T(o,"class","side two svelte-1odaak4"),T(c,"class","side three svelte-1odaak4"),T(a,"class","side four svelte-1odaak4"),T(h,"class","side five svelte-1odaak4"),T(m,"class","side six svelte-1odaak4"),T(t,"class",y=Z(`dice show-${n[0]}`)+" svelte-1odaak4")},m(C,S){O(C,t,S),R(t,e),te(r,e,null),R(t,i),R(t,o),te(s,o,null),R(t,f),R(t,c),te(l,c,null),R(t,d),R(t,a),te(u,a,null),R(t,p),R(t,h),te(g,h,null),R(t,_),R(t,m),te(v,m,null),b=!0},p(C,S){(!b||S&1&&y!==(y=Z(`dice show-${C[0]}`)+" svelte-1odaak4"))&&T(t,"class",y)},i(C){b||(B(r.$$.fragment,C),B(s.$$.fragment,C),B(l.$$.fragment,C),B(u.$$.fragment,C),B(g.$$.fragment,C),B(v.$$.fragment,C),b=!0)},o(C){j(r.$$.fragment,C),j(s.$$.fragment,C),j(l.$$.fragment,C),j(u.$$.fragment,C),j(g.$$.fragment,C),j(v.$$.fragment,C),b=!1},d(C){C&&M(t),ne(r),ne(s),ne(l),ne(u),ne(g),ne(v)}}}function Io(n){let t,e,r=n[0]&&On(n);return{c(){r&&r.c(),t=we()},m(i,o){r&&r.m(i,o),O(i,t,o),e=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&B(r,1)):(r=On(i),r.c(),B(r,1),r.m(t.parentNode,t)):r&&(he(),j(r,1,1,()=>{r=null}),me())},i(i){e||(B(r),e=!0)},o(i){j(r),e=!1},d(i){r&&r.d(i),i&&M(t)}}}function wo(n,t,e){let{value:r}=t;return n.$$set=i=>{"value"in i&&e(0,r=i.value)},[r]}class Mo extends Pe{constructor(t){super(),Ee(this,t,wo,Io,Se,{value:0})}}function dn(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Bn(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function pn(n,t,e){return t&&Bn(n.prototype,t),e&&Bn(n,e),n}function Ln(n){return+n.replace(/px/,"")}function Do(n){var t=window.devicePixelRatio,e=getComputedStyle(n),r=Ln(e.getPropertyValue("width")),i=Ln(e.getPropertyValue("height"));n.setAttribute("width",(r*t).toString()),n.setAttribute("height",(i*t).toString())}function fe(n,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=Math.random()*(t-n)+n;return Math.floor(r*Math.pow(10,e))/Math.pow(10,e)}function Fn(n){return n[fe(0,n.length)]}var Oo=.00125,Bo=5e-4,Lo=9e-4,Fo=1e-5,jo=6,$o=80,No=.9,Uo=1.7,Go=.2,zo=.6,Ho=.03,Vo=.07,jn=15,$n=82,Jo=150,qo=100,Yo=250,Ko=40,Wo=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function Nn(n){var t=1920;return Math.log(n)/Math.log(t)}var Un=function(){function n(t){dn(this,n);var e=t.initialPosition,r=t.direction,i=t.confettiRadius,o=t.confettiColors,s=t.emojis,f=t.emojiSize,c=t.canvasWidth,l=fe(No,Uo,3),d=l*Nn(c);this.confettiSpeed={x:d,y:d},this.finalConfettiSpeedX=fe(Go,zo,3),this.rotationSpeed=s.length?.01:fe(Ho,Vo,3)*Nn(c),this.dragForceCoefficient=fe(Bo,Lo,6),this.radius={x:i,y:i},this.initialRadius=i,this.rotationAngle=r==="left"?fe(0,.2,3):fe(-.2,0,3),this.emojiSize=f,this.emojiRotationAngle=fe(0,2*Math.PI),this.radiusYUpdateDirection="down";var a=r==="left"?fe($n,jn)*Math.PI/180:fe(-jn,-$n)*Math.PI/180;this.absCos=Math.abs(Math.cos(a)),this.absSin=Math.abs(Math.sin(a));var u=fe(-Jo,0),p={x:e.x+(r==="left"?-u:u)*this.absCos,y:e.y-u*this.absSin};this.currentPosition=Object.assign({},p),this.initialPosition=Object.assign({},p),this.color=s.length?null:Fn(o),this.emoji=s.length?Fn(s):null,this.createdAt=new Date().getTime(),this.direction=r}return pn(n,[{key:"draw",value:function(e){var r=this.currentPosition,i=this.radius,o=this.color,s=this.emoji,f=this.rotationAngle,c=this.emojiRotationAngle,l=this.emojiSize,d=window.devicePixelRatio;o?(e.fillStyle=o,e.beginPath(),e.ellipse(r.x*d,r.y*d,i.x*d,i.y*d,f,0,2*Math.PI),e.fill()):s&&(e.font="".concat(l,"px serif"),e.save(),e.translate(d*r.x,d*r.y),e.rotate(c),e.textAlign="center",e.fillText(s,0,0),e.restore())}},{key:"updatePosition",value:function(e,r){var i=this.confettiSpeed,o=this.dragForceCoefficient,s=this.finalConfettiSpeedX,f=this.radiusYUpdateDirection,c=this.rotationSpeed,l=this.createdAt,d=this.direction,a=r-l;if(i.x>s&&(this.confettiSpeed.x-=o*e),this.currentPosition.x+=i.x*(d==="left"?-this.absCos:this.absCos)*e,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*a+Oo*Math.pow(a,2)/2,this.rotationSpeed-=this.emoji?1e-4:Fo*e,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji){this.emojiRotationAngle+=this.rotationSpeed*e%(2*Math.PI);return}f==="down"?(this.radius.y-=e*c,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=e*c,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(e){return this.currentPosition.y<e+qo}}]),n}();function Xo(){var n=document.createElement("canvas");return n.style.position="fixed",n.style.width="100%",n.style.height="100%",n.style.top="0",n.style.left="0",n.style.zIndex="1000",n.style.pointerEvents="none",document.body.appendChild(n),n}function Qo(n){var t=n.confettiRadius,e=t===void 0?jo:t,r=n.confettiNumber,i=r===void 0?n.confettiesNumber||(n.emojis?Ko:Yo):r,o=n.confettiColors,s=o===void 0?Wo:o,f=n.emojis,c=f===void 0?n.emojies||[]:f,l=n.emojiSize,d=l===void 0?$o:l;return n.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),n.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:e,confettiNumber:i,confettiColors:s,emojis:c,emojiSize:d}}var Zo=function(){function n(t){var e=this;dn(this,n),this.canvasContext=t,this.shapes=[],this.promise=new Promise(function(r){return e.resolvePromise=r})}return pn(n,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var e;(e=this.shapes).push.apply(e,arguments)}},{key:"complete",value:function(){var e;return this.shapes.length?!1:((e=this.resolvePromise)===null||e===void 0||e.call(this),!0)}},{key:"processShapes",value:function(e,r,i){var o=this,s=e.timeDelta,f=e.currentTime;this.shapes=this.shapes.filter(function(c){return c.updatePosition(s,f),c.draw(o.canvasContext),i?c.getIsVisibleOnCanvas(r):!0})}}]),n}(),ea=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};dn(this,n),this.activeConfettiBatches=[],this.canvas=t.canvas||Xo(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=new Date().getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return pn(n,[{key:"loop",value:function(){this.requestAnimationFrameRequested=!1,Do(this.canvas);var e=new Date().getTime(),r=e-this.lastUpdated,i=this.canvas.offsetHeight,o=this.iterationIndex%10===0;this.activeConfettiBatches=this.activeConfettiBatches.filter(function(s){return s.processShapes({timeDelta:r,currentTime:e},i,o),o?!s.complete():!0}),this.iterationIndex++,this.queueAnimationFrameIfNeeded(e)}},{key:"queueAnimationFrameIfNeeded",value:function(e){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=e||new Date().getTime(),requestAnimationFrame(this.loop))}},{key:"addConfetti",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=Qo(e),i=r.confettiRadius,o=r.confettiNumber,s=r.confettiColors,f=r.emojis,c=r.emojiSize,l=this.canvas.getBoundingClientRect(),d=l.width,a=l.height,u=a*5/7,p={x:0,y:u},h={x:d,y:u},g=new Zo(this.canvasContext),_=0;_<o/2;_++){var m=new Un({initialPosition:p,direction:"right",confettiRadius:i,confettiColors:s,confettiNumber:o,emojis:f,emojiSize:c,canvasWidth:d}),v=new Un({initialPosition:h,direction:"left",confettiRadius:i,confettiColors:s,confettiNumber:o,emojis:f,emojiSize:c,canvasWidth:d});g.addShapes(m,v)}return this.activeConfettiBatches.push(g),this.queueAnimationFrameIfNeeded(),g.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}}]),n}();function Gn(n,t,e){const r=n.slice();return r[13]=t[e],r[15]=e,r}function zn(n,t,e){const r=n.slice();return r[16]=t[e],r}function Hn(n,t,e){const r=n.slice();return r[13]=t[e],r}function Vn(n,t,e){const r=n.slice();return r[16]=t[e],r}function Jn(n){let t,e,r,i,o,s,f,c=Le(n[1].boards[n[5]])+"",l,d,a,u,p,h,g,_,m=Le(n[1].boards[n[4]])+"",v,y,b,C,S,P,w=n[1].boards[n[5]],E=[];for(let A=0;A<w.length;A+=1)E[A]=Yn(Hn(n,w,A));const x=A=>j(E[A],1,1,()=>{E[A]=null}),ie=[na,ta],J=[];function q(A,L){return A[1].type==="playing"?0:A[1].type==="end"?1:-1}~(u=q(n))&&(p=J[u]=ie[u](n));let H=n[1].boards[n[4]],z=[];for(let A=0;A<H.length;A+=1)z[A]=Zn(Gn(n,H,A));const Ge=A=>j(z[A],1,1,()=>{z[A]=null});return{c(){t=I("div"),e=I("h2"),e.textContent=`${At(n[5])} Player #${n[5]}`,r=$(),i=I("div");for(let A=0;A<E.length;A+=1)E[A].c();o=$(),s=I("h2"),f=Q("Score: "),l=Q(c),d=$(),a=I("div"),p&&p.c(),h=$(),g=I("h2"),_=Q("Score: "),v=Q(m),y=$(),b=I("div");for(let A=0;A<z.length;A+=1)z[A].c();C=$(),S=I("h2"),S.textContent=`${At(n[4])} Player #${n[4]}`,T(e,"class","player-info competitor svelte-1vgezg3"),G(e,"turn",!n[0]),T(i,"class","board svelte-1vgezg3"),T(s,"class","points svelte-1vgezg3"),T(a,"class","state svelte-1vgezg3"),T(g,"class","points svelte-1vgezg3"),T(b,"class","board svelte-1vgezg3"),T(S,"class","player-info player svelte-1vgezg3"),G(S,"turn",n[0]),T(t,"class","container svelte-1vgezg3")},m(A,L){O(A,t,L),R(t,e),R(t,r),R(t,i);for(let oe=0;oe<E.length;oe+=1)E[oe].m(i,null);R(t,o),R(t,s),R(s,f),R(s,l),R(t,d),R(t,a),~u&&J[u].m(a,null),R(t,h),R(t,g),R(g,_),R(g,v),R(t,y),R(t,b);for(let oe=0;oe<z.length;oe+=1)z[oe].m(b,null);R(t,C),R(t,S),P=!0},p(A,L){if((!P||L&1)&&G(e,"turn",!A[0]),L&34){w=A[1].boards[A[5]];let F;for(F=0;F<w.length;F+=1){const ve=Hn(A,w,F);E[F]?(E[F].p(ve,L),B(E[F],1)):(E[F]=Yn(ve),E[F].c(),B(E[F],1),E[F].m(i,null))}for(he(),F=w.length;F<E.length;F+=1)x(F);me()}(!P||L&2)&&c!==(c=Le(A[1].boards[A[5]])+"")&&pe(l,c);let oe=u;if(u=q(A),u===oe?~u&&J[u].p(A,L):(p&&(he(),j(J[oe],1,1,()=>{J[oe]=null}),me()),~u?(p=J[u],p?p.p(A,L):(p=J[u]=ie[u](A),p.c()),B(p,1),p.m(a,null)):p=null),(!P||L&2)&&m!==(m=Le(A[1].boards[A[4]])+"")&&pe(v,m),L&86){H=A[1].boards[A[4]];let F;for(F=0;F<H.length;F+=1){const ve=Gn(A,H,F);z[F]?(z[F].p(ve,L),B(z[F],1)):(z[F]=Zn(ve),z[F].c(),B(z[F],1),z[F].m(b,null))}for(he(),F=H.length;F<z.length;F+=1)Ge(F);me()}(!P||L&1)&&G(S,"turn",A[0])},i(A){if(!P){for(let L=0;L<w.length;L+=1)B(E[L]);B(p);for(let L=0;L<H.length;L+=1)B(z[L]);P=!0}},o(A){E=E.filter(Boolean);for(let L=0;L<E.length;L+=1)j(E[L]);j(p),z=z.filter(Boolean);for(let L=0;L<z.length;L+=1)j(z[L]);P=!1},d(A){A&&M(t),xn(E,A),~u&&J[u].d(),xn(z,A)}}}function qn(n,t){let e,r,i;return r=new Te({props:{value:t[16].value,removing:t[16].removing,doubled:Rt(t[16],t[13]),side:"competitor"}}),{key:n,first:null,c(){e=we(),ce(r.$$.fragment),this.first=e},m(o,s){O(o,e,s),te(r,o,s),i=!0},p(o,s){t=o;const f={};s&2&&(f.value=t[16].value),s&2&&(f.removing=t[16].removing),s&2&&(f.doubled=Rt(t[16],t[13])),r.$set(f)},i(o){i||(B(r.$$.fragment,o),i=!0)},o(o){j(r.$$.fragment,o),i=!1},d(o){o&&M(e),ne(r,o)}}}function Yn(n){let t,e,r=it(n[13])+"",i,o,s=[],f=new Map,c,l,d=n[13];const a=u=>u[16].id;for(let u=0;u<d.length;u+=1){let p=Vn(n,d,u),h=a(p);f.set(h,s[u]=qn(h,p))}return{c(){t=I("button"),e=I("h2"),i=Q(r),o=$();for(let u=0;u<s.length;u+=1)s[u].c();c=$(),T(e,"class","line-points svelte-1vgezg3"),T(t,"class","line line-copmetitor svelte-1vgezg3"),t.disabled=!0},m(u,p){O(u,t,p),R(t,e),R(e,i),R(t,o);for(let h=0;h<s.length;h+=1)s[h].m(t,null);R(t,c),l=!0},p(u,p){(!l||p&2)&&r!==(r=it(u[13])+"")&&pe(i,r),p&34&&(d=u[13],he(),s=Br(s,p,a,1,u,d,f,t,Or,qn,c,Vn),me())},i(u){if(!l){for(let p=0;p<d.length;p+=1)B(s[p]);l=!0}},o(u){for(let p=0;p<s.length;p+=1)j(s[p]);l=!1},d(u){u&&M(t);for(let p=0;p<s.length;p+=1)s[p].d()}}}function ta(n){let t,e,r,i,o,s,f=n[1].result==="win"&&Kn(),c=n[1].result==="lose"&&Wn(),l=n[1].result==="draw"&&Xn();return{c(){f&&f.c(),t=$(),c&&c.c(),e=$(),l&&l.c(),r=$(),i=I("button"),i.textContent="\u{1F504} Reset"},m(d,a){f&&f.m(d,a),O(d,t,a),c&&c.m(d,a),O(d,e,a),l&&l.m(d,a),O(d,r,a),O(d,i,a),o||(s=Me(i,"click",n[7]),o=!0)},p(d,a){d[1].result==="win"?f||(f=Kn(),f.c(),f.m(t.parentNode,t)):f&&(f.d(1),f=null),d[1].result==="lose"?c||(c=Wn(),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),d[1].result==="draw"?l||(l=Xn(),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},i:N,o:N,d(d){f&&f.d(d),d&&M(t),c&&c.d(d),d&&M(e),l&&l.d(d),d&&M(r),d&&M(i),o=!1,s()}}}function na(n){let t,e=At(n[1].currentMove)+"",r,i,o=n[0]?"Your turn":"Opponent's move",s,f,c,l;return c=new Mo({props:{value:n[1].dice}}),{c(){t=I("h2"),r=Q(e),i=$(),s=Q(o),f=$(),ce(c.$$.fragment),T(t,"class","svelte-1vgezg3")},m(d,a){O(d,t,a),R(t,r),R(t,i),R(t,s),O(d,f,a),te(c,d,a),l=!0},p(d,a){(!l||a&2)&&e!==(e=At(d[1].currentMove)+"")&&pe(r,e),(!l||a&1)&&o!==(o=d[0]?"Your turn":"Opponent's move")&&pe(s,o);const u={};a&2&&(u.value=d[1].dice),c.$set(u)},i(d){l||(B(c.$$.fragment,d),l=!0)},o(d){j(c.$$.fragment,d),l=!1},d(d){d&&M(t),d&&M(f),ne(c,d)}}}function Kn(n){let t;return{c(){t=I("h2"),t.textContent="\u{1F3C6} You won!",T(t,"class","svelte-1vgezg3")},m(e,r){O(e,t,r)},d(e){e&&M(t)}}}function Wn(n){let t;return{c(){t=I("h2"),t.textContent="\u{1F625} You lose",T(t,"class","svelte-1vgezg3")},m(e,r){O(e,t,r)},d(e){e&&M(t)}}}function Xn(n){let t;return{c(){t=I("h2"),t.textContent="\u{1F91D} Draw",T(t,"class","svelte-1vgezg3")},m(e,r){O(e,t,r)},d(e){e&&M(t)}}}function Qn(n,t){let e,r,i;return r=new Te({props:{value:t[16].value,removing:t[16].removing,doubled:Rt(t[16],t[13]),side:"player"}}),{key:n,first:null,c(){e=we(),ce(r.$$.fragment),this.first=e},m(o,s){O(o,e,s),te(r,o,s),i=!0},p(o,s){t=o;const f={};s&2&&(f.value=t[16].value),s&2&&(f.removing=t[16].removing),s&2&&(f.doubled=Rt(t[16],t[13])),r.$set(f)},i(o){i||(B(r.$$.fragment,o),i=!0)},o(o){j(r.$$.fragment,o),i=!1},d(o){o&&M(e),ne(r,o)}}}function Zn(n){let t,e,r=it(n[13])+"",i,o,s=[],f=new Map,c,l,d,a,u,p=n[13];const h=_=>_[16].id;for(let _=0;_<p.length;_+=1){let m=zn(n,p,_),v=h(m);f.set(v,s[_]=Qn(v,m))}function g(){return n[9](n[15])}return{c(){t=I("button"),e=I("h2"),i=Q(r),o=$();for(let _=0;_<s.length;_+=1)s[_].c();c=$(),T(e,"class","line-points svelte-1vgezg3"),T(t,"class","line svelte-1vgezg3"),t.disabled=l=n[2]||Pt(n[13])},m(_,m){O(_,t,m),R(t,e),R(e,i),R(t,o);for(let v=0;v<s.length;v+=1)s[v].m(t,null);R(t,c),d=!0,a||(u=Me(t,"click",g),a=!0)},p(_,m){n=_,(!d||m&2)&&r!==(r=it(n[13])+"")&&pe(i,r),m&18&&(p=n[13],he(),s=Br(s,m,h,1,n,p,f,t,Or,Qn,c,zn),me()),(!d||m&6&&l!==(l=n[2]||Pt(n[13])))&&(t.disabled=l)},i(_){if(!d){for(let m=0;m<p.length;m+=1)B(s[m]);d=!0}},o(_){for(let m=0;m<s.length;m+=1)j(s[m]);d=!1},d(_){_&&M(t);for(let m=0;m<s.length;m+=1)s[m].d();a=!1,u()}}}function ra(n){let t,e,r=(n[1].type==="playing"||n[1].type==="end")&&Jn(n);return{c(){r&&r.c(),t=we()},m(i,o){r&&r.m(i,o),O(i,t,o),e=!0},p(i,[o]){i[1].type==="playing"||i[1].type==="end"?r?(r.p(i,o),o&2&&B(r,1)):(r=Jn(i),r.c(),B(r,1),r.m(t.parentNode,t)):r&&(he(),j(r,1,1,()=>{r=null}),me())},i(i){e||(B(r),e=!0)},o(i){j(r),e=!1},d(i){r&&r.d(i),i&&M(t)}}}function ia(n,t,e){let r,i,o,{game:s}=t;const{state:f,player:c,competitor:l}=s;wr(n,f,_=>e(1,o=_));const d=new ea,a=Zi(),u=_=>a("action",_),p=_=>u({type:"GAME",line:_}),h=()=>u({type:"RESET"});fn(()=>{s.startGame(),c===1&&u({type:"DICE",value:Fr()})});const g=_=>p(_);return n.$$set=_=>{"game"in _&&e(8,s=_.game)},n.$$.update=()=>{n.$$.dirty&2&&e(0,r=o.type==="playing"&&c===o.currentMove),n.$$.dirty&3&&e(2,i=o.type!=="playing"||o.pause||!r),n.$$.dirty&2&&o.type==="end"&&o.result==="win"&&d.addConfetti({emojis:["\u{1F308}","\u26A1\uFE0F","\u{1F4A5}","\u2728","\u{1F4AB}","\u{1F338}","\u{1F389}","\u{1F38A}","\u{1F4A9}"]})},[r,o,i,f,c,l,p,h,s,g]}class oa extends Pe{constructor(t){super(),Ee(this,t,ia,ra,Se,{game:8})}}var hn={exports:{}};(function(n){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=t;var e=n.exports.BlobBuilder;typeof window<"u"&&(e=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function r(){this._pieces=[],this._parts=[]}r.prototype.append=function(i){typeof i=="number"?this._pieces.push(i):(this.flush(),this._parts.push(i))},r.prototype.flush=function(){if(this._pieces.length>0){var i=new Uint8Array(this._pieces);t.useArrayBufferView||(i=i.buffer),this._parts.push(i),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var i=new e,o=0,s=this._parts.length;o<s;o++)i.append(this._parts[o]);return i.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=r})(hn);var aa=hn.exports.BufferBuilder,er=hn.exports.binaryFeatures,sa={unpack:function(n){var t=new K(n);return t.unpack()},pack:function(n){var t=new W;t.pack(n);var e=t.getBuffer();return e}},tr=sa;function K(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}K.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var t;if((t=n^160)<=15)return this.unpack_raw(t);if((t=n^176)<=15)return this.unpack_string(t);if((t=n^144)<=15)return this.unpack_array(t);if((t=n^128)<=15)return this.unpack_map(t);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};K.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};K.prototype.unpack_uint16=function(){var n=this.read(2),t=(n[0]&255)*256+(n[1]&255);return this.index+=2,t};K.prototype.unpack_uint32=function(){var n=this.read(4),t=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,t};K.prototype.unpack_uint64=function(){var n=this.read(8),t=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,t};K.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-(1<<8)};K.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-(1<<16)};K.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};K.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};K.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,t};K.prototype.unpack_string=function(n){for(var t=this.read(n),e=0,r="",i,o;e<n;)i=t[e],i<128?(r+=String.fromCharCode(i),e++):(i^192)<32?(o=(i^192)<<6|t[e+1]&63,r+=String.fromCharCode(o),e+=2):(o=(i&15)<<12|(t[e+1]&63)<<6|t[e+2]&63,r+=String.fromCharCode(o),e+=3);return this.index+=n,r};K.prototype.unpack_array=function(n){for(var t=new Array(n),e=0;e<n;e++)t[e]=this.unpack();return t};K.prototype.unpack_map=function(n){for(var t={},e=0;e<n;e++){var r=this.unpack(),i=this.unpack();t[r]=i}return t};K.prototype.unpack_float=function(){var n=this.unpack_uint32(),t=n>>31,e=(n>>23&255)-127,r=n&8388607|8388608;return(t===0?1:-1)*r*Math.pow(2,e-23)};K.prototype.unpack_double=function(){var n=this.unpack_uint32(),t=this.unpack_uint32(),e=n>>31,r=(n>>20&2047)-1023,i=n&1048575|1048576,o=i*Math.pow(2,r-20)+t*Math.pow(2,r-52);return(e===0?1:-1)*o};K.prototype.read=function(n){var t=this.index;if(t+n<=this.length)return this.dataView.subarray(t,t+n);throw new Error("BinaryPackFailure: read index out of range")};function W(){this.bufferBuilder=new aa}W.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};W.prototype.pack=function(n){var t=typeof n;if(t==="string")this.pack_string(n);else if(t==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(t==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(n===null)this.bufferBuilder.append(192);else{var e=n.constructor;if(e==Array)this.pack_array(n);else if(e==Blob||e==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(e==ArrayBuffer)er.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)er.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(e==Object||e.toString().startsWith("class"))this.pack_object(n);else if(e==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+e.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};W.prototype.pack_bin=function(n){var t=n.length||n.byteLength||n.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};W.prototype.pack_string=function(n){var t=la(n);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};W.prototype.pack_array=function(n){var t=n.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var e=0;e<t;e++)this.pack(n[e])};W.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};W.prototype.pack_double=function(n){var t=0;n<0&&(t=1,n=-n);var e=Math.floor(Math.log(n)/Math.LN2),r=n/Math.pow(2,e)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),s=t<<31|e+1023<<20|i/o&1048575,f=i%o;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(f)};W.prototype.pack_object=function(n){var t=Object.keys(n),e=t.length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(e);else throw new Error("Invalid length");for(var r in n)n.hasOwnProperty(r)&&(this.pack(r),this.pack(n[r]))};W.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};W.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};W.prototype.pack_uint32=function(n){var t=n&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};W.prototype.pack_uint64=function(n){var t=n/Math.pow(2,32),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};W.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};W.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};W.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};W.prototype.pack_int64=function(n){var t=Math.floor(n/Math.pow(2,32)),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};function ca(n){var t=n.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function la(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,ca).length}let jr=!0,$r=!0;function Ke(n,t,e){const r=n.match(t);return r&&r.length>=e&&parseInt(r[e],10)}function Ue(n,t,e){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(s,f){if(s!==t)return i.apply(this,arguments);const c=l=>{const d=e(l);d&&(f.handleEvent?f.handleEvent(d):f(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,c),i.apply(this,[s,c])};const o=r.removeEventListener;r.removeEventListener=function(s,f){if(s!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(f))return o.apply(this,arguments);const c=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function ua(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(jr=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function fa(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):($r=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function mn(){if(typeof window=="object"){if(jr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Dt(n,t){!$r||console.warn(n+" is deprecated, please use "+t+" instead.")}function da(n){const t={browser:null,version:null};if(typeof n>"u"||!n.navigator)return t.browser="Not a browser.",t;const{navigator:e}=n;if(e.mozGetUserMedia)t.browser="firefox",t.version=Ke(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)t.browser="chrome",t.version=Ke(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Ke(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Ke(e.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function nr(n){return Object.prototype.toString.call(n)==="[object Object]"}function Nr(n){return nr(n)?Object.keys(n).reduce(function(t,e){const r=nr(n[e]),i=r?Nr(n[e]):n[e],o=r&&!Object.keys(i).length;return i===void 0||o?t:Object.assign(t,{[e]:i})},{}):n}function Wt(n,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Wt(n,n.get(t[r]),e):r.endsWith("Ids")&&t[r].forEach(i=>{Wt(n,n.get(i),e)})}))}function rr(n,t,e){const r=e?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const o=[];return n.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&o.push(s)}),o.forEach(s=>{n.forEach(f=>{f.type===r&&f.trackId===s.id&&Wt(n,f,i)})}),i}const ir=mn;function Ur(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const r=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const c={};return Object.keys(f).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof f[l]=="object"?f[l]:{ideal:f[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const a=function(u,p){return u?u+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(d.ideal!==void 0){c.optional=c.optional||[];let u={};typeof d.ideal=="number"?(u[a("min",l)]=d.ideal,c.optional.push(u),u={},u[a("max",l)]=d.ideal,c.optional.push(u)):(u[a("",l)]=d.ideal,c.optional.push(u))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[a("",l)]=d.exact):["min","max"].forEach(u=>{d[u]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[a(u,l)]=d[u])})}),f.advanced&&(c.optional=(c.optional||[]).concat(f.advanced)),c},i=function(f,c){if(t.version>=61)return c(f);if(f=JSON.parse(JSON.stringify(f)),f&&typeof f.audio=="object"){const l=function(d,a,u){a in d&&!(u in d)&&(d[u]=d[a],delete d[a])};f=JSON.parse(JSON.stringify(f)),l(f.audio,"autoGainControl","googAutoGainControl"),l(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=r(f.audio)}if(f&&typeof f.video=="object"){let l=f.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete f.video.facingMode;let a;if(l.exact==="environment"||l.ideal==="environment"?a=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(a=["front"]),a)return e.mediaDevices.enumerateDevices().then(u=>{u=u.filter(h=>h.kind==="videoinput");let p=u.find(h=>a.some(g=>h.label.toLowerCase().includes(g)));return!p&&u.length&&a.includes("back")&&(p=u[u.length-1]),p&&(f.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),f.video=r(f.video),ir("chrome: "+JSON.stringify(f)),c(f)})}f.video=r(f.video)}return ir("chrome: "+JSON.stringify(f)),c(f)},o=function(f){return t.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(f,c,l){i(f,d=>{e.webkitGetUserMedia(d,c,a=>{l&&l(o(a))})})};if(e.getUserMedia=s.bind(e),e.mediaDevices.getUserMedia){const f=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(c){return i(c,l=>f(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(o(d))))}}}function pa(n,t){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&!!n.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const o=r.video&&r.video.width,s=r.video&&r.video.height,f=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:f||3}},o&&(r.video.mandatory.maxWidth=o),s&&(r.video.mandatory.maxHeight=s),n.navigator.mediaDevices.getUserMedia(r)})}}}function Gr(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function zr(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(f=>f.track&&f.track.id===i.track.id):o={track:i.track};const s=new Event("track");s.track=i.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)}),r.stream.getTracks().forEach(i=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(f=>f.track&&f.track.id===i.id):o={track:i};const s=new Event("track");s.track=i,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ue(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Hr(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(f,c){let l=i.apply(this,arguments);return l||(l=t(this,f),this._senders.push(l)),l};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(f){o.apply(this,arguments);const c=this._senders.indexOf(f);c!==-1&&this._senders.splice(c,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],e.apply(this,[o]),o.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(s=>{const f=this._senders.find(c=>c.track===s);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vr(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,i,o]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const s=function(c){const l={};return c.result().forEach(a=>{const u={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(p=>{u[p]=a.stat(p)}),l[u.id]=u}),l},f=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){i(f(s(l)))};return t.apply(this,[c,r])}return new Promise((c,l)=>{t.apply(this,[function(d){c(f(s(d)))},l])}).then(i,o)}}function Jr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(s=>s._pc=this),o});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>rr(s,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i}),Ue(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>rr(o,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,o,s;return this.getSenders().forEach(f=>{f.track===r&&(i?s=!0:i=f)}),this.getReceivers().forEach(f=>(f.track===r&&(o?s=!0:o=f),f.track===r)),s||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qr(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(s,f){if(!f)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(c)===-1&&this._shimmedLocalStreams[f.id].push(c):this._shimmedLocalStreams[f.id]=[f,c],c};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(a=>a.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();e.apply(this,arguments);const c=this.getSenders().filter(l=>f.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const c=this._shimmedLocalStreams[f].indexOf(s);c!==-1&&this._shimmedLocalStreams[f].splice(c,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),i.apply(this,arguments)}}function Yr(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qr(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const d=e.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(a=>this._reverseStreams[a.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(a=>{if(this.getSenders().find(p=>p.track===a))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const a=new n.MediaStream(d.getTracks());this._streams[d.id]=a,this._reverseStreams[a.id]=d,d=a}r.apply(this,[d])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},n.RTCPeerConnection.prototype.addTrack=function(d,a){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[a.id];if(h)h.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([d]);this._streams[a.id]=g,this._reverseStreams[g.id]=a,this.addStream(g)}return this.getSenders().find(g=>g.track===d)};function o(l,d){let a=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(u=>{const p=l._reverseStreams[u],h=l._streams[p.id];a=a.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:d.type,sdp:a})}function s(l,d){let a=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(u=>{const p=l._reverseStreams[u],h=l._streams[p.id];a=a.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:a})}["createOffer","createAnswer"].forEach(function(l){const d=n.RTCPeerConnection.prototype[l],a={[l](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[h=>{const g=o(this,h);u[0].apply(null,[g])},h=>{u[1]&&u[1].apply(null,h)},arguments[2]]):d.apply(this,arguments).then(h=>o(this,h))}};n.RTCPeerConnection.prototype[l]=a[l]});const f=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?f.apply(this,arguments):(arguments[0]=s(this,arguments[0]),f.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:o(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(g=>d.track===g)&&(u=this._streams[p])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Xt(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),!!n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const r=n.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=i[e]})}function Kr(n,t){Ue(n,"negotiationneeded",e=>{const r=e.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return e})}const or=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:Gr,shimOnTrack:zr,shimGetSendersWithDtmf:Hr,shimGetStats:Vr,shimSenderReceiverGetStats:Jr,shimAddTrackRemoveTrackWithNative:qr,shimAddTrackRemoveTrack:Yr,shimPeerConnection:Xt,fixNegotiationNeeded:Kr,shimGetUserMedia:Ur,shimGetDisplayMedia:pa},Symbol.toStringTag,{value:"Module"}));function ha(n,t){let e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(r=>{if(r&&(r.urls||r.url)){let i=r.urls||r.url;r.url&&!r.urls&&Dt("RTCIceServer.url","RTCIceServer.urls");const o=typeof i=="string";return o&&(i=[i]),i=i.filter(s=>{if(s.indexOf("stun:")===0)return!1;const f=s.startsWith("turn")&&!s.startsWith("turn:[")&&s.includes("transport=udp");return f&&!e?(e=!0,!0):f&&!e}),delete r.url,r.urls=o?i[0]:i,!!i.length}})}var gn={exports:{}};(function(n){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(function(r){return r.trim()})},t.splitSections=function(e){var r=e.split(`
m=`);return r.map(function(i,o){return(o>0?"m="+i:i).trim()+`\r
`})},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter(function(i){return i.indexOf(r)===0})},t.parseCandidate=function(e){var r;e.indexOf("a=candidate:")===0?r=e.substring(12).split(" "):r=e.substring(10).split(" ");for(var i={foundation:r[0],component:parseInt(r[1],10),protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]},o=8;o<r.length;o+=2)switch(r[o]){case"raddr":i.relatedAddress=r[o+1];break;case"rport":i.relatedPort=parseInt(r[o+1],10);break;case"tcptype":i.tcpType=r[o+1];break;case"ufrag":i.ufrag=r[o+1],i.usernameFragment=r[o+1];break;default:i[r[o]]=r[o+1];break}return i},t.writeCandidate=function(e){var r=[];r.push(e.foundation),r.push(e.component),r.push(e.protocol.toUpperCase()),r.push(e.priority),r.push(e.address||e.ip),r.push(e.port);var i=e.type;return r.push("typ"),r.push(i),i!=="host"&&e.relatedAddress&&e.relatedPort&&(r.push("raddr"),r.push(e.relatedAddress),r.push("rport"),r.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(r.push("ufrag"),r.push(e.usernameFragment||e.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var r=e.substr(9).split(" "),i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){var r=e.payloadType;e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+r+" "+e.name+"/"+e.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(e){var r=e.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},t.parseFmtp=function(e){for(var r={},i,o=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<o.length;s++)i=o[s].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(e){var r="",i=e.payloadType;if(e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach(function(s){e.parameters[s]?o.push(s+"="+e.parameters[s]):o.push(s)}),r+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return r},t.parseRtcpFb=function(e){var r=e.substr(e.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(e){var r="",i=e.payloadType;return e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(o){r+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(e){var r=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,r-7),10)},o=e.indexOf(":",r);return o>-1?(i.attribute=e.substr(r+1,o-r-1),i.value=e.substr(o+1)):i.attribute=e.substr(r+1),i},t.parseSsrcGroup=function(e){var r=e.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(i){return parseInt(i,10)})}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var r=e.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},t.getDtlsParameters=function(e,r){var i=t.matchPrefix(e+r,"a=fingerprint:");return{role:"auto",fingerprints:i.map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,r){var i="a=setup:"+r+`\r
`;return e.fingerprints.forEach(function(o){i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},t.parseCryptoLine=function(e){var r=e.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var r=e.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){var i=t.matchPrefix(e+r,"a=crypto:");return i.map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var i=t.matchPrefix(e+r,"a=ice-ufrag:")[0],o=t.matchPrefix(e+r,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e),o=i[0].split(" "),s=3;s<o.length;s++){var f=o[s],c=t.matchPrefix(e,"a=rtpmap:"+f+" ")[0];if(c){var l=t.parseRtpMap(c),d=t.matchPrefix(e,"a=fmtp:"+f+" ");switch(l.parameters=d.length?t.parseFmtp(d[0]):{},l.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase());break}}}return t.matchPrefix(e,"a=extmap:").forEach(function(a){r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(e,r){var i="";i+="m="+e+" ",i+=r.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=r.codecs.map(function(s){return s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType}).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(function(s){i+=t.writeRtpMap(s),i+=t.writeFmtp(s),i+=t.writeRtcpFb(s)});var o=0;return r.codecs.forEach(function(s){s.maxptime>o&&(o=s.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),i+=`a=rtcp-mux\r
`,r.headerExtensions&&r.headerExtensions.forEach(function(s){i+=t.writeExtmap(s)}),i},t.parseRtpEncodingParameters=function(e){var r=[],i=t.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(e,"a=ssrc:").map(function(u){return t.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"}),c=f.length>0&&f[0].ssrc,l,d=t.matchPrefix(e,"a=ssrc-group:FID").map(function(u){var p=u.substr(17).split(" ");return p.map(function(h){return parseInt(h,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),i.codecs.forEach(function(u){if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){var p={ssrc:c,codecPayloadType:parseInt(u.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),r.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&c&&r.push({ssrc:c});var a=t.matchPrefix(e,"b=");return a.length&&(a[0].indexOf("b=TIAS:")===0?a=parseInt(a[0].substr(7),10):a[0].indexOf("b=AS:")===0?a=parseInt(a[0].substr(5),10)*1e3*.95-50*40*8:a=void 0,r.forEach(function(u){u.maxBitrate=a})),r},t.parseRtcpParameters=function(e){var r={},i=t.matchPrefix(e,"a=ssrc:").map(function(f){return t.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"})[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);var o=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;var s=t.matchPrefix(e,"a=rtcp-mux");return r.mux=s.length>0,r},t.parseMsid=function(e){var r,i=t.matchPrefix(e,"a=msid:");if(i.length===1)return r=i[0].substr(7).split(" "),{stream:r[0],track:r[1]};var o=t.matchPrefix(e,"a=ssrc:").map(function(s){return t.parseSsrcMedia(s)}).filter(function(s){return s.attribute==="msid"});if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(e){var r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:"),o;i.length>0&&(o=parseInt(i[0].substr(19),10)),isNaN(o)&&(o=65536);var s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:r.fmt,maxMessageSize:o};var f=t.matchPrefix(e,"a=sctpmap:");if(f.length>0){var c=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,r){var i=[];return e.protocol!=="DTLS/SCTP"?i=["m="+e.kind+" 9 "+e.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+e.kind+" 9 "+e.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,i){var o,s=r!==void 0?r:2;e?o=e:o=t.generateSessionId();var f=i||"thisisadapterortc";return`v=0\r
o=`+f+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(e,r,i,o){var s=t.writeRtpDescription(e.kind,r);if(s+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":"active"),s+="a=mid:"+e.mid+`\r
`,e.direction?s+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?s+=`a=sendrecv\r
`:e.rtpSender?s+=`a=sendonly\r
`:e.rtpReceiver?s+=`a=recvonly\r
`:s+=`a=inactive\r
`,e.rtpSender){var f="msid:"+o.id+" "+e.rtpSender.track.id+`\r
`;s+="a="+f,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+f,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+f,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),s},t.getDirection=function(e,r){for(var i=t.splitLines(e),o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){var r=t.splitLines(e),i=r[0].split(" ");return i[0].substr(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){var r=t.splitLines(e),i=r[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0],i=r.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var r=t.splitLines(e),i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=t})(gn);const St=gn.exports;var D=gn.exports;function ma(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function ar(n,t,e,r,i){var o=D.writeRtpDescription(n.kind,t);if(o+=D.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=D.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":i||"active"),o+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var s=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=s;var f="msid:"+(r?r.id:"-")+" "+s+`\r
`;o+="a="+f,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+f,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+f,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+D.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+D.localCName+`\r
`),o}function ga(n,t){var e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(r){if(r&&(r.urls||r.url)){var i=r.urls||r.url;r.url&&!r.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof i=="string";return o&&(i=[i]),i=i.filter(function(s){var f=s.indexOf("turn:")===0&&s.indexOf("transport=udp")!==-1&&s.indexOf("turn:[")===-1&&!e;return f?(e=!0,!0):s.indexOf("stun:")===0&&t>=14393&&s.indexOf("?transport=udp")===-1}),delete r.url,r.urls=o?i[0]:i,!!i.length}})}function mt(n,t){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(o,s){o=parseInt(o,10);for(var f=0;f<s.length;f++)if(s[f].payloadType===o||s[f].preferredPayloadType===o)return s[f]},i=function(o,s,f,c){var l=r(o.parameters.apt,f),d=r(s.parameters.apt,c);return l&&d&&l.name.toLowerCase()===d.name.toLowerCase()};return n.codecs.forEach(function(o){for(var s=0;s<t.codecs.length;s++){var f=t.codecs[s];if(o.name.toLowerCase()===f.name.toLowerCase()&&o.clockRate===f.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&f.parameters.apt&&!i(o,f,n.codecs,t.codecs))continue;f=JSON.parse(JSON.stringify(f)),f.numChannels=Math.min(o.numChannels,f.numChannels),e.codecs.push(f),f.rtcpFeedback=f.rtcpFeedback.filter(function(c){for(var l=0;l<o.rtcpFeedback.length;l++)if(o.rtcpFeedback[l].type===c.type&&o.rtcpFeedback[l].parameter===c.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(o){for(var s=0;s<t.headerExtensions.length;s++){var f=t.headerExtensions[s];if(o.uri===f.uri){e.headerExtensions.push(f);break}}}),e}function sr(n,t,e){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(e)!==-1}function Ut(n,t){var e=n.getRemoteCandidates().find(function(r){return t.foundation===r.foundation&&t.ip===r.ip&&t.port===r.port&&t.priority===r.priority&&t.protocol===r.protocol&&t.type===r.type});return e||n.addRemoteCandidate(t),!e}function X(n,t){var e=new Error(t);return e.name=n,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],e}var _a=function(n,t){function e(c,l){l.addTrack(c),l.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:c}))}function r(c,l){l.removeTrack(c),l.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:c}))}function i(c,l,d,a){var u=new Event("track");u.track=l,u.receiver=d,u.transceiver={receiver:d},u.streams=a,n.setTimeout(function(){c._dispatchEvent("track",u)})}var o=function(c){var l=this,d=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(u){l[u]=d[u].bind(d)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw X("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=ga(c.iceServers||[],t),this._iceGatherers=[],c.iceCandidatePoolSize)for(var a=c.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=D.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(c,l){this._isClosed||(this.dispatchEvent(l),typeof this["on"+c]=="function"&&this["on"+c](l))},o.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(c,l){var d=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&d)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var u=this._createIceAndDtlsTransports();a.iceTransport=u.iceTransport,a.dtlsTransport=u.dtlsTransport}return l||this.transceivers.push(a),a},o.prototype.addTrack=function(c,l){if(this._isClosed)throw X("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(p){return p.track===c});if(d)throw X("InvalidAccessError","Track already exists.");for(var a,u=0;u<this.transceivers.length;u++)!this.transceivers[u].track&&this.transceivers[u].kind===c.kind&&(a=this.transceivers[u]);return a||(a=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(l)===-1&&this.localStreams.push(l),a.track=c,a.stream=l,a.rtpSender=new n.RTCRtpSender(c,a.dtlsTransport),a.rtpSender},o.prototype.addStream=function(c){var l=this;if(t>=15025)c.getTracks().forEach(function(a){l.addTrack(a,c)});else{var d=c.clone();c.getTracks().forEach(function(a,u){var p=d.getTracks()[u];a.addEventListener("enabled",function(h){p.enabled=h.enabled})}),d.getTracks().forEach(function(a){l.addTrack(a,d)})}},o.prototype.removeTrack=function(c){if(this._isClosed)throw X("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var l=this.transceivers.find(function(u){return u.rtpSender===c});if(!l)throw X("InvalidAccessError","Sender was not created by this connection.");var d=l.stream;l.rtpSender.stop(),l.rtpSender=null,l.track=null,l.stream=null;var a=this.transceivers.map(function(u){return u.stream});a.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(c){var l=this;c.getTracks().forEach(function(d){var a=l.getSenders().find(function(u){return u.track===d});a&&l.removeTrack(a)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},o.prototype._createIceGatherer=function(c,l){var d=this;if(l&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(u){var p=!u.candidate||Object.keys(u.candidate).length===0;a.state=p?"completed":"gathering",d.transceivers[c].bufferedCandidateEvents!==null&&d.transceivers[c].bufferedCandidateEvents.push(u)},a.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),a},o.prototype._gather=function(c,l){var d=this,a=this.transceivers[l].iceGatherer;if(!a.onlocalcandidate){var u=this.transceivers[l].bufferedCandidateEvents;this.transceivers[l].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[l].bufferCandidates),a.onlocalcandidate=function(p){if(!(d.usingBundle&&l>0)){var h=new Event("icecandidate");h.candidate={sdpMid:c,sdpMLineIndex:l};var g=p.candidate,_=!g||Object.keys(g).length===0;if(_)(a.state==="new"||a.state==="gathering")&&(a.state="completed");else{a.state==="new"&&(a.state="gathering"),g.component=1,g.ufrag=a.getLocalParameters().usernameFragment;var m=D.writeCandidate(g);h.candidate=Object.assign(h.candidate,D.parseCandidate(m)),h.candidate.candidate=m,h.candidate.toJSON=function(){return{candidate:h.candidate.candidate,sdpMid:h.candidate.sdpMid,sdpMLineIndex:h.candidate.sdpMLineIndex,usernameFragment:h.candidate.usernameFragment}}}var v=D.getMediaSections(d._localDescription.sdp);_?v[h.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:v[h.candidate.sdpMLineIndex]+="a="+h.candidate.candidate+`\r
`,d._localDescription.sdp=D.getDescription(d._localDescription.sdp)+v.join("");var y=d.transceivers.every(function(b){return b.iceGatherer&&b.iceGatherer.state==="completed"});d.iceGatheringState!=="gathering"&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),_||d._dispatchEvent("icecandidate",h),y&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},n.setTimeout(function(){u.forEach(function(p){a.onlocalcandidate(p)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var c=this,l=new n.RTCIceTransport(null);l.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var d=new n.RTCDtlsTransport(l);return d.ondtlsstatechange=function(){c._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:l,dtlsTransport:d}},o.prototype._disposeIceAndDtlsTransports=function(c){var l=this.transceivers[c].iceGatherer;l&&(delete l.onlocalcandidate,delete this.transceivers[c].iceGatherer);var d=this.transceivers[c].iceTransport;d&&(delete d.onicestatechange,delete this.transceivers[c].iceTransport);var a=this.transceivers[c].dtlsTransport;a&&(delete a.ondtlsstatechange,delete a.onerror,delete this.transceivers[c].dtlsTransport)},o.prototype._transceive=function(c,l,d){var a=mt(c.localCapabilities,c.remoteCapabilities);l&&c.rtpSender&&(a.encodings=c.sendEncodingParameters,a.rtcp={cname:D.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(a.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(a)),d&&c.rtpReceiver&&a.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&t<15019&&c.recvEncodingParameters.forEach(function(u){delete u.rtx}),c.recvEncodingParameters.length?a.encodings=c.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(a.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(a.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(a))},o.prototype.setLocalDescription=function(c){var l=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(X("TypeError",'Unsupported type "'+c.type+'"'));if(!sr("setLocalDescription",c.type,l.signalingState)||l._isClosed)return Promise.reject(X("InvalidStateError","Can not set local "+c.type+" in state "+l.signalingState));var d,a;if(c.type==="offer")d=D.splitSections(c.sdp),a=d.shift(),d.forEach(function(p,h){var g=D.parseRtpParameters(p);l.transceivers[h].localCapabilities=g}),l.transceivers.forEach(function(p,h){l._gather(p.mid,h)});else if(c.type==="answer"){d=D.splitSections(l._remoteDescription.sdp),a=d.shift();var u=D.matchPrefix(a,"a=ice-lite").length>0;d.forEach(function(p,h){var g=l.transceivers[h],_=g.iceGatherer,m=g.iceTransport,v=g.dtlsTransport,y=g.localCapabilities,b=g.remoteCapabilities,C=D.isRejected(p)&&D.matchPrefix(p,"a=bundle-only").length===0;if(!C&&!g.rejected){var S=D.getIceParameters(p,a),P=D.getDtlsParameters(p,a);u&&(P.role="server"),(!l.usingBundle||h===0)&&(l._gather(g.mid,h),m.state==="new"&&m.start(_,S,u?"controlling":"controlled"),v.state==="new"&&v.start(P));var w=mt(y,b);l._transceive(g,w.codecs.length>0,!1)}})}return l._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(c){var l=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(X("TypeError",'Unsupported type "'+c.type+'"'));if(!sr("setRemoteDescription",c.type,l.signalingState)||l._isClosed)return Promise.reject(X("InvalidStateError","Can not set remote "+c.type+" in state "+l.signalingState));var d={};l.remoteStreams.forEach(function(m){d[m.id]=m});var a=[],u=D.splitSections(c.sdp),p=u.shift(),h=D.matchPrefix(p,"a=ice-lite").length>0,g=D.matchPrefix(p,"a=group:BUNDLE ").length>0;l.usingBundle=g;var _=D.matchPrefix(p,"a=ice-options:")[0];return _?l.canTrickleIceCandidates=_.substr(14).split(" ").indexOf("trickle")>=0:l.canTrickleIceCandidates=!1,u.forEach(function(m,v){var y=D.splitLines(m),b=D.getKind(m),C=D.isRejected(m)&&D.matchPrefix(m,"a=bundle-only").length===0,S=y[0].substr(2).split(" ")[2],P=D.getDirection(m,p),w=D.parseMsid(m),E=D.getMid(m)||D.generateIdentifier();if(C||b==="application"&&(S==="DTLS/SCTP"||S==="UDP/DTLS/SCTP")){l.transceivers[v]={mid:E,kind:b,protocol:S,rejected:!0};return}!C&&l.transceivers[v]&&l.transceivers[v].rejected&&(l.transceivers[v]=l._createTransceiver(b,!0));var x,ie,J,q,H,z,Ge,A,L,oe=D.parseRtpParameters(m),F,ve;C||(F=D.getIceParameters(m,p),ve=D.getDtlsParameters(m,p),ve.role="client"),Ge=D.parseRtpEncodingParameters(m);var En=D.parseRtcpParameters(m),Pn=D.matchPrefix(m,"a=end-of-candidates",p).length>0,De=D.matchPrefix(m,"a=candidate:").map(function(ae){return D.parseCandidate(ae)}).filter(function(ae){return ae.component===1});if((c.type==="offer"||c.type==="answer")&&!C&&g&&v>0&&l.transceivers[v]&&(l._disposeIceAndDtlsTransports(v),l.transceivers[v].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[v].iceTransport=l.transceivers[0].iceTransport,l.transceivers[v].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[v].rtpSender&&l.transceivers[v].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[v].rtpReceiver&&l.transceivers[v].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),c.type==="offer"&&!C){x=l.transceivers[v]||l._createTransceiver(b),x.mid=E,x.iceGatherer||(x.iceGatherer=l._createIceGatherer(v,g)),De.length&&x.iceTransport.state==="new"&&(Pn&&(!g||v===0)?x.iceTransport.setRemoteCandidates(De):De.forEach(function(ae){Ut(x.iceTransport,ae)})),A=n.RTCRtpReceiver.getCapabilities(b),t<15019&&(A.codecs=A.codecs.filter(function(ae){return ae.name!=="rtx"})),z=x.sendEncodingParameters||[{ssrc:(2*v+2)*1001}];var jt=!1;if(P==="sendrecv"||P==="sendonly"){if(jt=!x.rtpReceiver,H=x.rtpReceiver||new n.RTCRtpReceiver(x.dtlsTransport,b),jt){var Oe;L=H.track,w&&w.stream==="-"||(w?(d[w.stream]||(d[w.stream]=new n.MediaStream,Object.defineProperty(d[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(L,"id",{get:function(){return w.track}}),Oe=d[w.stream]):(d.default||(d.default=new n.MediaStream),Oe=d.default)),Oe&&(e(L,Oe),x.associatedRemoteMediaStreams.push(Oe)),a.push([L,H,Oe])}}else x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach(function(ae){var Rn=ae.getTracks().find(function(Ui){return Ui.id===x.rtpReceiver.track.id});Rn&&r(Rn,ae)}),x.associatedRemoteMediaStreams=[]);x.localCapabilities=A,x.remoteCapabilities=oe,x.rtpReceiver=H,x.rtcpParameters=En,x.sendEncodingParameters=z,x.recvEncodingParameters=Ge,l._transceive(l.transceivers[v],!1,jt)}else if(c.type==="answer"&&!C){x=l.transceivers[v],ie=x.iceGatherer,J=x.iceTransport,q=x.dtlsTransport,H=x.rtpReceiver,z=x.sendEncodingParameters,A=x.localCapabilities,l.transceivers[v].recvEncodingParameters=Ge,l.transceivers[v].remoteCapabilities=oe,l.transceivers[v].rtcpParameters=En,De.length&&J.state==="new"&&((h||Pn)&&(!g||v===0)?J.setRemoteCandidates(De):De.forEach(function(ae){Ut(x.iceTransport,ae)})),(!g||v===0)&&(J.state==="new"&&J.start(ie,F,"controlling"),q.state==="new"&&q.start(ve));var $i=mt(x.localCapabilities,x.remoteCapabilities),Ni=$i.codecs.filter(function(ae){return ae.name.toLowerCase()==="rtx"}).length;!Ni&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,l._transceive(x,P==="sendrecv"||P==="recvonly",P==="sendrecv"||P==="sendonly"),H&&(P==="sendrecv"||P==="sendonly")?(L=H.track,w?(d[w.stream]||(d[w.stream]=new n.MediaStream),e(L,d[w.stream]),a.push([L,H,d[w.stream]])):(d.default||(d.default=new n.MediaStream),e(L,d.default),a.push([L,H,d.default]))):delete x.rtpReceiver}}),l._dtlsRole===void 0&&(l._dtlsRole=c.type==="offer"?"active":"passive"),l._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(d).forEach(function(m){var v=d[m];if(v.getTracks().length){if(l.remoteStreams.indexOf(v)===-1){l.remoteStreams.push(v);var y=new Event("addstream");y.stream=v,n.setTimeout(function(){l._dispatchEvent("addstream",y)})}a.forEach(function(b){var C=b[0],S=b[1];v.id===b[2].id&&i(l,C,S,[v])})}}),a.forEach(function(m){m[2]||i(l,m[0],m[1],[])}),n.setTimeout(function(){!(l&&l.transceivers)||l.transceivers.forEach(function(m){m.iceTransport&&m.iceTransport.state==="new"&&m.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),m.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(c){this.signalingState=c;var l=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",l)},o.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var l=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",l)}},0))},o.prototype._updateIceConnectionState=function(){var c,l={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&l[a.iceTransport.state]++}),c="new",l.failed>0?c="failed":l.checking>0?c="checking":l.disconnected>0?c="disconnected":l.new>0?c="new":l.connected>0?c="connected":l.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var d=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",d)}},o.prototype._updateConnectionState=function(){var c,l={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(l[a.iceTransport.state]++,l[a.dtlsTransport.state]++)}),l.connected+=l.completed,c="new",l.failed>0?c="failed":l.connecting>0?c="connecting":l.disconnected>0?c="disconnected":l.new>0?c="new":l.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var d=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",d)}},o.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(X("InvalidStateError","Can not call createOffer after close"));var l=c.transceivers.filter(function(h){return h.kind==="audio"}).length,d=c.transceivers.filter(function(h){return h.kind==="video"}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");a.offerToReceiveAudio!==void 0&&(a.offerToReceiveAudio===!0?l=1:a.offerToReceiveAudio===!1?l=0:l=a.offerToReceiveAudio),a.offerToReceiveVideo!==void 0&&(a.offerToReceiveVideo===!0?d=1:a.offerToReceiveVideo===!1?d=0:d=a.offerToReceiveVideo)}for(c.transceivers.forEach(function(h){h.kind==="audio"?(l--,l<0&&(h.wantReceive=!1)):h.kind==="video"&&(d--,d<0&&(h.wantReceive=!1))});l>0||d>0;)l>0&&(c._createTransceiver("audio"),l--),d>0&&(c._createTransceiver("video"),d--);var u=D.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(h,g){var _=h.track,m=h.kind,v=h.mid||D.generateIdentifier();h.mid=v,h.iceGatherer||(h.iceGatherer=c._createIceGatherer(g,c.usingBundle));var y=n.RTCRtpSender.getCapabilities(m);t<15019&&(y.codecs=y.codecs.filter(function(C){return C.name!=="rtx"})),y.codecs.forEach(function(C){C.name==="H264"&&C.parameters["level-asymmetry-allowed"]===void 0&&(C.parameters["level-asymmetry-allowed"]="1"),h.remoteCapabilities&&h.remoteCapabilities.codecs&&h.remoteCapabilities.codecs.forEach(function(S){C.name.toLowerCase()===S.name.toLowerCase()&&C.clockRate===S.clockRate&&(C.preferredPayloadType=S.payloadType)})}),y.headerExtensions.forEach(function(C){var S=h.remoteCapabilities&&h.remoteCapabilities.headerExtensions||[];S.forEach(function(P){C.uri===P.uri&&(C.id=P.id)})});var b=h.sendEncodingParameters||[{ssrc:(2*g+1)*1001}];_&&t>=15019&&m==="video"&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1}),h.wantReceive&&(h.rtpReceiver=new n.RTCRtpReceiver(h.dtlsTransport,m)),h.localCapabilities=y,h.sendEncodingParameters=b}),c._config.bundlePolicy!=="max-compat"&&(u+="a=group:BUNDLE "+c.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(h,g){u+=ar(h,h.localCapabilities,"offer",h.stream,c._dtlsRole),u+=`a=rtcp-rsize\r
`,h.iceGatherer&&c.iceGatheringState!=="new"&&(g===0||!c.usingBundle)&&(h.iceGatherer.getLocalCandidates().forEach(function(_){_.component=1,u+="a="+D.writeCandidate(_)+`\r
`}),h.iceGatherer.state==="completed"&&(u+=`a=end-of-candidates\r
`))});var p=new n.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(p)},o.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(X("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(X("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var l=D.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(l+="a=group:BUNDLE "+c.transceivers.map(function(u){return u.mid}).join(" ")+`\r
`),l+=`a=ice-options:trickle\r
`;var d=D.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(u,p){if(!(p+1>d)){if(u.rejected){u.kind==="application"?u.protocol==="DTLS/SCTP"?l+=`m=application 0 DTLS/SCTP 5000\r
`:l+="m=application 0 "+u.protocol+` webrtc-datachannel\r
`:u.kind==="audio"?l+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:u.kind==="video"&&(l+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),l+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+u.mid+`\r
`;return}if(u.stream){var h;u.kind==="audio"?h=u.stream.getAudioTracks()[0]:u.kind==="video"&&(h=u.stream.getVideoTracks()[0]),h&&t>=15019&&u.kind==="video"&&!u.sendEncodingParameters[0].rtx&&(u.sendEncodingParameters[0].rtx={ssrc:u.sendEncodingParameters[0].ssrc+1})}var g=mt(u.localCapabilities,u.remoteCapabilities),_=g.codecs.filter(function(m){return m.name.toLowerCase()==="rtx"}).length;!_&&u.sendEncodingParameters[0].rtx&&delete u.sendEncodingParameters[0].rtx,l+=ar(u,g,"answer",u.stream,c._dtlsRole),u.rtcpParameters&&u.rtcpParameters.reducedSize&&(l+=`a=rtcp-rsize\r
`)}});var a=new n.RTCSessionDescription({type:"answer",sdp:l});return Promise.resolve(a)},o.prototype.addIceCandidate=function(c){var l=this,d;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,u){if(l._remoteDescription)if(!c||c.candidate==="")for(var p=0;p<l.transceivers.length&&!(!l.transceivers[p].rejected&&(l.transceivers[p].iceTransport.addRemoteCandidate({}),d=D.getMediaSections(l._remoteDescription.sdp),d[p]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=D.getDescription(l._remoteDescription.sdp)+d.join(""),l.usingBundle));p++);else{var h=c.sdpMLineIndex;if(c.sdpMid){for(var g=0;g<l.transceivers.length;g++)if(l.transceivers[g].mid===c.sdpMid){h=g;break}}var _=l.transceivers[h];if(_){if(_.rejected)return a();var m=Object.keys(c.candidate).length>0?D.parseCandidate(c.candidate):{};if(m.protocol==="tcp"&&(m.port===0||m.port===9)||m.component&&m.component!==1)return a();if((h===0||h>0&&_.iceTransport!==l.transceivers[0].iceTransport)&&!Ut(_.iceTransport,m))return u(X("OperationError","Can not add ICE candidate"));var v=c.candidate.trim();v.indexOf("a=")===0&&(v=v.substr(2)),d=D.getMediaSections(l._remoteDescription.sdp),d[h]+="a="+(m.type?v:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=D.getDescription(l._remoteDescription.sdp)+d.join("")}else return u(X("OperationError","Can not add ICE candidate"))}else return u(X("InvalidStateError","Can not add ICE candidate without a remote description"));a()})},o.prototype.getStats=function(c){if(c&&c instanceof n.MediaStreamTrack){var l=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===c?l=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===c&&(l=a.rtpReceiver)}),!l)throw X("InvalidAccessError","Invalid selector.");return l.getStats()}var d=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(u){a[u]&&d.push(a[u].getStats())})}),Promise.all(d).then(function(a){var u=new Map;return a.forEach(function(p){p.forEach(function(h){u.set(h.id,h)})}),u})};var s=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];s.forEach(function(c){var l=n[c];if(l&&l.prototype&&l.prototype.getStats){var d=l.prototype.getStats;l.prototype.getStats=function(){return d.apply(this).then(function(a){var u=new Map;return Object.keys(a).forEach(function(p){a[p].type=ma(a[p]),u.set(p,a[p])}),u})}}});var f=["createOffer","createAnswer"];return f.forEach(function(c){var l=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[0]=="function"||typeof d[1]=="function"?l.apply(this,[arguments[2]]).then(function(a){typeof d[0]=="function"&&d[0].apply(null,[a])},function(a){typeof d[1]=="function"&&d[1].apply(null,[a])}):l.apply(this,arguments)}}),f=["setLocalDescription","setRemoteDescription","addIceCandidate"],f.forEach(function(c){var l=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"||typeof d[2]=="function"?l.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)},function(a){typeof d[2]=="function"&&d[2].apply(null,[a])}):l.apply(this,arguments)}}),["getStats"].forEach(function(c){var l=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"?l.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)}):l.apply(this,arguments)}}),o};function Wr(n){const t=n&&n.navigator,e=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return r(i).catch(o=>Promise.reject(e(o)))}}function Xr(n){"getDisplayMedia"in n.navigator&&(!n.navigator.mediaDevices||n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function Qt(n,t){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(i){return i}),n.RTCSessionDescription||(n.RTCSessionDescription=function(i){return i}),t.version<15025)){const r=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(i){r.set.call(this,i);const o=new Event("enabled");o.enabled=i,this.dispatchEvent(o)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const e=_a(n,t.version);n.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=ha(i.iceServers,t.version),mn("ICE servers after filtering:",i.iceServers)),new e(i)},n.RTCPeerConnection.prototype=e.prototype}function Qr(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const cr=Object.freeze(Object.defineProperty({__proto__:null,shimPeerConnection:Qt,shimReplaceTrack:Qr,shimGetUserMedia:Wr,shimGetDisplayMedia:Xr},Symbol.toStringTag,{value:"Module"}));function Zr(n,t){const e=n&&n.navigator,r=n&&n.MediaStreamTrack;if(e.getUserMedia=function(i,o,s){Dt("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(i).then(o,s)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const i=function(s,f,c){f in s&&!(c in s)&&(s[c]=s[f],delete s[f])},o=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},r&&r.prototype.getSettings){const s=r.prototype.getSettings;r.prototype.getSettings=function(){const f=s.apply(this,arguments);return i(f,"mozAutoGainControl","autoGainControl"),i(f,"mozNoiseSuppression","noiseSuppression"),f}}if(r&&r.prototype.applyConstraints){const s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),i(f,"autoGainControl","mozAutoGainControl"),i(f,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[f])}}}}function va(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||!n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(r)})}function ei(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Zt(n,t){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=n.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=s[i]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,s,f]=arguments;return r.apply(this,[o||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(l=>{l.type=e[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,a)=>{c.set(a,Object.assign({},d,{type:e[d.type]||d.type}))})}return c}).then(s,f)}}function ti(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ni(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Ue(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ri(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){Dt("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&e.getTracks().includes(r.track)&&this.removeTrack(r)})})}function ii(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function oi(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const r=arguments[1],i=r&&"sendEncodings"in r;i&&r.sendEncodings.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:s}=o,f=s.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=r.sendEncodings,s.sendEncodings=r.sendEncodings,this.setParametersPromises.push(s.setParameters(f).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return o})}function ai(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function si(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ci(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const lr=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:ei,shimPeerConnection:Zt,shimSenderGetStats:ti,shimReceiverGetStats:ni,shimRemoveStream:ri,shimRTCDataChannel:ii,shimAddTransceiver:oi,shimGetParameters:ai,shimCreateOffer:si,shimCreateAnswer:ci,shimGetUserMedia:Zr,shimGetDisplayMedia:va},Symbol.toStringTag,{value:"Module"}));function li(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(e);if(r===-1)return;this._localStreams.splice(r,1);const i=e.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function ui(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,r.dispatchEvent(s)})}),t.apply(r,arguments)}}}function fi(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(l,d){const a=arguments.length>=2?arguments[2]:arguments[0],u=e.apply(this,[a]);return d?(u.then(l,d),Promise.resolve()):u},t.createAnswer=function(l,d){const a=arguments.length>=2?arguments[2]:arguments[0],u=r.apply(this,[a]);return d?(u.then(l,d),Promise.resolve()):u};let f=function(c,l,d){const a=i.apply(this,[c]);return d?(a.then(l,d),Promise.resolve()):a};t.setLocalDescription=f,f=function(c,l,d){const a=o.apply(this,[c]);return d?(a.then(l,d),Promise.resolve()):a},t.setRemoteDescription=f,f=function(c,l,d){const a=s.apply(this,[c]);return d?(a.then(l,d),Promise.resolve()):a},t.addIceCandidate=f}function di(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=i=>r(pi(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,o){t.mediaDevices.getUserMedia(r).then(i,o)}.bind(t))}function pi(n){return n&&n.video!==void 0?Object.assign({},n,{video:Nr(n.video)}):n}function hi(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const o=[];for(let s=0;s<r.iceServers.length;s++){let f=r.iceServers[s];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(Dt("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,o.push(f)):o.push(r.iceServers[s])}r.iceServers=o}return new t(r,i)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function mi(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gi(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(s=>s.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video")}return t.apply(this,arguments)}}function _i(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const ur=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:li,shimRemoteStreamsAPI:ui,shimCallbacksAPI:fi,shimGetUserMedia:di,shimConstraints:pi,shimRTCIceServerUrls:hi,shimTrackEventTransceiver:mi,shimCreateOfferLegacy:gi,shimAudioContext:_i},Symbol.toStringTag,{value:"Module"}));function Tt(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const i=new t(r),o=St.parseCandidate(r.candidate),s=Object.assign(i,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(r)},n.RTCIceCandidate.prototype=t.prototype,Ue(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function We(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(f){if(!f||!f.sdp)return!1;const c=St.splitSections(f.sdp);return c.shift(),c.some(l=>{const d=St.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(f){const c=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(f){let c=65536;return t.browser==="firefox"&&(t.version<57?f===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},o=function(f,c){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);const d=St.matchPrefix(f.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(l=2147483637),l},s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const c=r(arguments[0]),l=i(c),d=o(arguments[0],c);let a;l===0&&d===0?a=Number.POSITIVE_INFINITY:l===0||d===0?a=Math.max(l,d):a=Math.min(l,d);const u={};Object.defineProperty(u,"maxMessageSize",{get(){return a}}),this._sctp=u}return s.apply(this,arguments)}}function Xe(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function t(r,i){const o=r.send;r.send=function(){const f=arguments[0],c=f.length||f.size||f.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return t(i,this),i},Ue(n,"datachannel",r=>(t(r.channel,r.target),r))}function en(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",i);o.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function tn(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return e.apply(this,arguments)}}function kt(n,t){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const e=n.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const ya=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:Tt,shimMaxMessageSize:We,shimSendThrowTypeError:Xe,shimConnectionState:en,removeExtmapAllowMixed:tn,shimAddIceCandidateNullOrEmpty:kt},Symbol.toStringTag,{value:"Module"}));function ba({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=mn,r=da(n),i={browserDetails:r,commonShim:ya,extractVersion:Ke,disableLog:ua,disableWarnings:fa};switch(r.browser){case"chrome":if(!or||!Xt||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),i;if(r.version===null)return e("Chrome shim can not determine version, not shimming."),i;e("adapter.js shimming chrome."),i.browserShim=or,kt(n,r),Ur(n,r),Gr(n),Xt(n,r),zr(n),Yr(n,r),Hr(n),Vr(n),Jr(n),Kr(n,r),Tt(n),en(n),We(n,r),Xe(n),tn(n,r);break;case"firefox":if(!lr||!Zt||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),i;e("adapter.js shimming firefox."),i.browserShim=lr,kt(n,r),Zr(n,r),Zt(n,r),ei(n),ri(n),ti(n),ni(n),ii(n),oi(n),ai(n),si(n),ci(n),Tt(n),en(n),We(n,r),Xe(n);break;case"edge":if(!cr||!Qt||!t.shimEdge)return e("MS edge shim is not included in this adapter release."),i;e("adapter.js shimming edge."),i.browserShim=cr,Wr(n),Xr(n),Qt(n,r),Qr(n),We(n,r),Xe(n);break;case"safari":if(!ur||!t.shimSafari)return e("Safari shim is not included in this adapter release."),i;e("adapter.js shimming safari."),i.browserShim=ur,kt(n,r),hi(n),gi(n),fi(n),li(n),ui(n),mi(n),di(n),_i(n),Tt(n),We(n,r),Xe(n),tn(n,r);break;default:e("Unsupported browser!");break}return i}const fr=ba({window:typeof window>"u"?void 0:window});function ge(n,t,e,r){Object.defineProperty(n,t,{get:e,set:r,enumerable:!0,configurable:!0})}var Gt=fr.default||fr,Ve=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var t=this.getBrowser(),e=this.getVersion(),r=this.supportedBrowsers.includes(t);return r?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return Gt.browserDetails.browser},n.prototype.getVersion=function(){return Gt.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),e=Gt.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var r,i=!1;try{r=new RTCPeerConnection,r.addTransceiver("audio"),i=!0}catch{}finally{r&&r.close()}return i},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),dr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Ca=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=dr,this.browser=Ve.getBrowser(),this.browserVersion=Ve.getVersion(),this.supports=function(){var t={browser:Ve.isBrowserSupported(),webRTC:Ve.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var e;try{e=new RTCPeerConnection(dr),t.audioVideo=!0;var r=void 0;try{r=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!Ve.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{e&&e.close()}return t}(),this.pack=tr.pack,this.unpack=tr.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},n.prototype.chunk=function(t){for(var e=[],r=t.size,i=Math.ceil(r/U.chunkedMTU),o=0,s=0;s<r;){var f=Math.min(r,s+U.chunkedMTU),c=t.slice(s,f),l={__peerData:this._dataCount,n:o,data:c,total:i};e.push(l),s=f,o++}return this._dataCount++,e},n.prototype.blobToArrayBuffer=function(t,e){var r=new FileReader;return r.onload=function(i){i.target&&e(i.target.result)},r.readAsArrayBuffer(t),r},n.prototype.binaryStringToArrayBuffer=function(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r)&255;return e.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),U=new Ca,vi={};ge(vi,"Peer",()=>on,n=>on=n);var ct={},Sa=Object.prototype.hasOwnProperty,re="~";function ot(){}Object.create&&(ot.prototype=Object.create(null),new ot().__proto__||(re=!1));function Ta(n,t,e){this.fn=n,this.context=t,this.once=e||!1}function yi(n,t,e,r,i){if(typeof e!="function")throw new TypeError("The listener must be a function");var o=new Ta(e,r||n,i),s=re?re+t:t;return n._events[s]?n._events[s].fn?n._events[s]=[n._events[s],o]:n._events[s].push(o):(n._events[s]=o,n._eventsCount++),n}function Et(n,t){--n._eventsCount===0?n._events=new ot:delete n._events[t]}function ee(){this._events=new ot,this._eventsCount=0}ee.prototype.eventNames=function(){var t=[],e,r;if(this._eventsCount===0)return t;for(r in e=this._events)Sa.call(e,r)&&t.push(re?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};ee.prototype.listeners=function(t){var e=re?re+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s};ee.prototype.listenerCount=function(t){var e=re?re+t:t,r=this._events[e];return r?r.fn?1:r.length:0};ee.prototype.emit=function(t,e,r,i,o,s){var f=re?re+t:t;if(!this._events[f])return!1;var c=this._events[f],l=arguments.length,d,a;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,s),!0}for(a=1,d=new Array(l-1);a<l;a++)d[a-1]=arguments[a];c.fn.apply(c.context,d)}else{var u=c.length,p;for(a=0;a<u;a++)switch(c[a].once&&this.removeListener(t,c[a].fn,void 0,!0),l){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,e);break;case 3:c[a].fn.call(c[a].context,e,r);break;case 4:c[a].fn.call(c[a].context,e,r,i);break;default:if(!d)for(p=1,d=new Array(l-1);p<l;p++)d[p-1]=arguments[p];c[a].fn.apply(c[a].context,d)}}return!0};ee.prototype.on=function(t,e,r){return yi(this,t,e,r,!1)};ee.prototype.once=function(t,e,r){return yi(this,t,e,r,!0)};ee.prototype.removeListener=function(t,e,r,i){var o=re?re+t:t;if(!this._events[o])return this;if(!e)return Et(this,o),this;var s=this._events[o];if(s.fn)s.fn===e&&(!i||s.once)&&(!r||s.context===r)&&Et(this,o);else{for(var f=0,c=[],l=s.length;f<l;f++)(s[f].fn!==e||i&&!s[f].once||r&&s[f].context!==r)&&c.push(s[f]);c.length?this._events[o]=c.length===1?c[0]:c:Et(this,o)}return this};ee.prototype.removeAllListeners=function(t){var e;return t?(e=re?re+t:t,this._events[e]&&Et(this,e)):(this._events=new ot,this._eventsCount=0),this};ee.prototype.off=ee.prototype.removeListener;ee.prototype.addListener=ee.prototype.on;ee.prefixed=re;ee.EventEmitter=ee;ct=ee;var k={};ge(k,"LogLevel",()=>se,n=>se=n);ge(k,"default",()=>pr,n=>pr=n);var Ae=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(f){s={error:f}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},xe=function(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return n.concat(o||Array.prototype.slice.call(t))},ka="PeerJS: ",se;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(se||(se={}));var Ea=function(){function n(){this._logLevel=se.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=se.All&&this._print.apply(this,xe([se.All],Ae(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=se.Warnings&&this._print.apply(this,xe([se.Warnings],Ae(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=se.Errors&&this._print.apply(this,xe([se.Errors],Ae(t),!1))},n.prototype.setLogFunction=function(t){this._print=t},n.prototype._print=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=xe([ka],Ae(e),!1);for(var o in i)i[o]instanceof Error&&(i[o]="("+i[o].name+") "+i[o].message);t>=se.All?console.log.apply(console,xe([],Ae(i),!1)):t>=se.Warnings?console.warn.apply(console,xe(["WARNING"],Ae(i),!1)):t>=se.Errors&&console.error.apply(console,xe(["ERROR"],Ae(i),!1))},n}(),pr=new Ea,bi={};ge(bi,"Socket",()=>hr,n=>hr=n);var de;(function(n){n.Data="data",n.Media="media"})(de||(de={}));var V;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(V||(V={}));var ye;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(ye||(ye={}));var be;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(be||(be={}));var Y;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Y||(Y={}));var _n={};_n=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var Pa=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ra=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(f){s={error:f}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},Aa=function(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return n.concat(o||Array.prototype.slice.call(t))},xa=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},hr=function(n){Pa(t,n);function t(e,r,i,o,s,f){f===void 0&&(f=5e3);var c=n.call(this)||this;c.pingInterval=f,c._disconnected=!0,c._messagesQueue=[];var l=e?"wss://":"ws://";return c._baseUrl=l+r+":"+i+o+"peerjs?key="+s,c}return t.prototype.start=function(e,r){var i=this;this._id=e;var o="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(r);!!this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+_n.version),this._disconnected=!1,this._socket.onmessage=function(s){var f;try{f=JSON.parse(s.data),k.default.log("Server message received:",f)}catch{k.default.log("Invalid server message",s.data);return}i.emit(be.Message,f)},this._socket.onclose=function(s){i._disconnected||(k.default.log("Socket closed.",s),i._cleanup(),i._disconnected=!0,i.emit(be.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),k.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){k.default.log("Cannot send heartbeat, because socket closed");return}var e=JSON.stringify({type:Y.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var e,r,i=Aa([],Ra(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=xa(i),s=o.next();!s.done;s=o.next()){var f=s.value;this.send(f)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected){if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(be.Error,"Invalid message");return}if(!!this._wsOpen()){var r=JSON.stringify(e);this._socket.send(r)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(ct.EventEmitter),nn={};ge(nn,"MediaConnection",()=>_r,n=>_r=n);var vn={};ge(vn,"Negotiator",()=>mr,n=>mr=n);var xt=function(){return xt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},xt.apply(this,arguments)},gt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function f(d){try{l(r.next(d))}catch(a){s(a)}}function c(d){try{l(r.throw(d))}catch(a){s(a)}}function l(d){d.done?o(d.value):i(d.value).then(f,c)}l((r=r.apply(n,t||[])).next())})},_t=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function f(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){e.label=l[1];break}if(l[0]===6&&e.label<o[1]){e.label=o[1],o=l;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(l);break}o[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(d){l=[6,d],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},mr=function(){function n(t){this.connection=t}return n.prototype.startConnection=function(t){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===de.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){if(this.connection.type===de.Data){var r=this.connection,i={ordered:!!t.reliable},o=e.createDataChannel(r.label,i);r.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},n.prototype._startPeerConnection=function(){k.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},n.prototype._setupListeners=function(t){var e=this,r=this.connection.peer,i=this.connection.connectionId,o=this.connection.type,s=this.connection.provider;k.default.log("Listening for ICE candidates."),t.onicecandidate=function(f){!f.candidate||!f.candidate.candidate||(k.default.log("Received ICE candidates for ".concat(r,":"),f.candidate),s.socket.send({type:Y.Candidate,payload:{candidate:f.candidate,type:o,connectionId:i},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":k.default.log("iceConnectionState is failed, closing connections to "+r),e.connection.emit("error",new Error("Negotiation of connection to "+r+" failed.")),e.connection.close();break;case"closed":k.default.log("iceConnectionState is closed, closing connections to "+r),e.connection.emit("error",new Error("Connection to "+r+" closed.")),e.connection.close();break;case"disconnected":k.default.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":t.onicecandidate=U.noop;break}e.connection.emit("iceStateChanged",t.iceConnectionState)},k.default.log("Listening for data channel"),t.ondatachannel=function(f){k.default.log("Received data channel");var c=f.channel,l=s.getConnection(r,i);l.initialize(c)},k.default.log("Listening for remote stream"),t.ontrack=function(f){k.default.log("Received remote stream");var c=f.streams[0],l=s.getConnection(r,i);if(l.type===de.Media){var d=l;e._addStreamToMediaConnection(c,d)}}},n.prototype.cleanup=function(){k.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(!!t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var e=t.signalingState!=="closed",r=!1;if(this.connection.type===de.Data){var i=this.connection,o=i.dataChannel;o&&(r=!!o.readyState&&o.readyState!=="closed")}(e||r)&&t.close()}},n.prototype._makeOffer=function(){return gt(this,void 0,Promise,function(){var t,e,r,i,o,s,f;return _t(this,function(c){switch(c.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:r=c.sent(),k.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return c.sent(),k.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:U.browser},this.connection.type===de.Data&&(o=this.connection,i=xt(xt({},i),{label:o.label,reliable:o.reliable,serialization:o.serialization})),e.socket.send({type:Y.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return s=c.sent(),s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(V.WebRTC,s),k.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return f=c.sent(),e.emitError(V.WebRTC,f),k.default.log("Failed to createOffer, ",f),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return gt(this,void 0,Promise,function(){var t,e,r,i,o;return _t(this,function(s){switch(s.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:r=s.sent(),k.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return s.sent(),k.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),e.socket.send({type:Y.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:U.browser},dst:this.connection.peer}),[3,6];case 5:return i=s.sent(),e.emitError(V.WebRTC,i),k.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return o=s.sent(),e.emitError(V.WebRTC,o),k.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(t,e){return gt(this,void 0,Promise,function(){var r,i,o,s;return _t(this,function(f){switch(f.label){case 0:e=new RTCSessionDescription(e),r=this.connection.peerConnection,i=this.connection.provider,k.default.log("Setting remote description",e),o=this,f.label=1;case 1:return f.trys.push([1,5,,6]),[4,r.setRemoteDescription(e)];case 2:return f.sent(),k.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:f.sent(),f.label=4;case 4:return[3,6];case 5:return s=f.sent(),i.emitError(V.WebRTC,s),k.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(t){return gt(this,void 0,Promise,function(){var e,r,i,o,s,f;return _t(this,function(c){switch(c.label){case 0:k.default.log("handleCandidate:",t),e=t.candidate,r=t.sdpMLineIndex,i=t.sdpMid,o=this.connection.peerConnection,s=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:r,candidate:e}))];case 2:return c.sent(),k.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return f=c.sent(),s.emitError(V.WebRTC,f),k.default.log("Failed to handleCandidate, ",f),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(t,e){if(k.default.log("add tracks from stream ".concat(t.id," to peer connection")),!e.addTrack)return k.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(r){e.addTrack(r,t)})},n.prototype._addStreamToMediaConnection=function(t,e){k.default.log("add stream ".concat(t.id," to media connection ").concat(e.connectionId)),e.addStream(t)},n}(),yn={};ge(yn,"BaseConnection",()=>gr,n=>gr=n);var Ia=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),gr=function(n){Ia(t,n);function t(e,r,i){var o=n.call(this)||this;return o.peer=e,o.provider=r,o.options=i,o._open=!1,o.metadata=i.metadata,o}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(ct.EventEmitter),wa=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),It=function(){return It=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},It.apply(this,arguments)},Ma=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_r=function(n){wa(t,n);function t(e,r,i){var o=n.call(this,e,r,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||t.ID_PREFIX+U.randomToken(),o._negotiator=new vn.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(t.prototype,"type",{get:function(){return de.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(e){k.default.log("Receiving stream",e),this._remoteStream=e,n.prototype.emit.call(this,"stream",e)},t.prototype.handleMessage=function(e){var r=e.type,i=e.payload;switch(e.type){case Y.Answer:this._negotiator.handleSDP(r,i.sdp),this._open=!0;break;case Y.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:k.default.warn("Unrecognized message type:".concat(r," from peer:").concat(this.peer));break}},t.prototype.answer=function(e,r){var i,o;if(r===void 0&&(r={}),this._localStream){k.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection(It(It({},this.options._payload),{_stream:e}));var s=this.provider._getMessages(this.connectionId);try{for(var f=Ma(s),c=f.next();!c.done;c=f.next()){var l=c.value;this.handleMessage(l)}}catch(d){i={error:d}}finally{try{c&&!c.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(yn.BaseConnection),rn={};ge(rn,"DataConnection",()=>yr,n=>yr=n);var Ci={};ge(Ci,"EncodingQueue",()=>vr,n=>vr=n);var Da=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),vr=function(n){Da(t,n);function t(){var e=n.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(r){e._processing=!1,r.target&&e.emit("done",r.target.result),e.doNextTask()},e.fileReader.onerror=function(r){k.default.error("EncodingQueue error:",r),e._processing=!1,e.destroy(),e.emit("error",r)},e}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(ct.EventEmitter),Oa=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ba=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},yr=function(n){Oa(t,n);function t(e,r,i){var o=n.call(this,e,r,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new Ci.EncodingQueue,o.connectionId=o.options.connectionId||t.ID_PREFIX+U.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||ye.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(s){o._bufferedSend(s)}),o._encodingQueue.on("error",function(){k.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new vn.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(t.prototype,"type",{get:function(){return de.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;(!U.supports.binaryBlob||U.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){k.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(r){k.default.log("DC#".concat(e.connectionId," dc onmessage:"),r.data),e._handleDataMessage(r)},this.dataChannel.onclose=function(){k.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},t.prototype._handleDataMessage=function(e){var r=this,i=e.data,o=i.constructor,s=this.serialization===ye.Binary||this.serialization===ye.BinaryUTF8,f=i;if(s){if(o===Blob){U.blobToArrayBuffer(i,function(l){var d=U.unpack(l);r.emit("data",d)});return}else if(o===ArrayBuffer)f=U.unpack(i);else if(o===String){var c=U.binaryStringToArrayBuffer(i);f=U.unpack(c)}}else this.serialization===ye.JSON&&(f=this.parse(i));if(f.__peerData){this._handleChunk(f);return}n.prototype.emit.call(this,"data",f)},t.prototype._handleChunk=function(e){var r=e.__peerData,i=this._chunkedData[r]||{data:[],count:0,total:e.total};if(i.data[e.n]=e.data,i.count++,this._chunkedData[r]=i,i.total===i.count){delete this._chunkedData[r];var o=new Blob(i.data);this._handleDataMessage({data:o})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.prototype.send=function(e,r){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===ye.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===ye.Binary||this.serialization===ye.BinaryUTF8){var i=U.pack(e);if(!r&&i.size>U.chunkedMTU){this._sendChunks(i);return}U.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(e)},t.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var r=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){r._buffering=!1,r._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(i){return k.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var r,i,o=U.chunk(e);k.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var s=Ba(o),f=s.next();!f.done;f=s.next()){var c=f.value;this.send(c,!0)}}catch(l){r={error:l}}finally{try{f&&!f.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.handleMessage=function(e){var r=e.payload;switch(e.type){case Y.Answer:this._negotiator.handleSDP(e.type,r.sdp);break;case Y.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:k.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(yn.BaseConnection),Si={};ge(Si,"API",()=>Sr,n=>Sr=n);var br=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function f(d){try{l(r.next(d))}catch(a){s(a)}}function c(d){try{l(r.throw(d))}catch(a){s(a)}}function l(d){d.done?o(d.value):i(d.value).then(f,c)}l((r=r.apply(n,t||[])).next())})},Cr=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function f(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){e.label=l[1];break}if(l[0]===6&&e.label<o[1]){e.label=o[1],o=l;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(l);break}o[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(d){l=[6,d],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Sr=function(){function n(t){this._options=t}return n.prototype._buildRequest=function(t){var e=this._options.secure?"https":"http",r=this._options,i=r.host,o=r.port,s=r.path,f=r.key,c=new URL("".concat(e,"://").concat(i,":").concat(o).concat(s).concat(f,"/").concat(t));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",_n.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return br(this,void 0,Promise,function(){var t,e,r;return Cr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=i.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw e=i.sent(),k.default.error("Error retrieving ID",e),r="",this._options.path==="/"&&this._options.host!==U.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return br(this,void 0,Promise,function(){var t,e,r;return Cr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=i.sent(),t.status!==200)throw t.status===401?(e="",this._options.host===U.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw r=i.sent(),k.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 3:return[2]}})})},n}(),La=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),tt=function(){return tt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},tt.apply(this,arguments)},Je=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Fa=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(f){s={error:f}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},on=function(n){La(t,n);function t(e,r){var i=n.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var o;return e&&e.constructor==Object?r=e:e&&(o=e.toString()),r=tt({debug:0,host:U.CLOUD_HOST,port:U.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:U.randomToken(),config:U.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},r),i._options=r,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==U.CLOUD_HOST?i._options.secure=U.isSecure():i._options.host==U.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&k.default.setLogFunction(i._options.logFunction),k.default.logLevel=i._options.debug||0,i._api=new Si.API(r),i._socket=i._createServerConnection(),!U.supports.audioVideo&&!U.supports.data?(i._delayedAbort(V.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!o&&!U.validateId(o)?(i._delayedAbort(V.InvalidID,'ID "'.concat(o,'" is invalid')),i):(o?i._initialize(o):i._api.retrieveId().then(function(s){return i._initialize(s)}).catch(function(s){return i._abort(V.ServerError,s)}),i)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,r,i=Object.create(null);try{for(var o=Je(this._connections),s=o.next();!s.done;s=o.next()){var f=Fa(s.value,2),c=f[0],l=f[1];i[c]=l}}catch(d){e={error:d}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,r=new bi.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return r.on(be.Message,function(i){e._handleMessage(i)}),r.on(be.Error,function(i){e._abort(V.SocketError,i)}),r.on(be.Disconnected,function(){e.disconnected||(e.emitError(V.Network,"Lost connection to server."),e.disconnect())}),r.on(be.Close,function(){e.disconnected||e._abort(V.SocketClosed,"Underlying socket is already closed.")}),r},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var r,i,o=e.type,s=e.payload,f=e.src;switch(o){case Y.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Y.Error:this._abort(V.ServerError,s.msg);break;case Y.IdTaken:this._abort(V.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Y.InvalidKey:this._abort(V.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Y.Leave:k.default.log("Received leave message from ".concat(f)),this._cleanupPeer(f),this._connections.delete(f);break;case Y.Expire:this.emitError(V.PeerUnavailable,"Could not connect to peer ".concat(f));break;case Y.Offer:var h=s.connectionId,g=this.getConnection(f,h);if(g&&(g.close(),k.default.warn("Offer received for existing Connection ID:".concat(h))),s.type===de.Media){var c=new nn.MediaConnection(f,this,{connectionId:h,_payload:s,metadata:s.metadata});g=c,this._addConnection(f,g),this.emit("call",c)}else if(s.type===de.Data){var l=new rn.DataConnection(f,this,{connectionId:h,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});g=l,this._addConnection(f,g),this.emit("connection",l)}else{k.default.warn("Received malformed connection type:".concat(s.type));return}var d=this._getMessages(h);try{for(var a=Je(d),u=a.next();!u.done;u=a.next()){var p=u.value;g.handleMessage(p)}}catch(_){r={error:_}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}break;default:if(!s){k.default.warn("You received a malformed message from ".concat(f," of type ").concat(o));return}var h=s.connectionId,g=this.getConnection(f,h);g&&g.peerConnection?g.handleMessage(e):h?this._storeMessage(h,e):k.default.warn("You received an unrecognized message:",e);break}},t.prototype._storeMessage=function(e,r){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(r)},t.prototype._getMessages=function(e){var r=this._lostMessages.get(e);return r?(this._lostMessages.delete(e),r):[]},t.prototype.connect=function(e,r){if(r===void 0&&(r={}),this.disconnected){k.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(V.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new rn.DataConnection(e,this,r);return this._addConnection(e,i),i},t.prototype.call=function(e,r,i){if(i===void 0&&(i={}),this.disconnected){k.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(V.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!r){k.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new nn.MediaConnection(e,this,tt(tt({},i),{_stream:r}));return this._addConnection(e,o),o},t.prototype._addConnection=function(e,r){k.default.log("add connection ".concat(r.type,":").concat(r.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(r)},t.prototype._removeConnection=function(e){var r=this._connections.get(e.peer);if(r){var i=r.indexOf(e);i!==-1&&r.splice(i,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,r){var i,o,s=this._connections.get(e);if(!s)return null;try{for(var f=Je(s),c=f.next();!c.done;c=f.next()){var l=c.value;if(l.connectionId===r)return l}}catch(d){i={error:d}}finally{try{c&&!c.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(e,r){var i=this;setTimeout(function(){i._abort(e,r)},0)},t.prototype._abort=function(e,r){k.default.error("Aborting!"),this.emitError(e,r),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,r){k.default.error("Error:",r);var i;typeof r=="string"?i=new Error(r):i=r,i.type=e,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(k.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var e,r;try{for(var i=Je(this._connections.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;this._cleanupPeer(s),this._connections.delete(s)}}catch(f){e={error:f}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var r,i,o=this._connections.get(e);if(!!o)try{for(var s=Je(o),f=s.next();!f.done;f=s.next()){var c=f.value;c.close()}}catch(l){r={error:l}}finally{try{f&&!f.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;k.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)k.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)k.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(e){var r=this;e===void 0&&(e=function(i){}),this._api.listAllPeers().then(function(i){return e(i)}).catch(function(i){return r._abort(V.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(ct.EventEmitter);vi.Peer;class ja{constructor(t,e){ue(this,"connectionState",Lr({type:"init"}));ue(this,"peer",new on);this.onMessage=e,this.peer.on("open",r=>{console.log("Connection to the PeerServer is established."),t?this.onConnection(this.peer.connect(t)):this.connectionState.set({type:"ready",peerId:r})}),this.peer.on("error",r=>{console.error("Failed to connect to the PeerServer.",r),this.connectionState.set({type:"error",error:r})}),t||this.peer.on("connection",r=>{console.log("New data connection is established from a remote peer."),this.onConnection(r)})}send(t){const e=Qe(this.connectionState);e.type==="connected"&&(console.log("%c\u2B07\uFE0F Send data to the remote peer.","color: red",t),e.connection.send(t))}onConnection(t){Qe(this.connectionState).type!=="connected"&&(this.connectionState.set({type:"connecting"}),t.on("open",()=>{console.log("The connection is established and ready-to-use."),this.connectionState.set({type:"connected",connection:t})}),t.on("close",()=>{console.log("Either you or the remote peer closes the data connection."),this.connectionState.set({type:"disconnected"})}),t.on("data",r=>{console.log("%c\u2B06\uFE0F Data is received from the remote peer.","color: green",r),this.onMessage(r)}),t.on("error",r=>{console.log("Failed to connect to the remote peer.",r),this.connectionState.set({type:"error",error:r})}))}}function $a(n){let t,e=n[0]?"\u2714\uFE0F":"\u{1F4CB}",r,i,o=n[0]?"Copied!":"Copy",s,f,c;return{c(){t=I("button"),r=Q(e),i=$(),s=Q(o)},m(l,d){O(l,t,d),R(t,r),R(t,i),R(t,s),f||(c=Me(t,"click",n[1]),f=!0)},p(l,[d]){d&1&&e!==(e=l[0]?"\u2714\uFE0F":"\u{1F4CB}")&&pe(r,e),d&1&&o!==(o=l[0]?"Copied!":"Copy")&&pe(s,o)},i:N,o:N,d(l){l&&M(t),f=!1,c()}}}function Na(n,t,e){let{textToCopy:r}=t,i=!1;function o(){navigator.clipboard.writeText(r).then(()=>{e(0,i=!0),setTimeout(()=>e(0,i=!1),2e3)},s=>console.error("Could not copy text: ",s))}return n.$$set=s=>{"textToCopy"in s&&e(2,r=s.textToCopy)},[i,o,r]}class Ua extends Pe{constructor(t){super(),Ee(this,t,Na,$a,Se,{textToCopy:2})}}var lt={},Ga=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Ti={},le={};let bn;const za=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];le.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};le.getSymbolTotalCodewords=function(t){return za[t]};le.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};le.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');bn=t};le.isKanjiModeEnabled=function(){return typeof bn<"u"};le.toSJIS=function(t){return bn(t)};var Ot={};(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+e)}}n.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},n.from=function(r,i){if(n.isValid(r))return r;try{return t(r)}catch{return i}}})(Ot);function ki(){this.buffer=[],this.length=0}ki.prototype={get:function(n){const t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var Ha=ki;function ut(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}ut.prototype.set=function(n,t,e,r){const i=n*this.size+t;this.data[i]=e,r&&(this.reservedBit[i]=!0)};ut.prototype.get=function(n,t){return this.data[n*this.size+t]};ut.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};ut.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};var Va=ut,Ei={};(function(n){const t=le.getSymbolSize;n.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,o=t(r),s=o===145?26:Math.ceil((o-13)/(2*i-2))*2,f=[o-7];for(let c=1;c<i-1;c++)f[c]=f[c-1]-s;return f.push(6),f.reverse()},n.getPositions=function(r){const i=[],o=n.getRowColCoords(r),s=o.length;for(let f=0;f<s;f++)for(let c=0;c<s;c++)f===0&&c===0||f===0&&c===s-1||f===s-1&&c===0||i.push([o[f],o[c]]);return i}})(Ei);var Pi={};const Ja=le.getSymbolSize,Tr=7;Pi.getPositions=function(t){const e=Ja(t);return[[0,0],[e-Tr,0],[0,e-Tr]]};var Ri={};(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};n.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},n.from=function(i){return n.isValid(i)?parseInt(i,10):void 0},n.getPenaltyN1=function(i){const o=i.size;let s=0,f=0,c=0,l=null,d=null;for(let a=0;a<o;a++){f=c=0,l=d=null;for(let u=0;u<o;u++){let p=i.get(a,u);p===l?f++:(f>=5&&(s+=t.N1+(f-5)),l=p,f=1),p=i.get(u,a),p===d?c++:(c>=5&&(s+=t.N1+(c-5)),d=p,c=1)}f>=5&&(s+=t.N1+(f-5)),c>=5&&(s+=t.N1+(c-5))}return s},n.getPenaltyN2=function(i){const o=i.size;let s=0;for(let f=0;f<o-1;f++)for(let c=0;c<o-1;c++){const l=i.get(f,c)+i.get(f,c+1)+i.get(f+1,c)+i.get(f+1,c+1);(l===4||l===0)&&s++}return s*t.N2},n.getPenaltyN3=function(i){const o=i.size;let s=0,f=0,c=0;for(let l=0;l<o;l++){f=c=0;for(let d=0;d<o;d++)f=f<<1&2047|i.get(l,d),d>=10&&(f===1488||f===93)&&s++,c=c<<1&2047|i.get(d,l),d>=10&&(c===1488||c===93)&&s++}return s*t.N3},n.getPenaltyN4=function(i){let o=0;const s=i.data.length;for(let c=0;c<s;c++)o+=i.data[c];return Math.abs(Math.ceil(o*100/s/5)-10)*t.N4};function e(r,i,o){switch(r){case n.Patterns.PATTERN000:return(i+o)%2===0;case n.Patterns.PATTERN001:return i%2===0;case n.Patterns.PATTERN010:return o%3===0;case n.Patterns.PATTERN011:return(i+o)%3===0;case n.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(o/3))%2===0;case n.Patterns.PATTERN101:return i*o%2+i*o%3===0;case n.Patterns.PATTERN110:return(i*o%2+i*o%3)%2===0;case n.Patterns.PATTERN111:return(i*o%3+(i+o)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}n.applyMask=function(i,o){const s=o.size;for(let f=0;f<s;f++)for(let c=0;c<s;c++)o.isReserved(c,f)||o.xor(c,f,e(i,c,f))},n.getBestMask=function(i,o){const s=Object.keys(n.Patterns).length;let f=0,c=1/0;for(let l=0;l<s;l++){o(l),n.applyMask(l,i);const d=n.getPenaltyN1(i)+n.getPenaltyN2(i)+n.getPenaltyN3(i)+n.getPenaltyN4(i);n.applyMask(l,i),d<c&&(c=d,f=l)}return f}})(Ri);var Bt={};const ke=Ot,vt=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],yt=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Bt.getBlocksCount=function(t,e){switch(e){case ke.L:return vt[(t-1)*4+0];case ke.M:return vt[(t-1)*4+1];case ke.Q:return vt[(t-1)*4+2];case ke.H:return vt[(t-1)*4+3];default:return}};Bt.getTotalCodewordsCount=function(t,e){switch(e){case ke.L:return yt[(t-1)*4+0];case ke.M:return yt[(t-1)*4+1];case ke.Q:return yt[(t-1)*4+2];case ke.H:return yt[(t-1)*4+3];default:return}};var Ai={},Lt={};const nt=new Uint8Array(512),wt=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)nt[e]=t,wt[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)nt[e]=nt[e-255]})();Lt.log=function(t){if(t<1)throw new Error("log("+t+")");return wt[t]};Lt.exp=function(t){return nt[t]};Lt.mul=function(t,e){return t===0||e===0?0:nt[wt[t]+wt[e]]};(function(n){const t=Lt;n.mul=function(r,i){const o=new Uint8Array(r.length+i.length-1);for(let s=0;s<r.length;s++)for(let f=0;f<i.length;f++)o[s+f]^=t.mul(r[s],i[f]);return o},n.mod=function(r,i){let o=new Uint8Array(r);for(;o.length-i.length>=0;){const s=o[0];for(let c=0;c<i.length;c++)o[c]^=t.mul(i[c],s);let f=0;for(;f<o.length&&o[f]===0;)f++;o=o.slice(f)}return o},n.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let o=0;o<r;o++)i=n.mul(i,new Uint8Array([1,t.exp(o)]));return i}})(Ai);const xi=Ai;function Cn(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}Cn.prototype.initialize=function(t){this.degree=t,this.genPoly=xi.generateECPolynomial(this.degree)};Cn.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const r=xi.mod(e,this.genPoly),i=this.degree-r.length;if(i>0){const o=new Uint8Array(this.degree);return o.set(r,i),o}return r};var qa=Cn,Ii={},Re={},Sn={};Sn.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var _e={};const wi="[0-9]+",Ya="[A-Z $%*+\\-./:]+";let at="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";at=at.replace(/u/g,"\\u");const Ka="(?:(?![A-Z0-9 $%*+\\-./:]|"+at+`)(?:.|[\r
]))+`;_e.KANJI=new RegExp(at,"g");_e.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");_e.BYTE=new RegExp(Ka,"g");_e.NUMERIC=new RegExp(wi,"g");_e.ALPHANUMERIC=new RegExp(Ya,"g");const Wa=new RegExp("^"+at+"$"),Xa=new RegExp("^"+wi+"$"),Qa=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");_e.testKanji=function(t){return Wa.test(t)};_e.testNumeric=function(t){return Xa.test(t)};_e.testAlphanumeric=function(t){return Qa.test(t)};(function(n){const t=Sn,e=_e;n.NUMERIC={id:"Numeric",bit:1<<0,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:1<<1,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:1<<2,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:1<<3,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(o,s){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!t.isValid(s))throw new Error("Invalid version: "+s);return s>=1&&s<10?o.ccBits[0]:s<27?o.ccBits[1]:o.ccBits[2]},n.getBestModeForData=function(o){return e.testNumeric(o)?n.NUMERIC:e.testAlphanumeric(o)?n.ALPHANUMERIC:e.testKanji(o)?n.KANJI:n.BYTE},n.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},n.isValid=function(o){return o&&o.bit&&o.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+i)}}n.from=function(o,s){if(n.isValid(o))return o;try{return r(o)}catch{return s}}})(Re);(function(n){const t=le,e=Bt,r=Ot,i=Re,o=Sn,s=1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,f=t.getBCHDigit(s);function c(u,p,h){for(let g=1;g<=40;g++)if(p<=n.getCapacity(g,h,u))return g}function l(u,p){return i.getCharCountIndicator(u,p)+4}function d(u,p){let h=0;return u.forEach(function(g){const _=l(g.mode,p);h+=_+g.getBitsLength()}),h}function a(u,p){for(let h=1;h<=40;h++)if(d(u,h)<=n.getCapacity(h,p,i.MIXED))return h}n.from=function(p,h){return o.isValid(p)?parseInt(p,10):h},n.getCapacity=function(p,h,g){if(!o.isValid(p))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=i.BYTE);const _=t.getSymbolTotalCodewords(p),m=e.getTotalCodewordsCount(p,h),v=(_-m)*8;if(g===i.MIXED)return v;const y=v-l(g,p);switch(g){case i.NUMERIC:return Math.floor(y/10*3);case i.ALPHANUMERIC:return Math.floor(y/11*2);case i.KANJI:return Math.floor(y/13);case i.BYTE:default:return Math.floor(y/8)}},n.getBestVersionForData=function(p,h){let g;const _=r.from(h,r.M);if(Array.isArray(p)){if(p.length>1)return a(p,_);if(p.length===0)return 1;g=p[0]}else g=p;return c(g.mode,g.getLength(),_)},n.getEncodedBits=function(p){if(!o.isValid(p)||p<7)throw new Error("Invalid QR Code version");let h=p<<12;for(;t.getBCHDigit(h)-f>=0;)h^=s<<t.getBCHDigit(h)-f;return p<<12|h}})(Ii);var Mi={};const an=le,Di=1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,Za=1<<14|1<<12|1<<10|1<<4|1<<1,kr=an.getBCHDigit(Di);Mi.getEncodedBits=function(t,e){const r=t.bit<<3|e;let i=r<<10;for(;an.getBCHDigit(i)-kr>=0;)i^=Di<<an.getBCHDigit(i)-kr;return(r<<10|i)^Za};var Oi={};const es=Re;function Fe(n){this.mode=es.NUMERIC,this.data=n.toString()}Fe.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Fe.prototype.getLength=function(){return this.data.length};Fe.prototype.getBitsLength=function(){return Fe.getBitsLength(this.data.length)};Fe.prototype.write=function(t){let e,r,i;for(e=0;e+3<=this.data.length;e+=3)r=this.data.substr(e,3),i=parseInt(r,10),t.put(i,10);const o=this.data.length-e;o>0&&(r=this.data.substr(e),i=parseInt(r,10),t.put(i,o*3+1))};var ts=Fe;const ns=Re,zt=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function je(n){this.mode=ns.ALPHANUMERIC,this.data=n}je.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};je.prototype.getLength=function(){return this.data.length};je.prototype.getBitsLength=function(){return je.getBitsLength(this.data.length)};je.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let r=zt.indexOf(this.data[e])*45;r+=zt.indexOf(this.data[e+1]),t.put(r,11)}this.data.length%2&&t.put(zt.indexOf(this.data[e]),6)};var rs=je,is=function(t){for(var e=[],r=t.length,i=0;i<r;i++){var o=t.charCodeAt(i);if(o>=55296&&o<=56319&&r>i+1){var s=t.charCodeAt(i+1);s>=56320&&s<=57343&&(o=(o-55296)*1024+s-56320+65536,i+=1)}if(o<128){e.push(o);continue}if(o<2048){e.push(o>>6|192),e.push(o&63|128);continue}if(o<55296||o>=57344&&o<65536){e.push(o>>12|224),e.push(o>>6&63|128),e.push(o&63|128);continue}if(o>=65536&&o<=1114111){e.push(o>>18|240),e.push(o>>12&63|128),e.push(o>>6&63|128),e.push(o&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer};const os=is,as=Re;function $e(n){this.mode=as.BYTE,typeof n=="string"&&(n=os(n)),this.data=new Uint8Array(n)}$e.getBitsLength=function(t){return t*8};$e.prototype.getLength=function(){return this.data.length};$e.prototype.getBitsLength=function(){return $e.getBitsLength(this.data.length)};$e.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};var ss=$e;const cs=Re,ls=le;function Ne(n){this.mode=cs.KANJI,this.data=n}Ne.getBitsLength=function(t){return t*13};Ne.prototype.getLength=function(){return this.data.length};Ne.prototype.getBitsLength=function(){return Ne.getBitsLength(this.data.length)};Ne.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=ls.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};var us=Ne,Bi={exports:{}};(function(n){var t={single_source_shortest_paths:function(e,r,i){var o={},s={};s[r]=0;var f=t.PriorityQueue.make();f.push(r,0);for(var c,l,d,a,u,p,h,g,_;!f.empty();){c=f.pop(),l=c.value,a=c.cost,u=e[l]||{};for(d in u)u.hasOwnProperty(d)&&(p=u[d],h=a+p,g=s[d],_=typeof s[d]>"u",(_||g>h)&&(s[d]=h,f.push(d,h),o[d]=l))}if(typeof i<"u"&&typeof s[i]>"u"){var m=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(m)}return o},extract_shortest_path_from_predecessor_list:function(e,r){for(var i=[],o=r;o;)i.push(o),e[o],o=e[o];return i.reverse(),i},find_path:function(e,r,i){var o=t.single_source_shortest_paths(e,r,i);return t.extract_shortest_path_from_predecessor_list(o,i)},PriorityQueue:{make:function(e){var r=t.PriorityQueue,i={},o;e=e||{};for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);return i.queue=[],i.sorter=e.sorter||r.default_sorter,i},default_sorter:function(e,r){return e.cost-r.cost},push:function(e,r){var i={value:e,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=t})(Bi);(function(n){const t=Re,e=ts,r=rs,i=ss,o=us,s=_e,f=le,c=Bi.exports;function l(m){return unescape(encodeURIComponent(m)).length}function d(m,v,y){const b=[];let C;for(;(C=m.exec(y))!==null;)b.push({data:C[0],index:C.index,mode:v,length:C[0].length});return b}function a(m){const v=d(s.NUMERIC,t.NUMERIC,m),y=d(s.ALPHANUMERIC,t.ALPHANUMERIC,m);let b,C;return f.isKanjiModeEnabled()?(b=d(s.BYTE,t.BYTE,m),C=d(s.KANJI,t.KANJI,m)):(b=d(s.BYTE_KANJI,t.BYTE,m),C=[]),v.concat(y,b,C).sort(function(P,w){return P.index-w.index}).map(function(P){return{data:P.data,mode:P.mode,length:P.length}})}function u(m,v){switch(v){case t.NUMERIC:return e.getBitsLength(m);case t.ALPHANUMERIC:return r.getBitsLength(m);case t.KANJI:return o.getBitsLength(m);case t.BYTE:return i.getBitsLength(m)}}function p(m){return m.reduce(function(v,y){const b=v.length-1>=0?v[v.length-1]:null;return b&&b.mode===y.mode?(v[v.length-1].data+=y.data,v):(v.push(y),v)},[])}function h(m){const v=[];for(let y=0;y<m.length;y++){const b=m[y];switch(b.mode){case t.NUMERIC:v.push([b,{data:b.data,mode:t.ALPHANUMERIC,length:b.length},{data:b.data,mode:t.BYTE,length:b.length}]);break;case t.ALPHANUMERIC:v.push([b,{data:b.data,mode:t.BYTE,length:b.length}]);break;case t.KANJI:v.push([b,{data:b.data,mode:t.BYTE,length:l(b.data)}]);break;case t.BYTE:v.push([{data:b.data,mode:t.BYTE,length:l(b.data)}])}}return v}function g(m,v){const y={},b={start:{}};let C=["start"];for(let S=0;S<m.length;S++){const P=m[S],w=[];for(let E=0;E<P.length;E++){const x=P[E],ie=""+S+E;w.push(ie),y[ie]={node:x,lastCount:0},b[ie]={};for(let J=0;J<C.length;J++){const q=C[J];y[q]&&y[q].node.mode===x.mode?(b[q][ie]=u(y[q].lastCount+x.length,x.mode)-u(y[q].lastCount,x.mode),y[q].lastCount+=x.length):(y[q]&&(y[q].lastCount=x.length),b[q][ie]=u(x.length,x.mode)+4+t.getCharCountIndicator(x.mode,v))}}C=w}for(let S=0;S<C.length;S++)b[C[S]].end=0;return{map:b,table:y}}function _(m,v){let y;const b=t.getBestModeForData(m);if(y=t.from(v,b),y!==t.BYTE&&y.bit<b.bit)throw new Error('"'+m+'" cannot be encoded with mode '+t.toString(y)+`.
 Suggested mode is: `+t.toString(b));switch(y===t.KANJI&&!f.isKanjiModeEnabled()&&(y=t.BYTE),y){case t.NUMERIC:return new e(m);case t.ALPHANUMERIC:return new r(m);case t.KANJI:return new o(m);case t.BYTE:return new i(m)}}n.fromArray=function(v){return v.reduce(function(y,b){return typeof b=="string"?y.push(_(b,null)):b.data&&y.push(_(b.data,b.mode)),y},[])},n.fromString=function(v,y){const b=a(v,f.isKanjiModeEnabled()),C=h(b),S=g(C,y),P=c.find_path(S.map,"start","end"),w=[];for(let E=1;E<P.length-1;E++)w.push(S.table[P[E]].node);return n.fromArray(p(w))},n.rawSplit=function(v){return n.fromArray(a(v,f.isKanjiModeEnabled()))}})(Oi);const Ft=le,Ht=Ot,fs=Ha,ds=Va,ps=Ei,hs=Pi,sn=Ri,cn=Bt,ms=qa,Mt=Ii,gs=Mi,_s=Re,Vt=Oi;function vs(n,t){const e=n.size,r=hs.getPositions(t);for(let i=0;i<r.length;i++){const o=r[i][0],s=r[i][1];for(let f=-1;f<=7;f++)if(!(o+f<=-1||e<=o+f))for(let c=-1;c<=7;c++)s+c<=-1||e<=s+c||(f>=0&&f<=6&&(c===0||c===6)||c>=0&&c<=6&&(f===0||f===6)||f>=2&&f<=4&&c>=2&&c<=4?n.set(o+f,s+c,!0,!0):n.set(o+f,s+c,!1,!0))}}function ys(n){const t=n.size;for(let e=8;e<t-8;e++){const r=e%2===0;n.set(e,6,r,!0),n.set(6,e,r,!0)}}function bs(n,t){const e=ps.getPositions(t);for(let r=0;r<e.length;r++){const i=e[r][0],o=e[r][1];for(let s=-2;s<=2;s++)for(let f=-2;f<=2;f++)s===-2||s===2||f===-2||f===2||s===0&&f===0?n.set(i+s,o+f,!0,!0):n.set(i+s,o+f,!1,!0)}}function Cs(n,t){const e=n.size,r=Mt.getEncodedBits(t);let i,o,s;for(let f=0;f<18;f++)i=Math.floor(f/3),o=f%3+e-8-3,s=(r>>f&1)===1,n.set(i,o,s,!0),n.set(o,i,s,!0)}function Jt(n,t,e){const r=n.size,i=gs.getEncodedBits(t,e);let o,s;for(o=0;o<15;o++)s=(i>>o&1)===1,o<6?n.set(o,8,s,!0):o<8?n.set(o+1,8,s,!0):n.set(r-15+o,8,s,!0),o<8?n.set(8,r-o-1,s,!0):o<9?n.set(8,15-o-1+1,s,!0):n.set(8,15-o-1,s,!0);n.set(r-8,8,1,!0)}function Ss(n,t){const e=n.size;let r=-1,i=e-1,o=7,s=0;for(let f=e-1;f>0;f-=2)for(f===6&&f--;;){for(let c=0;c<2;c++)if(!n.isReserved(i,f-c)){let l=!1;s<t.length&&(l=(t[s]>>>o&1)===1),n.set(i,f-c,l),o--,o===-1&&(s++,o=7)}if(i+=r,i<0||e<=i){i-=r,r=-r;break}}}function Ts(n,t,e){const r=new fs;e.forEach(function(c){r.put(c.mode.bit,4),r.put(c.getLength(),_s.getCharCountIndicator(c.mode,n)),c.write(r)});const i=Ft.getSymbolTotalCodewords(n),o=cn.getTotalCodewordsCount(n,t),s=(i-o)*8;for(r.getLengthInBits()+4<=s&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const f=(s-r.getLengthInBits())/8;for(let c=0;c<f;c++)r.put(c%2?17:236,8);return ks(r,n,t)}function ks(n,t,e){const r=Ft.getSymbolTotalCodewords(t),i=cn.getTotalCodewordsCount(t,e),o=r-i,s=cn.getBlocksCount(t,e),f=r%s,c=s-f,l=Math.floor(r/s),d=Math.floor(o/s),a=d+1,u=l-d,p=new ms(u);let h=0;const g=new Array(s),_=new Array(s);let m=0;const v=new Uint8Array(n.buffer);for(let P=0;P<s;P++){const w=P<c?d:a;g[P]=v.slice(h,h+w),_[P]=p.encode(g[P]),h+=w,m=Math.max(m,w)}const y=new Uint8Array(r);let b=0,C,S;for(C=0;C<m;C++)for(S=0;S<s;S++)C<g[S].length&&(y[b++]=g[S][C]);for(C=0;C<u;C++)for(S=0;S<s;S++)y[b++]=_[S][C];return y}function Es(n,t,e,r){let i;if(Array.isArray(n))i=Vt.fromArray(n);else if(typeof n=="string"){let l=t;if(!l){const d=Vt.rawSplit(n);l=Mt.getBestVersionForData(d,e)}i=Vt.fromString(n,l||40)}else throw new Error("Invalid data");const o=Mt.getBestVersionForData(i,e);if(!o)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=o;else if(t<o)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+o+`.
`);const s=Ts(t,e,i),f=Ft.getSymbolSize(t),c=new ds(f);return vs(c,t),ys(c),bs(c,t),Jt(c,e,0),t>=7&&Cs(c,t),Ss(c,s),isNaN(r)&&(r=sn.getBestMask(c,Jt.bind(null,c,e))),sn.applyMask(r,c),Jt(c,e,r),{modules:c,version:t,errorCorrectionLevel:e,maskPattern:r,segments:i}}Ti.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let r=Ht.M,i,o;return typeof e<"u"&&(r=Ht.from(e.errorCorrectionLevel,Ht.M),i=Mt.from(e.version),o=sn.from(e.maskPattern),e.toSJISFunc&&Ft.setToSJISFunction(e.toSJISFunc)),Es(t,i,r,o)};var Li={},Tn={};(function(n){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let r=e.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+e);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(o){return[o,o]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}n.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,o=r.width&&r.width>=21?r.width:void 0,s=r.scale||4;return{width:o,scale:o?4:s,margin:i,color:{dark:t(r.color.dark||"#000000ff"),light:t(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},n.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},n.getImageWidth=function(r,i){const o=n.getScale(r,i);return Math.floor((r+i.margin*2)*o)},n.qrToImageData=function(r,i,o){const s=i.modules.size,f=i.modules.data,c=n.getScale(s,o),l=Math.floor((s+o.margin*2)*c),d=o.margin*c,a=[o.color.light,o.color.dark];for(let u=0;u<l;u++)for(let p=0;p<l;p++){let h=(u*l+p)*4,g=o.color.light;if(u>=d&&p>=d&&u<l-d&&p<l-d){const _=Math.floor((u-d)/c),m=Math.floor((p-d)/c);g=a[f[_*s+m]?1:0]}r[h++]=g.r,r[h++]=g.g,r[h++]=g.b,r[h]=g.a}}})(Tn);(function(n){const t=Tn;function e(i,o,s){i.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=s,o.width=s,o.style.height=s+"px",o.style.width=s+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(o,s,f){let c=f,l=s;typeof c>"u"&&(!s||!s.getContext)&&(c=s,s=void 0),s||(l=r()),c=t.getOptions(c);const d=t.getImageWidth(o.modules.size,c),a=l.getContext("2d"),u=a.createImageData(d,d);return t.qrToImageData(u.data,o,c),e(a,l,d),a.putImageData(u,0,0),l},n.renderToDataURL=function(o,s,f){let c=f;typeof c>"u"&&(!s||!s.getContext)&&(c=s,s=void 0),c||(c={});const l=n.render(o,s,c),d=c.type||"image/png",a=c.rendererOpts||{};return l.toDataURL(d,a.quality)}})(Li);var Fi={};const Ps=Tn;function Er(n,t){const e=n.a/255,r=t+'="'+n.hex+'"';return e<1?r+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':r}function qt(n,t,e){let r=n+t;return typeof e<"u"&&(r+=" "+e),r}function Rs(n,t,e){let r="",i=0,o=!1,s=0;for(let f=0;f<n.length;f++){const c=Math.floor(f%t),l=Math.floor(f/t);!c&&!o&&(o=!0),n[f]?(s++,f>0&&c>0&&n[f-1]||(r+=o?qt("M",c+e,.5+l+e):qt("m",i,0),i=0,o=!1),c+1<t&&n[f+1]||(r+=qt("h",s),s=0)):i++}return r}Fi.render=function(t,e,r){const i=Ps.getOptions(e),o=t.modules.size,s=t.modules.data,f=o+i.margin*2,c=i.color.light.a?"<path "+Er(i.color.light,"fill")+' d="M0 0h'+f+"v"+f+'H0z"/>':"",l="<path "+Er(i.color.dark,"stroke")+' d="'+Rs(s,o,i.margin)+'"/>',d='viewBox="0 0 '+f+" "+f+'"',u='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+d+' shape-rendering="crispEdges">'+c+l+`</svg>
`;return typeof r=="function"&&r(null,u),u};const As=Ga,ln=Ti,ji=Li,xs=Fi;function kn(n,t,e,r,i){const o=[].slice.call(arguments,1),s=o.length,f=typeof o[s-1]=="function";if(!f&&!As())throw new Error("Callback required as last argument");if(f){if(s<2)throw new Error("Too few arguments provided");s===2?(i=e,e=t,t=r=void 0):s===3&&(t.getContext&&typeof i>"u"?(i=r,r=void 0):(i=r,r=e,e=t,t=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(e=t,t=r=void 0):s===2&&!t.getContext&&(r=e,e=t,t=void 0),new Promise(function(c,l){try{const d=ln.create(e,r);c(n(d,t,r))}catch(d){l(d)}})}try{const c=ln.create(e,r);i(null,n(c,t,r))}catch(c){i(c)}}lt.create=ln.create;lt.toCanvas=kn.bind(null,ji.render);lt.toDataURL=kn.bind(null,ji.renderToDataURL);lt.toString=kn.bind(null,function(n,t,e){return xs.render(n,e)});function Is(n){let t,e;return{c(){t=I("img"),Ce(t.src,e=n[1])||T(t,"src",e),T(t,"alt",n[0])},m(r,i){O(r,t,i)},p(r,[i]){i&2&&!Ce(t.src,e=r[1])&&T(t,"src",e),i&1&&T(t,"alt",r[0])},i:N,o:N,d(r){r&&M(t)}}}function ws(n){return n?{dark:"#ffffffde",light:"#2f2f2fff"}:{dark:"#000000ff",light:"#ffffffff"}}function Ms(n,t,e){let{value:r}=t,{width:i=200}=t,o="";const s=window.matchMedia("(prefers-color-scheme: dark)");async function f(){e(1,o=await lt.toDataURL(r,{width:i,color:ws(s.matches)}))}function c(l){f()}return fn(()=>{s.addEventListener("change",c)}),Qi(()=>{s.removeEventListener("change",c)}),n.$$set=l=>{"value"in l&&e(0,r=l.value),"width"in l&&e(2,i=l.width)},n.$$.update=()=>{n.$$.dirty&1&&r&&f()},[r,o,i]}class Ds extends Pe{constructor(t){super(),Ee(this,t,Ms,Is,Se,{value:0,width:2})}}function Pr(n){let t,e,r,i;const o=[$s,js,Fs,Ls,Bs,Os],s=[];function f(c,l){if(c[0].type==="init")return 0;if(c[0].type==="connecting")return 1;if(c[0].type==="disconnected")return 2;if(c[0].type==="ready")return 3;return c[0].type,4;return 5}return e=f(n),r=s[e]=o[e](n),{c(){t=I("section"),r.c(),T(t,"class","svelte-eywiag")},m(c,l){O(c,t,l),s[e].m(t,null),i=!0},p(c,l){let d=e;e=f(c),e===d?s[e].p(c,l):(he(),j(s[d],1,1,()=>{s[d]=null}),me(),r=s[e],r?r.p(c,l):(r=s[e]=o[e](c),r.c()),B(r,1),r.m(t,null))},i(c){i||(B(r),i=!0)},o(c){j(r),i=!1},d(c){c&&M(t),s[e].d()}}}function Os(n){let t,e,r,i,o,s,f,c;return{c(){t=I("h1"),t.textContent="\u{1F914} Wrong state",e=$(),r=I("p"),i=Q(n[0]),o=$(),s=I("button"),s.textContent="\u{1F6AA} Go to start page"},m(l,d){O(l,t,d),O(l,e,d),O(l,r,d),R(r,i),O(l,o,d),O(l,s,d),f||(c=Me(s,"click",n[3]),f=!0)},p(l,d){d&1&&pe(i,l[0])},i:N,o:N,d(l){l&&M(t),l&&M(e),l&&M(r),l&&M(o),l&&M(s),f=!1,c()}}}function Bs(n){let t,e,r,i=n[0].error+"",o,s,f,c,l;return{c(){t=I("h1"),t.textContent="\u{1F635} Error",e=$(),r=I("p"),o=Q(i),s=$(),f=I("button"),f.textContent="\u{1F6AA} Go to start page"},m(d,a){O(d,t,a),O(d,e,a),O(d,r,a),R(r,o),O(d,s,a),O(d,f,a),c||(l=Me(f,"click",n[3]),c=!0)},p(d,a){a&1&&i!==(i=d[0].error+"")&&pe(o,i)},i:N,o:N,d(d){d&&M(t),d&&M(e),d&&M(r),d&&M(s),d&&M(f),c=!1,l()}}}function Ls(n){let t,e,r,i,o,s,f,c,l,d,a,u,p;return d=new Ua({props:{textToCopy:n[1]}}),u=new Ds({props:{value:n[1]}}),{c(){t=I("div"),e=I("h1"),e.textContent="\u{1F3B2} KNUCKLEBONES \u{1F3B2}",r=$(),i=I("p"),o=Q("Send the link below to another player:"),s=I("br"),f=I("a"),c=Q(n[1]),l=$(),ce(d.$$.fragment),a=$(),ce(u.$$.fragment),T(e,"class","game-title svelte-eywiag"),T(f,"href",n[1]),T(t,"class","ready-container svelte-eywiag")},m(h,g){O(h,t,g),R(t,e),R(t,r),R(t,i),R(i,o),R(i,s),R(i,f),R(f,c),R(t,l),te(d,t,null),R(t,a),te(u,t,null),p=!0},p(h,g){(!p||g&2)&&pe(c,h[1]),(!p||g&2)&&T(f,"href",h[1]);const _={};g&2&&(_.textToCopy=h[1]),d.$set(_);const m={};g&2&&(m.value=h[1]),u.$set(m)},i(h){p||(B(d.$$.fragment,h),B(u.$$.fragment,h),p=!0)},o(h){j(d.$$.fragment,h),j(u.$$.fragment,h),p=!1},d(h){h&&M(t),ne(d),ne(u)}}}function Fs(n){let t,e,r,i,o;return{c(){t=I("p"),t.textContent="Remote peer closes the data connection.",e=$(),r=I("button"),r.textContent="\u{1F6AA} Go to start page"},m(s,f){O(s,t,f),O(s,e,f),O(s,r,f),i||(o=Me(r,"click",n[3]),i=!0)},p:N,i:N,o:N,d(s){s&&M(t),s&&M(e),s&&M(r),i=!1,o()}}}function js(n){let t;return{c(){t=I("p"),t.textContent="\u231B Connectioning to the remote player",T(t,"class","loading svelte-eywiag")},m(e,r){O(e,t,r)},p:N,i:N,o:N,d(e){e&&M(t)}}}function $s(n){let t;return{c(){t=I("p"),t.textContent="\u231B Connection to the PeerServer",T(t,"class","loading svelte-eywiag")},m(e,r){O(e,t,r)},p:N,i:N,o:N,d(e){e&&M(t)}}}function Rr(n){let t;const e=n[6].default,r=Ji(e,n,n[5],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),t=!0},p(i,o){r&&r.p&&(!t||o&32)&&Yi(r,e,i,i[5],t?qi(e,i[5],o,null):Ki(i[5]),null)},i(i){t||(B(r,i),t=!0)},o(i){j(r,i),t=!1},d(i){r&&r.d(i)}}}function Ns(n){let t,e,r,i=n[0].type!=="connected"&&Pr(n),o=n[0].type==="connected"&&Rr(n);return{c(){i&&i.c(),t=$(),o&&o.c(),e=we()},m(s,f){i&&i.m(s,f),O(s,t,f),o&&o.m(s,f),O(s,e,f),r=!0},p(s,[f]){s[0].type!=="connected"?i?(i.p(s,f),f&1&&B(i,1)):(i=Pr(s),i.c(),B(i,1),i.m(t.parentNode,t)):i&&(he(),j(i,1,1,()=>{i=null}),me()),s[0].type==="connected"?o?(o.p(s,f),f&1&&B(o,1)):(o=Rr(s),o.c(),B(o,1),o.m(e.parentNode,e)):o&&(he(),j(o,1,1,()=>{o=null}),me())},i(s){r||(B(i),B(o),r=!0)},o(s){j(i),j(o),r=!1},d(s){i&&i.d(s),s&&M(t),o&&o.d(s),s&&M(e)}}}function Us(n,t,e){let r,i,{$$slots:o={},$$scope:s}=t,{p2p:f}=t;const{connectionState:c}=f;wr(n,c,d=>e(0,i=d));const l=()=>window.location=window.location.pathname;return n.$$set=d=>{"p2p"in d&&e(4,f=d.p2p),"$$scope"in d&&e(5,s=d.$$scope)},n.$$.update=()=>{n.$$.dirty&1&&e(1,r=i.type==="ready"?`${window.location.href}?id=${i.peerId}`:"")},[i,r,c,l,f,s,o]}class Gs extends Pe{constructor(t){super(),Ee(this,t,Us,Ns,Se,{p2p:4})}}function zs(n){let t,e;return t=new oa({props:{game:n[1]}}),t.$on("action",n[2]),{c(){ce(t.$$.fragment)},m(r,i){te(t,r,i),e=!0},p:N,i(r){e||(B(t.$$.fragment,r),e=!0)},o(r){j(t.$$.fragment,r),e=!1},d(r){ne(t,r)}}}function Hs(n){let t,e,r,i;return t=new Gs({props:{p2p:n[0],$$slots:{default:[zs]},$$scope:{ctx:n}}}),r=new so({}),{c(){ce(t.$$.fragment),e=$(),ce(r.$$.fragment)},m(o,s){te(t,o,s),O(o,e,s),te(r,o,s),i=!0},p(o,[s]){const f={};s&32&&(f.$$scope={dirty:s,ctx:o}),t.$set(f)},i(o){i||(B(t.$$.fragment,o),B(r.$$.fragment,o),i=!0)},o(o){j(t.$$.fragment,o),j(r.$$.fragment,o),i=!1},d(o){ne(t,o),o&&M(e),ne(r,o)}}}function Vs(n){const t=new URLSearchParams(window.location.search).get("id"),e=new ja(t,i),r=new ho(t?2:1);function i(s){const f=s;if(r.action(f),f.type==="GAME"||f.type==="RESET"){const l={type:"DICE",value:Fr()};r.action(l),e.send(l)}}function o(s){r.action(s.detail)&&e.send(s.detail)}return[e,r,o]}class Js extends Pe{constructor(t){super(),Ee(this,t,Vs,Hs,Se,{})}}new Js({target:document.getElementById("app")});
